<!doctype html>
<html class="docs-version-2.6.2" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Messaging | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.6.2/concepts-messaging"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.6.2"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.6.2"><meta data-react-helmet="true" property="og:title" content="Messaging | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Pulsar is built on the publish-subscribe pattern (short for pub-sub). In this pattern, producers publish messages to topics. Consumers subscribe to those topics, process incoming messages, and send an acknowledgement when processing is complete."><meta data-react-helmet="true" property="og:description" content="Pulsar is built on the publish-subscribe pattern (short for pub-sub). In this pattern, producers publish messages to topics. Consumers subscribe to those topics, process incoming messages, and send an acknowledgement when processing is complete."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.6.2/concepts-messaging"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.6.2/concepts-messaging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.6.2/concepts-messaging" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.6.2/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a class="dropdown__link" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Concepts and Architecture</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.6.2/concepts-messaging">Messaging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-architecture-overview">Architecture</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-clients">Clients</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-replication">Geo Replication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-multi-tenancy">Multi Tenancy</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-authentication">Authentication and Authorization</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-topic-compaction">Topic Compaction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-tiered-storage">Tiered Storage</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-proxy-sni-routing">Proxy support with SNI routing</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.6.2/concepts-multiple-advertised-listeners">Multiple advertised listeners</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cookbooks</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Pulsar <b>2.6.2</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/concepts-messaging">latest version</a></b> (2.8.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.6.2</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Messaging</h1></header><p>Pulsar is built on the <a href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern" target="_blank" rel="noopener noreferrer">publish-subscribe</a> pattern (short for pub-sub). In this pattern, <a href="#producers">producers</a> publish messages to <a href="#topics">topics</a>. <a href="#consumers">Consumers</a> <a href="#subscription-types">subscribe</a> to those topics, process incoming messages, and send an acknowledgement when processing is complete.</p><p>When a subscription is created, Pulsar <a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">retains</a> all messages, even if the consumer is disconnected. Retained messages are discarded only when a consumer acknowledges that those messages are processed successfully.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="messages"></a>Messages<a class="hash-link" href="#messages" title="Direct link to heading">#</a></h2><p>Messages are the basic &quot;unit&quot; of Pulsar. The following table lists the components of messages.</p><table><thead><tr><th align="left">Component</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">Value / data payload</td><td align="left">The data carried by the message. All Pulsar messages contain raw bytes, although message data can also conform to data <a href="/docs/2.6.2/schema-get-started">schemas</a>.</td></tr><tr><td align="left">Key</td><td align="left">Messages are optionally tagged with keys, which is useful for things like <a href="/docs/2.6.2/concepts-topic-compaction">topic compaction</a>.</td></tr><tr><td align="left">Properties</td><td align="left">An optional key/value map of user-defined properties.</td></tr><tr><td align="left">Producer name</td><td align="left">The name of the producer who produces the message. If you do not specify a producer name, the default name is used.</td></tr><tr><td align="left">Sequence ID</td><td align="left">Each Pulsar message belongs to an ordered sequence on its topic. The sequence ID of the message is its order in that sequence.</td></tr><tr><td align="left">Publish time</td><td align="left">The timestamp of when the message is published. The timestamp is automatically applied by the producer.</td></tr><tr><td align="left">Event time</td><td align="left">An optional timestamp attached to a message by applications. For example, applications attach a timestamp on when the message is processed. If nothing is set to event time, the value is <code>0</code>.</td></tr><tr><td align="left">TypedMessageBuilder</td><td align="left">It is used to construct a message. You can set message properties such as the message key, message value with <code>TypedMessageBuilder</code>. <br> When you set <code>TypedMessageBuilder</code>, set the key as a string. If you set the key as other types, for example, an AVRO object, the key is sent as bytes, and it is difficult to get the AVRO object back on the consumer.</td></tr></tbody></table><blockquote><p>For more information on Pulsar message contents, see Pulsar <a href="/docs/2.6.2/developing-binary-protocol">binary protocol</a>.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="producers"></a>Producers<a class="hash-link" href="#producers" title="Direct link to heading">#</a></h2><p>A producer is a process that attaches to a topic and publishes messages to a Pulsar <a href="/docs/2.6.2/reference-terminology#broker">broker</a>. The Pulsar broker process the messages.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="send-modes"></a>Send modes<a class="hash-link" href="#send-modes" title="Direct link to heading">#</a></h3><p>Producers send messages to brokers synchronously (sync) or asynchronously (async).</p><table><thead><tr><th align="left">Mode</th><th>Description</th></tr></thead><tbody><tr><td align="left">Sync send</td><td>The producer waits for an acknowledgement from the broker after sending every message. If the acknowledgment is not received, the producer treats the sending operation as a failure.</td></tr><tr><td align="left">Async send</td><td>The producer puts a message in a blocking queue and returns immediately. The client library sends the message to the broker in the background. If the queue is full (you can <a href="/docs/2.6.2/reference-configuration#broker">configure</a> the maximum size), the producer is blocked or fails immediately when calling the API, depending on arguments passed to the producer.</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="compression"></a>Compression<a class="hash-link" href="#compression" title="Direct link to heading">#</a></h3><p>You can compress messages published by producers during transportation. Pulsar currently supports the following types of compression:</p><ul><li><a href="https://github.com/lz4/lz4" target="_blank" rel="noopener noreferrer">LZ4</a></li><li><a href="https://zlib.net/" target="_blank" rel="noopener noreferrer">ZLIB</a></li><li><a href="https://facebook.github.io/zstd/" target="_blank" rel="noopener noreferrer">ZSTD</a></li><li><a href="https://google.github.io/snappy/" target="_blank" rel="noopener noreferrer">SNAPPY</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="batching"></a>Batching<a class="hash-link" href="#batching" title="Direct link to heading">#</a></h3><p>When batching is enabled, the producer accumulates and sends a batch of messages in a single request. The batch size is defined by the maximum number of messages and the maximum publish latency. Therefore, the backlog size represents the total number of batches instead of the total number of messages.</p><p>In Pulsar, batches are tracked and stored as single units rather than as individual messages. Consumer unbundles a batch into individual messages. However, scheduled messages (configured through the <code>deliverAt</code> or the <code>deliverAfter</code> parameter) are always sent as individual messages even batching is enabled.</p><p>In general, a batch is acknowledged when all of its messages are acknowledged by a consumer. It means unexpected failures, negative acknowledgements, or acknowledgement timeouts can result in redelivery of all messages in a batch, even if some of the messages are acknowledged.</p><p>To avoid redelivering acknowledged messages in a batch to the consumer, Pulsar introduces batch index acknowledgement since Pulsar 2.6.0. When batch index acknowledgement is enabled, the consumer filters out the batch index that has been acknowledged and sends the batch index acknowledgement request to the broker. The broker maintains the batch index acknowledgement status and tracks the acknowledgement status of each batch index to avoid dispatching acknowledged messages to the consumer. When all indexes of the batch message are acknowledged, the batch message is deleted.</p><p>By default, batch index acknowledgement is disabled (<code>acknowledgmentAtBatchIndexLevelEnabled=false</code>). You can enable batch index acknowledgement by setting the <code>acknowledgmentAtBatchIndexLevelEnabled</code> parameter to <code>true</code> at the broker side. Enabling batch index acknowledgement results in more memory overheads. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="chunking"></a>Chunking<a class="hash-link" href="#chunking" title="Direct link to heading">#</a></h3><p>When you enable chunking, read the following instructions.</p><ul><li>Batching and chunking cannot be enabled simultaneously. To enable chunking, you must disable batching in advance.</li><li>Chunking is only supported for persisted topics.</li><li>Chunking is only supported for the exclusive and failover subscription types.</li></ul><p>When chunking is enabled (<code>chunkingEnabled=true</code>), if the message size is greater than the allowed maximum publish-payload size, the producer splits the original message into chunked messages and publishes them with chunked metadata to the broker separately and in order. At the broker side, the chunked messages are stored in the managed-ledger in the same way as that of ordinary messages. The only difference is that the consumer needs to buffer the chunked messages and combines them into the real message when all chunked messages have been collected. The chunked messages in the managed-ledger can be interwoven with ordinary messages. If producer fails to publish all the chunks of a message, the consumer can expire incomplete chunks if consumer fail to receive all chunks in expire time. By default, the expire time is set to one hour.</p><p>The consumer consumes the chunked messages and buffers them until the consumer receives all the chunks of a message. And then the consumer stitches chunked messages together and places them into the receiver-queue. Clients consume messages from the receiver-queue. Once the consumer consumes the entire large message and acknowledges it, the consumer internally sends acknowledgement of all the chunk messages associated to that large message. You can set the <code>maxPendingChuckedMessage</code> parameter on the consumer. When the threshold is reached, the consumer drops the unchunked messages by silently acknowledging them or asking the broker to redeliver them later by marking them unacknowledged.</p><p> The broker does not require any changes to support chunking for non-shared subscription. The broker only uses <code>chuckedMessageRate</code> to record chunked message rate on the topic.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="handle-chunked-messages-with-one-producer-and-one-ordered-consumer"></a>Handle chunked messages with one producer and one ordered consumer<a class="hash-link" href="#handle-chunked-messages-with-one-producer-and-one-ordered-consumer" title="Direct link to heading">#</a></h4><p>As shown in the following figure, when a topic has one producer which publishes large message payload in chunked messages along with regular non-chunked messages. The producer publishes message M1 in three chunks M1-C1, M1-C2 and M1-C3. The broker stores all the three chunked messages in the managed-ledger and dispatches to the ordered (exclusive/failover) consumer in the same order. The consumer buffers all the chunked messages in memory until it receives all the chunked messages, combines them into one message and then hands over the original message M1 to the client.</p><p><img src="/assets/images/chunking-01-194c42c53633b89cb7f4653c537d4264.png"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="handle-chunked-messages-with-multiple-producers-and-one-ordered-consumer"></a>Handle chunked messages with multiple producers and one ordered consumer<a class="hash-link" href="#handle-chunked-messages-with-multiple-producers-and-one-ordered-consumer" title="Direct link to heading">#</a></h4><p>When multiple publishers publish chunked messages into a single topic, the broker stores all the chunked messages coming from different publishers in the same managed-ledger. As shown below, Producer 1 publishes message M1 in three chunks M1-C1, M1-C2 and M1-C3. Producer 2 publishes message M2 in three chunks M2-C1, M2-C2 and M2-C3. All chunked messages of the specific message are still in order but might not be consecutive in the managed-ledger. This brings some memory pressure to the consumer because the consumer keeps separate buffer for each large message to aggregate all chunks of the large message and combine them into one message.</p><p><img src="/assets/images/chunking-02-50ca285dd380b4bbecc01774655ead49.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="consumers"></a>Consumers<a class="hash-link" href="#consumers" title="Direct link to heading">#</a></h2><p>A consumer is a process that attaches to a topic via a subscription and then receives messages.</p><p>A consumer sends a <a href="/docs/2.6.2/develop-binary-protocol#flow-control">flow permit request</a> to a broker to get messages. There is a queue at the consumer side to receive messages pushed from the broker. You can configure the queue size with the <a href="/docs/2.6.2/client-libraries-java#configure-consumer"><code>receiverQueueSize</code></a> parameter. The default size is <code>1000</code>). Each time <code>consumer.receive()</code> is called, a message is dequeued from the buffer.  </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="receive-modes"></a>Receive modes<a class="hash-link" href="#receive-modes" title="Direct link to heading">#</a></h3><p>Messages are received from <a href="/docs/2.6.2/reference-terminology#broker">brokers</a> either synchronously (sync) or asynchronously (async).</p><table><thead><tr><th align="left">Mode</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left">Sync receive</td><td align="left">A sync receive is blocked until a message is available.</td></tr><tr><td align="left">Async receive</td><td align="left">An async receive returns immediately with a future valueâ€”for example, a <a href="http://www.baeldung.com/java-completablefuture" target="_blank" rel="noopener noreferrer"><code>CompletableFuture</code></a> in Javaâ€”that completes once a new message is available.</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="listeners"></a>Listeners<a class="hash-link" href="#listeners" title="Direct link to heading">#</a></h3><p>Client libraries provide listener implementation for consumers. For example, the <a href="/docs/2.6.2/client-libraries-java">Java client</a> provides a <a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/MessageListener" target="_blank" rel="noopener noreferrer">MesssageListener</a> interface. In this interface, the <code>received</code> method is called whenever a new message is received.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="acknowledgement"></a>Acknowledgement<a class="hash-link" href="#acknowledgement" title="Direct link to heading">#</a></h3><p>When a consumer consumes a message successfully, the consumer sends an acknowledgement request to the broker. This message is permanently stored, and then deleted only after all the subscriptions have acknowledged it. If you want to store the message that has been acknowledged by a consumer, you need to configure the <a href="/docs/2.6.2/concepts-messaging#message-retention-and-expiry">message retention policy</a>.</p><p>For a batch message, if batch index acknowledgement is enabled, the broker maintains the batch index acknowledgement status and tracks the acknowledgement status of each batch index to avoid dispatching acknowledged messages to the consumer. When all indexes of the batch message are acknowledged, the batch message is deleted. For details about the batch index acknowledgement, see <a href="#batching">batching</a>.</p><p>Messages can be acknowledged in the following two ways:</p><ul><li>Messages are acknowledged individually. With individual acknowledgement, the consumer needs to acknowledge each message and sends an acknowledgement request to the broker.</li><li>Messages are acknowledged cumulatively. With cumulative acknowledgement, the consumer only needs to acknowledge the last message it received. All messages in the stream up to (and including) the provided message are not re-delivered to that consumer.</li></ul><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Cumulative acknowledgement cannot be used in <a href="#subscription-types">Shared subscription type</a>, because this subscription type involves multiple consumers which have access to the same subscription. In Shared subscription type, messages are acknowledged individually.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="negative-acknowledgement"></a>Negative acknowledgement<a class="hash-link" href="#negative-acknowledgement" title="Direct link to heading">#</a></h3><p>When a consumer does not consume a message successfully at a time, and wants to consume the message again, the consumer sends a negative acknowledgement to the broker, and then the broker redelivers the message.</p><p>Messages are negatively acknowledged either individually or cumulatively, depending on the consumption subscription type.</p><p>In the exclusive and failover subscription types, consumers only negatively acknowledge the last message they receive.</p><p>In the shared and Key_Shared subscription types, you can negatively acknowledge messages individually.</p><p>Be aware that negative acknowledgment on ordered subscription types, such as Exclusive, Failover and Key_Shared, can cause failed messages to arrive consumers out of the original order.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If batching is enabled, other messages and the negatively acknowledged messages in the same batch are redelivered to the consumer.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="acknowledgement-timeout"></a>Acknowledgement timeout<a class="hash-link" href="#acknowledgement-timeout" title="Direct link to heading">#</a></h3><p>If a message is not consumed successfully, and you want to trigger the broker to redeliver the message automatically, you can adopt the unacknowledged message automatic re-delivery mechanism. Client tracks the unacknowledged messages within the entire <code>acktimeout</code> time range, and sends a <code>redeliver unacknowledged messages</code> request to the broker automatically when the acknowledgement timeout is specified.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>If batching is enabled, other messages and the unacknowledged messages in the same batch are redelivered to the consumer.</p></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Prefer negative acknowledgements over acknowledgement timeout. Negative acknowledgement controls the re-delivery of individual messages with more precision, and avoids invalid redeliveries when the message processing time exceeds the acknowledgement timeout.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="dead-letter-topic"></a>Dead letter topic<a class="hash-link" href="#dead-letter-topic" title="Direct link to heading">#</a></h3><p>Dead letter topic enables you to consume new messages when some messages cannot be consumed successfully by a consumer. In this mechanism, messages that are failed to be consumed are stored in a separate topic, which is called dead letter topic. You can decide how to handle messages in the dead letter topic.</p><p>The following example shows how to enable dead letter topic in a Java client using the default dead letter topic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; consumer = pulsarClient.newConsumer(Schema.BYTES)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .topic(topic)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscriptionName(&quot;my-subscription&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscriptionType(SubscriptionType.Shared)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .deadLetterPolicy(DeadLetterPolicy.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    .maxRedeliverCount(maxRedeliveryCount)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    .build())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The default dead letter topic uses this format: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;topicname&gt;-&lt;subscriptionname&gt;-DLQ</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you want to specify the name of the dead letter topic, use this Java client example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; consumer = pulsarClient.newConsumer(Schema.BYTES)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .topic(topic)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscriptionName(&quot;my-subscription&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscriptionType(SubscriptionType.Shared)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .deadLetterPolicy(DeadLetterPolicy.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    .maxRedeliverCount(maxRedeliveryCount)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    .deadLetterTopic(&quot;your-topic-name&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    .build())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">              .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Dead letter topic depends on message re-delivery. Messages are redelivered either due to <a href="#acknowledgement-timeout">acknowledgement timeout</a> or <a href="#negative-acknowledgement">negative acknowledgement</a>. If you are going to use negative acknowledgement on a message, make sure it is negatively acknowledged before the acknowledgement timeout. </p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Currently, dead letter topic is enabled only in Shared subscription type.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="retry-letter-topic"></a>Retry letter topic<a class="hash-link" href="#retry-letter-topic" title="Direct link to heading">#</a></h3><p>For many online business systems, a message is re-consumed due to exception occurs in the business logic processing. To configure the delay time for re-consuming the failed messages, you can configure the producer to send messages to both the business topic and the retry letter topic, and enable automatic retry on the consumer. When automatic retry is enabled on the consumer, a message is stored in the retry letter topic if the messages are not consumed, and therefore the consumer automatically consumes the failed messages from the retry letter topic after a specified delay time.</p><p>By default, automatic retry is disabled. You can set <code>enableRetry</code> to <code>true</code> to enable automatic retry on the consumer.</p><p>This example shows how to consume messages from a retry letter topic.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; consumer = pulsarClient.newConsumer(Schema.BYTES)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .topic(topic)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscriptionName(&quot;my-subscription&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscriptionType(SubscriptionType.Shared)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .enableRetry(true)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .receiverQueueSize(100)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .deadLetterPolicy(DeadLetterPolicy.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        .maxRedeliverCount(maxRedeliveryCount)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        .retryLetterTopic(&quot;persistent://my-property/my-ns/my-subscription-custom-Retry&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        .build())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="topics"></a>Topics<a class="hash-link" href="#topics" title="Direct link to heading">#</a></h2><p>As in other pub-sub systems, topics in Pulsar are named channels for transmitting messages from producers to consumers. Topic names are URLs that have a well-defined structure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly http"><pre tabindex="0" class="prism-code language-http codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{persistent|non-persistent}://tenant/namespace/topic</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><table><thead><tr><th align="left">Topic name component</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>persistent</code> / <code>non-persistent</code></td><td align="left">This identifies the type of topic. Pulsar supports two kind of topics: <a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">persistent</a> and <a href="#non-persistent-topics">non-persistent</a>. The default is persistent, so if you do not specify a type, the topic is persistent. With persistent topics, all messages are durably persisted on disks (if the broker is not standalone, messages are durably persisted on multiple disks), whereas data for non-persistent topics is not persisted to storage disks.</td></tr><tr><td align="left"><code>tenant</code></td><td align="left">The topic tenant within the instance. Tenants are essential to multi-tenancy in Pulsar, and spread across clusters.</td></tr><tr><td align="left"><code>namespace</code></td><td align="left">The administrative unit of the topic, which acts as a grouping mechanism for related topics. Most topic configuration is performed at the <a href="#namespaces">namespace</a> level. Each tenant has one or multiple namespaces.</td></tr><tr><td align="left"><code>topic</code></td><td align="left">The final part of the name. Topic names have no special meaning in a Pulsar instance.</td></tr></tbody></table><blockquote><p><strong>No need to explicitly create new topics</strong>
You do not need to explicitly create topics in Pulsar. If a client attempts to write or receive messages to/from a topic that does not yet exist, Pulsar creates that topic under the namespace provided in the <a href="#topics">topic name</a> automatically.
If no tenant or namespace is specified when a client creates a topic, the topic is created in the default tenant and namespace. You can also create a topic in a specified tenant and namespace, such as <code>persistent://my-tenant/my-namespace/my-topic</code>. <code>persistent://my-tenant/my-namespace/my-topic</code> means the <code>my-topic</code> topic is created in the <code>my-namespace</code> namespace of the <code>my-tenant</code> tenant.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="namespaces"></a>Namespaces<a class="hash-link" href="#namespaces" title="Direct link to heading">#</a></h2><p>A namespace is a logical nomenclature within a tenant. A tenant creates multiple namespaces via the <a href="/docs/2.6.2/admin-api-namespaces#create">admin API</a>. For instance, a tenant with different applications can create a separate namespace for each application. A namespace allows the application to create and manage a hierarchy of topics. The topic <code>my-tenant/app1</code> is a namespace for the application <code>app1</code> for <code>my-tenant</code>. You can create any number of <a href="#topics">topics</a> under the namespace.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="subscriptions"></a>Subscriptions<a class="hash-link" href="#subscriptions" title="Direct link to heading">#</a></h2><p>A subscription is a named configuration rule that determines how messages are delivered to consumers. Four subscription types are available in Pulsar: <a href="#exclusive">exclusive</a>, <a href="#shared">shared</a>, <a href="#failover">failover</a>, and <a href="#key_shared">key_shared</a>. These types are illustrated in the figure below.</p><p><img alt="Subscription types" src="/assets/images/pulsar-subscription-types-664733b68c7124129ca7d0e04dedcb96.png"></p><blockquote><p><strong>Pub-Sub or Queuing</strong>
In Pulsar, you can use different subscriptions flexibly.</p><ul><li>If you want to achieve traditional &quot;fan-out pub-sub messaging&quot; among consumers, specify a unique subscription name for each consumer. It is exclusive subscription type.</li><li>If you want to achieve &quot;message queuing&quot; among consumers, share the same subscription name among multiple consumers(shared, failover, key_shared).</li><li>If you want to achieve both effects simultaneously, combine exclusive subscription type with other subscription types for consumers.</li></ul></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="exclusive"></a>Exclusive<a class="hash-link" href="#exclusive" title="Direct link to heading">#</a></h3><p>In <em>exclusive</em> type, only a single consumer is allowed to attach to the subscription. If multiple consumers subscribe to a topic using the same subscription, an error occurs.</p><p>In the diagram below, only <strong>Consumer A-0</strong> is allowed to consume messages.</p><blockquote><p>Exclusive is the default subscription type.</p></blockquote><p><img alt="Exclusive subscriptions" src="/assets/images/pulsar-exclusive-subscriptions-af97d16a1ae6d222c1a9043286434fe4.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="failover"></a>Failover<a class="hash-link" href="#failover" title="Direct link to heading">#</a></h3><p>In <em>Failover</em> type, multiple consumers can attach to the same subscription. A master consumer is picked for non-partitioned topic or each partition of partitioned topic and receives messages. When the master consumer disconnects, all (non-acknowledged and subsequent) messages are delivered to the next consumer in line.</p><p>For partitioned topics, broker will sort consumers by priority level and lexicographical order of consumer name. Then broker will try to evenly assigns topics to consumers with the highest priority level.</p><p>For non-partitioned topic, broker will pick consumer in the order they subscribe to the non partitioned topic.</p><p>In the diagram below, <strong>Consumer-B-0</strong> is the master consumer while <strong>Consumer-B-1</strong> would be the next consumer in line to receive messages if <strong>Consumer-B-0</strong> is disconnected.</p><p><img alt="Failover subscriptions" src="/assets/images/pulsar-failover-subscriptions-4da024f3c527defb369590455c2613b1.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="shared"></a>Shared<a class="hash-link" href="#shared" title="Direct link to heading">#</a></h3><p>In <em>shared</em> or <em>round robin</em> mode, multiple consumers can attach to the same subscription. Messages are delivered in a round robin distribution across consumers, and any given message is delivered to only one consumer. When a consumer disconnects, all the messages that were sent to it and not acknowledged will be rescheduled for sending to the remaining consumers.</p><p>In the diagram below, <strong>Consumer-C-1</strong> and <strong>Consumer-C-2</strong> are able to subscribe to the topic, but <strong>Consumer-C-3</strong> and others could as well.</p><blockquote><p><strong>Limitations of shared mode</strong>
When using shared mode, be aware that:</p><ul><li>Message ordering is not guaranteed.</li><li>You cannot use cumulative acknowledgment with shared mode.</li></ul></blockquote><p><img alt="Shared subscriptions" src="/assets/images/pulsar-shared-subscriptions-3a2d219b8fc06b8f291f5f105f00db49.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="key_shared"></a>Key_Shared<a class="hash-link" href="#key_shared" title="Direct link to heading">#</a></h3><p>In <em>Key_Shared</em> mode, multiple consumers can attach to the same subscription. Messages are delivered in a distribution across consumers and message with same key or same ordering key are delivered to only one consumer. No matter how many times the message is re-delivered, it is delivered to the same consumer. When a consumer connected or disconnected will cause served consumer change for some key of message.</p><blockquote><p><strong>Limitations of Key_Shared mode</strong>
When you use Key_Shared mode, be aware that:</p><ul><li>You need to specify a key or orderingKey for messages.</li><li>You cannot use cumulative acknowledgment with Key_Shared mode.</li><li>Your producers should disable batching or use a key-based batch builder.</li></ul></blockquote><p><img alt="Key_Shared subscriptions" src="/assets/images/pulsar-key-shared-subscriptions-604d70909f81a39445ff217d818a2c06.png"></p><p><strong>You can disable Key_Shared subscription in the <code>broker.config</code> file.</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="multi-topic-subscriptions"></a>Multi-topic subscriptions<a class="hash-link" href="#multi-topic-subscriptions" title="Direct link to heading">#</a></h2><p>When a consumer subscribes to a Pulsar topic, by default it subscribes to one specific topic, such as <code>persistent://public/default/my-topic</code>. As of Pulsar version 1.23.0-incubating, however, Pulsar consumers can simultaneously subscribe to multiple topics. You can define a list of topics in two ways:</p><ul><li>On the basis of a <a href="https://en.wikipedia.org/wiki/Regular_expression" target="_blank" rel="noopener noreferrer"><strong>reg</strong>ular <strong>ex</strong>pression</a> (regex), for example <code>persistent://public/default/finance-.*</code></li><li>By explicitly defining a list of topics</li></ul><blockquote><p>When subscribing to multiple topics by regex, all topics must be in the same <a href="#namespaces">namespace</a>.</p></blockquote><p>When subscribing to multiple topics, the Pulsar client automatically makes a call to the Pulsar API to discover the topics that match the regex pattern/list, and then subscribe to all of them. If any of the topics do not exist, the consumer auto-subscribes to them once the topics are created.</p><blockquote><p><strong>No ordering guarantees across multiple topics</strong>
When a producer sends messages to a single topic, all messages are guaranteed to be read from that topic in the same order. However, these guarantees do not hold across multiple topics. So when a producer sends message to multiple topics, the order in which messages are read from those topics is not guaranteed to be the same.</p></blockquote><p>The following are multi-topic subscription examples for Java.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.regex.Pattern;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.client.api.Consumer;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.client.api.PulsarClient;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient pulsarClient = // Instantiate Pulsar client object</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Subscribe to all topics in a namespace</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pattern allTopicsInNamespace = Pattern.compile(&quot;persistent://public/default/.*&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; allTopicsConsumer = pulsarClient.newConsumer()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .topicsPattern(allTopicsInNamespace)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscriptionName(&quot;subscription-1&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Subscribe to a subsets of topics in a namespace, based on regex</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Pattern someTopicsInNamespace = Pattern.compile(&quot;persistent://public/default/foo.*&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; someTopicsConsumer = pulsarClient.newConsumer()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .topicsPattern(someTopicsInNamespace)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscriptionName(&quot;subscription-1&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For code examples, see <a href="/docs/2.6.2/client-libraries-java#multi-topic-subscriptions">Java</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="partitioned-topics"></a>Partitioned topics<a class="hash-link" href="#partitioned-topics" title="Direct link to heading">#</a></h2><p>Normal topics are served only by a single broker, which limits the maximum throughput of the topic. <em>Partitioned topics</em> are a special type of topic that are handled by multiple brokers, thus allowing for higher throughput.</p><p>A partitioned topic is actually implemented as N internal topics, where N is the number of partitions. When publishing messages to a partitioned topic, each message is routed to one of several brokers. The distribution of partitions across brokers is handled automatically by Pulsar.</p><p>The diagram below illustrates this:</p><p><img src="/assets/images/partitioning-622ea170dd771fd212d6b7378f2bd928.png"></p><p>The <strong>Topic1</strong> topic has five partitions (<strong>P0</strong> through <strong>P4</strong>) split across three brokers. Because there are more partitions than brokers, two brokers handle two partitions a piece, while the third handles only one (again, Pulsar handles this distribution of partitions automatically).</p><p>Messages for this topic are broadcast to two consumers. The <a href="#routing-modes">routing mode</a> determines each message should be published to which partition, while the <a href="#subscription-types">subscription type</a> determines which messages go to which consumers.</p><p>Decisions about routing and subscription types can be made separately in most cases. In general, throughput concerns should guide partitioning/routing decisions while subscription decisions should be guided by application semantics.</p><p>There is no difference between partitioned topics and normal topics in terms of how subscription types work, as partitioning only determines what happens between when a message is published by a producer and processed and acknowledged by a consumer.</p><p>Partitioned topics need to be explicitly created via the <a href="/docs/2.6.2/admin-api-overview">admin API</a>. The number of partitions can be specified when creating the topic.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="routing-modes"></a>Routing modes<a class="hash-link" href="#routing-modes" title="Direct link to heading">#</a></h3><p>When publishing to partitioned topics, you must specify a <em>routing mode</em>. The routing mode determines which partition---that is, which internal topic---each message should be published to.</p><p>There are three <a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/MessageRoutingMode" target="_blank" rel="noopener noreferrer">MessageRoutingMode</a> available:</p><table><thead><tr><th align="left">Mode</th><th align="left">Description</th></tr></thead><tbody><tr><td align="left"><code>RoundRobinPartition</code></td><td align="left">If no key is provided, the producer will publish messages across all partitions in round-robin fashion to achieve maximum throughput. Please note that round-robin is not done per individual message but rather it&#x27;s set to the same boundary of batching delay, to ensure batching is effective. While if a key is specified on the message, the partitioned producer will hash the key and assign message to a particular partition. This is the default mode.</td></tr><tr><td align="left"><code>SinglePartition</code></td><td align="left">If no key is provided, the producer will randomly pick one single partition and publish all the messages into that partition. While if a key is specified on the message, the partitioned producer will hash the key and assign message to a particular partition.</td></tr><tr><td align="left"><code>CustomPartition</code></td><td align="left">Use custom message router implementation that will be called to determine the partition for a particular message. User can create a custom routing mode by using the <a href="/docs/2.6.2/client-libraries-java">Java client</a> and implementing the <a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/MessageRouter" target="_blank" rel="noopener noreferrer">MessageRouter</a> interface.</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ordering-guarantee"></a>Ordering guarantee<a class="hash-link" href="#ordering-guarantee" title="Direct link to heading">#</a></h3><p>The ordering of messages is related to MessageRoutingMode and Message Key. Usually, user would want an ordering of Per-key-partition guarantee.</p><p>If there is a key attached to message, the messages will be routed to corresponding partitions based on the hashing scheme specified by <a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/HashingScheme" target="_blank" rel="noopener noreferrer">HashingScheme</a> in <a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/ProducerBuilder" target="_blank" rel="noopener noreferrer">ProducerBuilder</a>, when using either <code>SinglePartition</code> or <code>RoundRobinPartition</code> mode.</p><table><thead><tr><th align="left">Ordering guarantee</th><th align="left">Description</th><th align="left">Routing Mode and Key</th></tr></thead><tbody><tr><td align="left">Per-key-partition</td><td align="left">All the messages with the same key will be in order and be placed in same partition.</td><td align="left">Use either <code>SinglePartition</code> or <code>RoundRobinPartition</code> mode, and Key is provided by each message.</td></tr><tr><td align="left">Per-producer</td><td align="left">All the messages from the same producer will be in order.</td><td align="left">Use <code>SinglePartition</code> mode, and no Key is provided for each message.</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="hashing-scheme"></a>Hashing scheme<a class="hash-link" href="#hashing-scheme" title="Direct link to heading">#</a></h3><p><a href="https://pulsar.incubator.apache.org/api/client/org/apache/pulsar/client/api/HashingScheme" target="_blank" rel="noopener noreferrer">HashingScheme</a> is an enum that represent sets of standard hashing functions available when choosing the partition to use for a particular message.</p><p>There are 2 types of standard hashing functions available: <code>JavaStringHash</code> and <code>Murmur3_32Hash</code>.
The default hashing function for producer is <code>JavaStringHash</code>.
Please pay attention that <code>JavaStringHash</code> is not useful when producers can be from different multiple language clients, under this use case, it is recommended to use <code>Murmur3_32Hash</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="non-persistent-topics"></a>Non-persistent topics<a class="hash-link" href="#non-persistent-topics" title="Direct link to heading">#</a></h2><p>By default, Pulsar persistently stores <em>all</em> unacknowledged messages on multiple <a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">BookKeeper</a> bookies (storage nodes). Data for messages on persistent topics can thus survive broker restarts and subscriber failover.</p><p>Pulsar also, however, supports <strong>non-persistent topics</strong>, which are topics on which messages are <em>never</em> persisted to disk and live only in memory. When using non-persistent delivery, killing a Pulsar broker or disconnecting a subscriber to a topic means that all in-transit messages are lost on that (non-persistent) topic, meaning that clients may see message loss.</p><p>Non-persistent topics have names of this form (note the <code>non-persistent</code> in the name):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly http"><pre tabindex="0" class="prism-code language-http codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">non-persistent://tenant/namespace/topic</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>For more info on using non-persistent topics, see the <a href="/docs/2.6.2/cookbooks-non-persistent">Non-persistent messaging cookbook</a>.</p></blockquote><p>In non-persistent topics, brokers immediately deliver messages to all connected subscribers <em>without persisting them</em> in <a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">BookKeeper</a>. If a subscriber is disconnected, the broker will not be able to deliver those in-transit messages, and subscribers will never be able to receive those messages again. Eliminating the persistent storage step makes messaging on non-persistent topics slightly faster than on persistent topics in some cases, but with the caveat that some of the core benefits of Pulsar are lost.</p><blockquote><p>With non-persistent topics, message data lives only in memory. If a message broker fails or message data can otherwise not be retrieved from memory, your message data may be lost. Use non-persistent topics only if you&#x27;re <em>certain</em> that your use case requires it and can sustain it.</p></blockquote><p>By default, non-persistent topics are enabled on Pulsar brokers. You can disable them in the broker&#x27;s <a href="/docs/2.6.2/reference-configuration#broker-enableNonPersistentTopics">configuration</a>. You can manage non-persistent topics using the <code>pulsar-admin topics</code> command. For more information, see <a href="https://pulsar.apache.org/tools/pulsar-admin/" target="_blank" rel="noopener noreferrer"><code>pulsar-admin</code></a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="performance"></a>Performance<a class="hash-link" href="#performance" title="Direct link to heading">#</a></h3><p>Non-persistent messaging is usually faster than persistent messaging because brokers don&#x27;t persist messages and immediately send acks back to the producer as soon as that message is delivered to connected brokers. Producers thus see comparatively low publish latency with non-persistent topic.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="client-api"></a>Client API<a class="hash-link" href="#client-api" title="Direct link to heading">#</a></h3><p>Producers and consumers can connect to non-persistent topics in the same way as persistent topics, with the crucial difference that the topic name must start with <code>non-persistent</code>. All three subscription types---<a href="#exclusive">exclusive</a>, <a href="#shared">shared</a>, and <a href="#failover">failover</a>---are supported for non-persistent topics.</p><p>Here&#x27;s an example <a href="/docs/2.6.2/client-libraries-java#consumers">Java consumer</a> for a non-persistent topic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient client = PulsarClient.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .serviceUrl(&quot;pulsar://localhost:6650&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String npTopic = &quot;non-persistent://public/default/my-topic&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">String subscriptionName = &quot;my-subscription-name&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Consumer&lt;byte[]&gt; consumer = client.newConsumer()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .topic(npTopic)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .subscriptionName(subscriptionName)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .subscribe();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here&#x27;s an example <a href="/docs/2.6.2/client-libraries-java#producer">Java producer</a> for the same non-persistent topic:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Producer&lt;byte[]&gt; producer = client.newProducer()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .topic(npTopic)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                .create();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="message-retention-and-expiry"></a>Message retention and expiry<a class="hash-link" href="#message-retention-and-expiry" title="Direct link to heading">#</a></h2><p>By default, Pulsar message brokers:</p><ul><li>immediately delete <em>all</em> messages that have been acknowledged by a consumer, and</li><li><a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">persistently store</a> all unacknowledged messages in a message backlog.</li></ul><p>Pulsar has two features, however, that enable you to override this default behavior:</p><ul><li>Message <strong>retention</strong> enables you to store messages that have been acknowledged by a consumer</li><li>Message <strong>expiry</strong> enables you to set a time to live (TTL) for messages that have not yet been acknowledged</li></ul><blockquote><p>All message retention and expiry is managed at the <a href="#namespaces">namespace</a> level. For a how-to, see the <a href="/docs/2.6.2/cookbooks-retention-expiry">Message retention and expiry</a> cookbook.</p></blockquote><p>The diagram below illustrates both concepts:</p><p><img alt="Message retention and expiry" src="/assets/images/retention-expiry-0cbc1fc12ef1d2620a801624838246b6.png"></p><p>With message retention, shown at the top, a <span style="color:#89b557">retention policy</span> applied to all topics in a namespace dictates that some messages are durably stored in Pulsar even though they&#x27;ve already been acknowledged. Acknowledged messages that are not covered by the retention policy are <span style="color:#bb3b3e">deleted</span>. Without a retention policy, *all* of the <span style="color:#19967d">acknowledged messages</span> would be deleted.</p><p>With message expiry, shown at the bottom, some messages are <span style="color:#bb3b3e">deleted</span>, even though they <span style="color:#337db6">haven&#x27;t been acknowledged</span>, because they&#x27;ve expired according to the <span style="color:#e39441">TTL applied to the namespace</span> (for example because a TTL of 5 minutes has been applied and the messages haven&#x27;t been acknowledged but are 10 minutes old).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="message-deduplication"></a>Message deduplication<a class="hash-link" href="#message-deduplication" title="Direct link to heading">#</a></h2><p>Message duplication occurs when a message is persisted](/docs/2.6.2/concepts-architecture-overview#persistent-storage) by Pulsar more than once. Message deduplication is an optional Pulsar feature that prevents unnecessary message duplication by processing each message only once, even if the message is received more than once.</p><p>The following diagram illustrates what happens when message deduplication is disabled vs. enabled:</p><p><img alt="Pulsar message deduplication" src="/assets/images/message-deduplication-9b0c6e8bd5a418882aaee35c62519828.png"></p><p>Message deduplication is disabled in the scenario shown at the top. Here, a producer publishes message 1 on a topic; the message reaches a Pulsar broker and is <a href="/docs/2.6.2/concepts-architecture-overview#persistent-storage">persisted</a> to BookKeeper. The producer then sends message 1 again (in this case due to some retry logic), and the message is received by the broker and stored in BookKeeper again, which means that duplication has occurred.</p><p>In the second scenario at the bottom, the producer publishes message 1, which is received by the broker and persisted, as in the first scenario. When the producer attempts to publish the message again, however, the broker knows that it has already seen message 1 and thus does not persist the message.</p><blockquote><p>Message deduplication is handled at the namespace level. For more instructions, see the <a href="/docs/2.6.2/cookbooks-deduplication">message deduplication cookbook</a>.</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="producer-idempotency"></a>Producer idempotency<a class="hash-link" href="#producer-idempotency" title="Direct link to heading">#</a></h3><p>The other available approach to message deduplication is to ensure that each message is <em>only produced once</em>. This approach is typically called <strong>producer idempotency</strong>. The drawback of this approach is that it defers the work of message deduplication to the application. In Pulsar, this is handled at the <a href="/docs/2.6.2/reference-terminology#broker">broker</a> level, so you do not need to modify your Pulsar client code. Instead, you only need to make administrative changes. For details, see <a href="/docs/2.6.2/cookbooks-deduplication">Managing message deduplication</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="deduplication-and-effectively-once-semantics"></a>Deduplication and effectively-once semantics<a class="hash-link" href="#deduplication-and-effectively-once-semantics" title="Direct link to heading">#</a></h3><p>Message deduplication makes Pulsar an ideal messaging system to be used in conjunction with stream processing engines (SPEs) and other systems seeking to provide effectively-once processing semantics. Messaging systems that do not offer automatic message deduplication require the SPE or other system to guarantee deduplication, which means that strict message ordering comes at the cost of burdening the application with the responsibility of deduplication. With Pulsar, strict ordering guarantees come at no application-level cost.</p><blockquote><p>You can find more in-depth information in <a href="https://www.splunk.com/en_us/blog/it/exactly-once-is-not-exactly-the-same.html" target="_blank" rel="noopener noreferrer">this post</a>.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="delayed-message-delivery"></a>Delayed message delivery<a class="hash-link" href="#delayed-message-delivery" title="Direct link to heading">#</a></h2><p>Delayed message delivery enables you to consume a message later rather than immediately. In this mechanism, a message is stored in BookKeeper, <code>DelayedDeliveryTracker</code> maintains the time index(time -&gt; messageId) in memory after published to a broker, and it is delivered to a consumer once the specific delayed time is passed.  </p><p>Delayed message delivery only works in Shared subscription type. In Exclusive and Failover subscription types, the delayed message is dispatched immediately.</p><p>The diagram below illustrates the concept of delayed message delivery:</p><p><img alt="Delayed Message Delivery" src="/assets/images/message_delay-e776c550543fd785fef8fbdb703db9e5.png"></p><p>A broker saves a message without any check. When a consumer consumes a message, if the message is set to delay, then the message is added to <code>DelayedDeliveryTracker</code>. A subscription checks and gets timeout messages from <code>DelayedDeliveryTracker</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="broker"></a>Broker<a class="hash-link" href="#broker" title="Direct link to heading">#</a></h3><p>Delayed message delivery is enabled by default. You can change it in the broker configuration file as below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Whether to enable the delayed delivery for messages.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If disabled, messages are immediately delivered and there is no tracking overhead.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delayedDeliveryEnabled=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Control the ticking time for the retry of delayed message delivery,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># affecting the accuracy of the delivery time compared to the scheduled time.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Default is 1 second.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">delayedDeliveryTickTimeMillis=1000</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="producer"></a>Producer<a class="hash-link" href="#producer" title="Direct link to heading">#</a></h3><p>The following is an example of delayed message delivery for a producer in Java:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">// message to be delivered at the configured delay interval</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">producer.newMessage().deliverAfter(3L, TimeUnit.Minute).value(&quot;Hello Pulsar!&quot;).send();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.6.2/concepts-messaging.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.6.2/concepts-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.6.2/concepts-architecture-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#messages" class="table-of-contents__link">Messages</a></li><li><a href="#producers" class="table-of-contents__link">Producers</a><ul><li><a href="#send-modes" class="table-of-contents__link">Send modes</a></li><li><a href="#compression" class="table-of-contents__link">Compression</a></li><li><a href="#batching" class="table-of-contents__link">Batching</a></li><li><a href="#chunking" class="table-of-contents__link">Chunking</a></li></ul></li><li><a href="#consumers" class="table-of-contents__link">Consumers</a><ul><li><a href="#receive-modes" class="table-of-contents__link">Receive modes</a></li><li><a href="#listeners" class="table-of-contents__link">Listeners</a></li><li><a href="#acknowledgement" class="table-of-contents__link">Acknowledgement</a></li><li><a href="#negative-acknowledgement" class="table-of-contents__link">Negative acknowledgement</a></li><li><a href="#acknowledgement-timeout" class="table-of-contents__link">Acknowledgement timeout</a></li><li><a href="#dead-letter-topic" class="table-of-contents__link">Dead letter topic</a></li><li><a href="#retry-letter-topic" class="table-of-contents__link">Retry letter topic</a></li></ul></li><li><a href="#topics" class="table-of-contents__link">Topics</a></li><li><a href="#namespaces" class="table-of-contents__link">Namespaces</a></li><li><a href="#subscriptions" class="table-of-contents__link">Subscriptions</a><ul><li><a href="#exclusive" class="table-of-contents__link">Exclusive</a></li><li><a href="#failover" class="table-of-contents__link">Failover</a></li><li><a href="#shared" class="table-of-contents__link">Shared</a></li><li><a href="#key_shared" class="table-of-contents__link">Key_Shared</a></li></ul></li><li><a href="#multi-topic-subscriptions" class="table-of-contents__link">Multi-topic subscriptions</a></li><li><a href="#partitioned-topics" class="table-of-contents__link">Partitioned topics</a><ul><li><a href="#routing-modes" class="table-of-contents__link">Routing modes</a></li><li><a href="#ordering-guarantee" class="table-of-contents__link">Ordering guarantee</a></li><li><a href="#hashing-scheme" class="table-of-contents__link">Hashing scheme</a></li></ul></li><li><a href="#non-persistent-topics" class="table-of-contents__link">Non-persistent topics</a><ul><li><a href="#performance" class="table-of-contents__link">Performance</a></li><li><a href="#client-api" class="table-of-contents__link">Client API</a></li></ul></li><li><a href="#message-retention-and-expiry" class="table-of-contents__link">Message retention and expiry</a></li><li><a href="#message-deduplication" class="table-of-contents__link">Message deduplication</a><ul><li><a href="#producer-idempotency" class="table-of-contents__link">Producer idempotency</a></li><li><a href="#deduplication-and-effectively-once-semantics" class="table-of-contents__link">Deduplication and effectively-once semantics</a></li></ul></li><li><a href="#delayed-message-delivery" class="table-of-contents__link">Delayed message delivery</a><ul><li><a href="#broker" class="table-of-contents__link">Broker</a></li><li><a href="#producer" class="table-of-contents__link">Producer</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>