<!doctype html>
<html class="docs-version-2.8.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Simulation tools | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/develop-tools"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.8.0"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.8.0"><meta data-react-helmet="true" property="og:title" content="Simulation tools | Apache Pulsar"><meta data-react-helmet="true" name="description" content="It is sometimes necessary create an test environment and incur artificial load to observe how well load managers"><meta data-react-helmet="true" property="og:description" content="It is sometimes necessary create an test environment and incur artificial load to observe how well load managers"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/develop-tools"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/develop-tools" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/develop-tools" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a class="dropdown__link" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts and Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tiered Storage</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transactions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cookbooks</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Development</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/develop-tools">Simulation tools</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop-binary-protocol">Binary protocol</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop-schema">Custom schema storage</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop-load-manager">Modular load manager</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.8.0</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Simulation tools</h1></header><p>It is sometimes necessary create an test environment and incur artificial load to observe how well load managers
handle the load. The load simulation controller, the load simulation client, and the broker monitor were created as an
effort to make create this load and observe the effects on the managers more easily.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="simulation-client"></a>Simulation Client<a class="hash-link" href="#simulation-client" title="Direct link to heading">#</a></h2><p>The simulation client is a machine which will create and subscribe to topics with configurable message rates and sizes.
Because it is sometimes necessary in simulating large load to use multiple client machines, the user does not interact
with the simulation client directly, but instead delegates their requests to the simulation controller, which will then
send signals to clients to start incurring load. The client implementation is in the class
<code>org.apache.pulsar.testclient.LoadSimulationClient</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="usage"></a>Usage<a class="hash-link" href="#usage" title="Direct link to heading">#</a></h3><p>To Start a simulation client, use the <code>pulsar-perf</code> script with the command <code>simulation-client</code> as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-perf simulation-client --port &lt;listen port&gt; --service-url &lt;pulsar service url&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The client will then be ready to receive controller commands.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="simulation-controller"></a>Simulation Controller<a class="hash-link" href="#simulation-controller" title="Direct link to heading">#</a></h2><p>The simulation controller send signals to the simulation clients, requesting them to create new topics, stop old
topics, change the load incurred by topics, as well as several other tasks. It is implemented in the class
<code>org.apache.pulsar.testclient.LoadSimulationController</code> and presents a shell to the user as an interface to send
command with.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="usage-1"></a>Usage<a class="hash-link" href="#usage-1" title="Direct link to heading">#</a></h3><p>To start a simulation controller, use the <code>pulsar-perf</code> script with the command <code>simulation-controller</code> as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-perf simulation-controller --cluster &lt;cluster to simulate on&gt; --client-port &lt;listen port for clients&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--clients &lt;comma-separated list of client host names&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The clients should already be started before the controller is started. You will then be presented with a simple prompt,
where you can issue commands to simulation clients. Arguments often refer to tenant names, namespace names, and topic
names. In all cases, the BASE name of the tenants, namespaces, and topics are used. For example, for the topic
<code>persistent://my_tenant/my_cluster/my_namespace/my_topic</code>, the tenant name is <code>my_tenant</code>, the namespace name is
<code>my_namespace</code>, and the topic name is <code>my_topic</code>. The controller can perform the following actions:</p><ul><li>Create a topic with a producer and a consumer<ul><li><code>trade &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt; [--rate &lt;message rate per second&gt;]
[--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
[--size &lt;message size in bytes&gt;]</code></li></ul></li><li>Create a group of topics with a producer and a consumer<ul><li><code>trade_group &lt;tenant&gt; &lt;group&gt; &lt;num_namespaces&gt; [--rate &lt;message rate per second&gt;]
[--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
[--separation &lt;separation between creating topics in ms&gt;] [--size &lt;message size in bytes&gt;]
[--topics-per-namespace &lt;number of topics to create per namespace&gt;]</code></li></ul></li><li>Change the configuration of an existing topic<ul><li><code>change &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt; [--rate &lt;message rate per second&gt;]
[--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
[--size &lt;message size in bytes&gt;]</code></li></ul></li><li>Change the configuration of a group of topics<ul><li><code>change_group &lt;tenant&gt; &lt;group&gt; [--rate &lt;message rate per second&gt;] [--rand-rate &lt;lower bound&gt;,&lt;upper bound&gt;]
[--size &lt;message size in bytes&gt;] [--topics-per-namespace &lt;number of topics to create per namespace&gt;]</code></li></ul></li><li>Shutdown a previously created topic<ul><li><code>stop &lt;tenant&gt; &lt;namespace&gt; &lt;topic&gt;</code></li></ul></li><li>Shutdown a previously created group of topics<ul><li><code>stop_group &lt;tenant&gt; &lt;group&gt;</code></li></ul></li><li>Copy the historical data from one ZooKeeper to another and simulate based on the message rates and sizes in that history<ul><li><code>copy &lt;tenant&gt; &lt;source zookeeper&gt; &lt;target zookeeper&gt; [--rate-multiplier value]</code></li></ul></li><li>Simulate the load of the historical data on the current ZooKeeper (should be same ZooKeeper being simulated on)<ul><li><code>simulate &lt;tenant&gt; &lt;zookeeper&gt; [--rate-multiplier value]</code></li></ul></li><li>Stream the latest data from the given active ZooKeeper to simulate the real-time load of that ZooKeeper.<ul><li><code>stream &lt;tenant&gt; &lt;zookeeper&gt; [--rate-multiplier value]</code></li></ul></li></ul><p>The &quot;group&quot; arguments in these commands allow the user to create or affect multiple topics at once. Groups are created
when calling the <code>trade_group</code> command, and all topics from these groups may be subsequently modified or stopped
with the <code>change_group</code> and <code>stop_group</code> commands respectively. All ZooKeeper arguments are of the form
<code>zookeeper_host:port</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="difference-between-copy-simulate-and-stream"></a>Difference Between Copy, Simulate, and Stream<a class="hash-link" href="#difference-between-copy-simulate-and-stream" title="Direct link to heading">#</a></h3><p>The commands <code>copy</code>, <code>simulate</code>, and <code>stream</code> are very similar but have significant differences. <code>copy</code> is used when
you want to simulate the load of a static, external ZooKeeper on the ZooKeeper you are simulating on. Thus,
<code>source zookeeper</code> should be the ZooKeeper you want to copy and <code>target zookeeper</code> should be the ZooKeeper you are
simulating on, and then it will get the full benefit of the historical data of the source in both load manager
implementations. <code>simulate</code> on the other hand takes in only one ZooKeeper, the one you are simulating on. It assumes
that you are simulating on a ZooKeeper that has historical data for <code>SimpleLoadManagerImpl</code> and creates equivalent
historical data for <code>ModularLoadManagerImpl</code>. Then, the load according to the historical data is simulated by the
clients. Finally, <code>stream</code> takes in an active ZooKeeper different than the ZooKeeper being simulated on and streams
load data from it and simulates the real-time load. In all cases, the optional <code>rate-multiplier</code> argument allows the
user to simulate some proportion of the load. For instance, using <code>--rate-multiplier 0.05</code> will cause messages to
be sent at only <code>5%</code> of the rate of the load that is being simulated.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="broker-monitor"></a>Broker Monitor<a class="hash-link" href="#broker-monitor" title="Direct link to heading">#</a></h2><p>To observe the behavior of the load manager in these simulations, one may utilize the broker monitor, which is
implemented in <code>org.apache.pulsar.testclient.BrokerMonitor</code>. The broker monitor will print tabular load data to the
console as it is updated using watchers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="usage-2"></a>Usage<a class="hash-link" href="#usage-2" title="Direct link to heading">#</a></h3><p>To start a broker monitor, use the <code>monitor-brokers</code> command in the <code>pulsar-perf</code> script:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-perf monitor-brokers --connect-string &lt;zookeeper host:port&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The console will then continuously print load data until it is interrupted.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.8.0/developing-tools.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/cookbooks-bookkeepermetadata"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« BookKeeper Ledger Metadata</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/develop-binary-protocol"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Binary protocol Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#simulation-client" class="table-of-contents__link">Simulation Client</a><ul><li><a href="#usage" class="table-of-contents__link">Usage</a></li></ul></li><li><a href="#simulation-controller" class="table-of-contents__link">Simulation Controller</a><ul><li><a href="#usage-1" class="table-of-contents__link">Usage</a></li><li><a href="#difference-between-copy-simulate-and-stream" class="table-of-contents__link">Difference Between Copy, Simulate, and Stream</a></li></ul></li><li><a href="#broker-monitor" class="table-of-contents__link">Broker Monitor</a><ul><li><a href="#usage-2" class="table-of-contents__link">Usage</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>