<!doctype html>
<html class="docs-version-2.7.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Message retention and expiry | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.7.1/cookbooks-retention-expiry"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.7.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.7.1"><meta data-react-helmet="true" property="og:title" content="Message retention and expiry | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Pulsar brokers are responsible for handling messages that pass through Pulsar, including persistent storage of messages. By default, for each topic, brokers only retain messages that are in at least one backlog. A backlog is the set of unacknowledged messages for a particular subscription. As a topic can have multiple subscriptions, a topic can have multiple backlogs."><meta data-react-helmet="true" property="og:description" content="Pulsar brokers are responsible for handling messages that pass through Pulsar, including persistent storage of messages. By default, for each topic, brokers only retain messages that are in at least one backlog. A backlog is the set of unacknowledged messages for a particular subscription. As a topic can have multiple subscriptions, a topic can have multiple backlogs."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.7.1/cookbooks-retention-expiry"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/cookbooks-retention-expiry" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/cookbooks-retention-expiry" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.7.1/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts and Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tiered Storage</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transactions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Cookbooks</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-compaction">Topic compaction</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-deduplication">Message deduplication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-non-persistent">Non-persistent messaging</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.7.1/cookbooks-retention-expiry">Message retention and expiry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-encryption">Encryption</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-message-queue">Message queue</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Pulsar <b>2.7.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/cookbooks-retention-expiry">latest version</a></b> (2.8.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.7.1</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Message retention and expiry</h1></header><p>Pulsar brokers are responsible for handling messages that pass through Pulsar, including <a href="/docs/2.7.1/concepts-architecture-overview#persistent-storage">persistent storage</a> of messages. By default, for each topic, brokers only retain messages that are in at least one backlog. A backlog is the set of unacknowledged messages for a particular subscription. As a topic can have multiple subscriptions, a topic can have multiple backlogs.</p><p>As a consequence, no messages are retained (by default) on a topic that has not had any subscriptions created for it.</p><p>(Note that messages that are no longer being stored are not necessarily immediately deleted, and may in fact still be accessible until the next ledger rollover. Because clients cannot predict when rollovers may happen, it is not wise to rely on a rollover not happening at an inconvenient point in time.)</p><p>In Pulsar, you can modify this behavior, with namespace granularity, in two ways:</p><ul><li>You can persistently store messages that are not within a backlog (because they&#x27;ve been acknowledged by on every existing subscription, or because there are no subscriptions) by setting <a href="#retention-policies">retention policies</a>.</li><li>Messages that are not acknowledged within a specified timeframe can be automatically acknowledged, by specifying the <a href="#time-to-live-ttl">time to live</a> (TTL).</li></ul><p>Pulsar&#x27;s <a href="/docs/2.7.1/admin-api-overview">admin interface</a> enables you to manage both retention policies and TTL with namespace granularity (and thus within a specific tenant and either on a specific cluster or in the <a href="/docs/2.7.1/concepts-architecture-overview#global-cluster"><code>global</code></a> cluster).</p><blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="retention-and-ttl-solve-two-different-problems"></a>Retention and TTL solve two different problems<a class="hash-link" href="#retention-and-ttl-solve-two-different-problems" title="Direct link to heading">#</a></h4><ul><li>Message retention: Keep the data for at least X hours (even if acknowledged)</li><li>Time-to-live: Discard data after some time (by automatically acknowledging)</li></ul><p>Most applications will want to use at most one of these.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="retention-policies"></a>Retention policies<a class="hash-link" href="#retention-policies" title="Direct link to heading">#</a></h2><p>By default, when a Pulsar message arrives at a broker, the message is stored until it has been acknowledged on all subscriptions, at which point it is marked for deletion. You can override this behavior and retain messages that have already been acknowledged on all subscriptions by setting a <em>retention policy</em> for all topics in a given namespace. Retention is based on both a <em>size limit</em> and a <em>time limit</em>.</p><p>Retention policies are useful when you use the Reader interface. The Reader interface does not use acknowledgements, and messages do not exist within backlogs. It is required to configure retention for Reader-only use cases.</p><p>When you set a retention policy on topics in a namespace, you must set <strong>both</strong> a <em>size limit</em> and a <em>time limit</em>. You can refer to the following table to set retention policies in <code>pulsar-admin</code> and Java.</p><table><thead><tr><th>Time limit</th><th>Size limit</th><th>Message retention</th></tr></thead><tbody><tr><td>-1</td><td>-1</td><td>Infinite retention</td></tr><tr><td>-1</td><td>&gt;0</td><td>Based on the size limit</td></tr><tr><td>&gt;0</td><td>-1</td><td>Based on the time limit</td></tr><tr><td>0</td><td>0</td><td>Disable message retention (by default)</td></tr><tr><td>0</td><td>&gt;0</td><td>Invalid</td></tr><tr><td>&gt;0</td><td>0</td><td>Invalid</td></tr><tr><td>&gt;0</td><td>&gt;0</td><td>Acknowledged messages or messages with no active subscription will not be retained when either time or size reaches the limit.</td></tr></tbody></table><p>The retention settings apply to all messages on topics that do not have any subscriptions, or to messages that have been acknowledged by all subscriptions. The retention policy settings do not affect unacknowledged messages on topics with subscriptions. The unacknowledged messages are controlled by the backlog quota.</p><p>When a retention limit on a topic is exceeded, the oldest message is marked for deletion until the set of retained messages falls within the specified limits again.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="defaults"></a>Defaults<a class="hash-link" href="#defaults" title="Direct link to heading">#</a></h3><p>You can set message retention at instance level with the following two parameters: <code>defaultRetentionTimeInMinutes</code> and <code>defaultRetentionSizeInMB</code>. Both parameters are set to <code>0</code> by default. </p><p>For more information of the two parameters, refer to the <a href="/docs/2.7.1/reference-configuration#broker"><code>broker.conf</code></a> configuration file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="set-retention-policy"></a>Set retention policy<a class="hash-link" href="#set-retention-policy" title="Direct link to heading">#</a></h3><p>You can set a retention policy for a namespace by specifying the namespace, a size limit and a time limit in <code>pulsar-admin</code>, REST API and Java.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">pulsar-admin</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">REST API</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Java</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>You can use the <a href="/docs/2.7.1/pulsar-admin#namespaces-set-retention"><code>set-retention</code></a> subcommand and specify a namespace, a size limit using the <code>-s</code>/<code>--size</code> flag, and a time limit using the <code>-t</code>/<code>--time</code> flag. </p><p>In the following example, the size limit is set to 10 GB and the time limit is set to 3 hours for each topic within the <code>my-tenant/my-ns</code> namespace. </p><ul><li>When the size of messages reaches 10 GB on a topic within 3 hours, the acknowledged messages will not be retained. </li><li>After 3 hours, even if the message size is less than 10 GB, the acknowledged messages will not be retained. </li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-retention my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --size 10G </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --time 3h</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the following example, the time is not limited and the size limit is set to 1 TB. The size limit determines the retention.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-retention my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --size 1T </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --time -1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the following example, the size is not limited and the time limit is set to 3 hours. The time limit determines the retention.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-retention my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --size -1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --time 3h</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To achieve infinite retention, set both values to <code>-1</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-retention my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --size -1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --time -1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To disable the retention policy, set both values to <code>0</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-retention my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --size </span><span class="token number">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --time </span><span class="token number">0</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/setRetention?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">POST /admin/v2/namespaces/:tenant/:namespace/retention</a></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>To disable the retention policy, you need to set both the size and time limit to <code>0</code>. Set either size or time limit to <code>0</code> is invalid.</p></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int retentionTime = 10; // 10 minutes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">int retentionSize = 500; // 500 megabytes</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RetentionPolicies policies = new RetentionPolicies(retentionTime, retentionSize);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().setRetention(namespace, policies);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="get-retention-policy"></a>Get retention policy<a class="hash-link" href="#get-retention-policy" title="Direct link to heading">#</a></h3><p>You can fetch the retention policy for a namespace by specifying the namespace. The output will be a JSON object with two keys: <code>retentionTimeInMinutes</code> and <code>retentionSizeInMB</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#namespaces"><code>get-retention</code></a> subcommand and specify the namespace.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces get-retention my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;retentionTimeInMinutes&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">10</span><span class="token plain">,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;retentionSizeInMB&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">500</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api"></a>REST API<a class="hash-link" href="#rest-api" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/getRetention?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">GET /admin/v2/namespaces/:tenant/:namespace/retention</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java"></a>Java<a class="hash-link" href="#java" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().getRetention(namespace);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="backlog-quotas"></a>Backlog quotas<a class="hash-link" href="#backlog-quotas" title="Direct link to heading">#</a></h2><p><em>Backlogs</em> are sets of unacknowledged messages for a topic that have been stored by bookies. Pulsar stores all unacknowledged messages in backlogs until they are processed and acknowledged.</p><p>You can control the allowable size of backlogs, at the namespace level, using <em>backlog quotas</em>. Setting a backlog quota involves setting:</p><p>TODO: Expand on is this per backlog or per topic?</p><ul><li>an allowable <em>size threshold</em> for each topic in the namespace</li><li>a <em>retention policy</em> that determines which action the <a href="/docs/2.7.1/reference-terminology#broker">broker</a> takes if the threshold is exceeded.</li></ul><p>The following retention policies are available:</p><table><thead><tr><th align="left">Policy</th><th align="left">Action</th></tr></thead><tbody><tr><td align="left"><code>producer_request_hold</code></td><td align="left">The broker will hold and not persist produce request payload</td></tr><tr><td align="left"><code>producer_exception</code></td><td align="left">The broker will disconnect from the client by throwing an exception</td></tr><tr><td align="left"><code>consumer_backlog_eviction</code></td><td align="left">The broker will begin discarding backlog messages</td></tr></tbody></table><blockquote><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="beware-the-distinction-between-retention-policy-types"></a>Beware the distinction between retention policy types<a class="hash-link" href="#beware-the-distinction-between-retention-policy-types" title="Direct link to heading">#</a></h4><p>As you may have noticed, there are two definitions of the term &quot;retention policy&quot; in Pulsar, one that applies to persistent storage of messages not in backlogs, and one that applies to messages within backlogs.</p></blockquote><p>Backlog quotas are handled at the namespace level. They can be managed via:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="set-size-thresholds-and-backlog-retention-policies"></a>Set size thresholds and backlog retention policies<a class="hash-link" href="#set-size-thresholds-and-backlog-retention-policies" title="Direct link to heading">#</a></h3><p>You can set a size threshold and backlog retention policy for all of the topics in a <a href="/docs/2.7.1/reference-terminology#namespace">namespace</a> by specifying the namespace, a size limit, and a policy by name.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-1"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-1" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#namespaces"><code>set-backlog-quota</code></a> subcommand and specify a namespace, a size limit using the <code>-l</code>/<code>--limit</code> flag, and a retention policy using the <code>-p</code>/<code>--policy</code> flag.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-1"></a>Example<a class="hash-link" href="#example-1" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-backlog-quota my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --limit 2G </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --policy producer_request_hold</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-1"></a>REST API<a class="hash-link" href="#rest-api-1" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/getBacklogQuotaMap?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">POST /admin/v2/namespaces/:tenant/:namespace/backlogQuota</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-1"></a>Java<a class="hash-link" href="#java-1" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">long sizeLimit = 2147483648L;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BacklogQuota.RetentionPolicy policy = BacklogQuota.RetentionPolicy.producer_request_hold;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">BacklogQuota quota = new BacklogQuota(sizeLimit, policy);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().setBacklogQuota(namespace, quota);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="get-backlog-threshold-and-backlog-retention-policy"></a>Get backlog threshold and backlog retention policy<a class="hash-link" href="#get-backlog-threshold-and-backlog-retention-policy" title="Direct link to heading">#</a></h3><p>You can see which size threshold and backlog retention policy has been applied to a namespace.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-2"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-2" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-get-backlog-quotas"><code>get-backlog-quotas</code></a> subcommand and specify a namespace. Here&#x27;s an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces get-backlog-quotas my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;destination_storage&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;limit&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token number">2147483648</span><span class="token plain">,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;policy&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;producer_request_hold&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-2"></a>REST API<a class="hash-link" href="#rest-api-2" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/getBacklogQuotaMap?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">GET /admin/v2/namespaces/:tenant/:namespace/backlogQuotaMap</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-2"></a>Java<a class="hash-link" href="#java-2" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Map&lt;BacklogQuota.BacklogQuotaType,BacklogQuota&gt; quotas =</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  admin.namespaces().getBacklogQuotas(namespace);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="remove-backlog-quotas"></a>Remove backlog quotas<a class="hash-link" href="#remove-backlog-quotas" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-3"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-3" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-remove-backlog-quota"><code>remove-backlog-quota</code></a> subcommand and specify a namespace. Here&#x27;s an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces remove-backlog-quota my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-3"></a>REST API<a class="hash-link" href="#rest-api-3" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/removeBacklogQuota?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">DELETE /admin/v2/namespaces/:tenant/:namespace/backlogQuota</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-3"></a>Java<a class="hash-link" href="#java-3" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().removeBacklogQuota(namespace);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="clear-backlog"></a>Clear backlog<a class="hash-link" href="#clear-backlog" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-4"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-4" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-clear-backlog"><code>clear-backlog</code></a> subcommand.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-2"></a>Example<a class="hash-link" href="#example-2" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces clear-backlog my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>By default, you will be prompted to ensure that you really want to clear the backlog for the namespace. You can override the prompt using the <code>-f</code>/<code>--force</code> flag.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="time-to-live-ttl"></a>Time to live (TTL)<a class="hash-link" href="#time-to-live-ttl" title="Direct link to heading">#</a></h2><p>By default, Pulsar stores all unacknowledged messages forever. This can lead to heavy disk space usage in cases where a lot of messages are going unacknowledged. If disk space is a concern, you can set a time to live (TTL) that determines how long unacknowledged messages will be retained.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="set-the-ttl-for-a-namespace"></a>Set the TTL for a namespace<a class="hash-link" href="#set-the-ttl-for-a-namespace" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-5"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-5" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-set-message-ttl"><code>set-message-ttl</code></a> subcommand and specify a namespace and a TTL (in seconds) using the <code>-ttl</code>/<code>--messageTTL</code> flag.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-3"></a>Example<a class="hash-link" href="#example-3" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces set-message-ttl my-tenant/my-ns </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  --messageTTL </span><span class="token number">120</span><span class="token plain"> </span><span class="token comment" style="color:rgb(98, 114, 164)"># TTL of 2 minutes</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-4"></a>REST API<a class="hash-link" href="#rest-api-4" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/setNamespaceMessageTTL?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">POST /admin/v2/namespaces/:tenant/:namespace/messageTTL</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-4"></a>Java<a class="hash-link" href="#java-4" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().setNamespaceMessageTTL(namespace, ttlInSeconds);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="get-the-ttl-configuration-for-a-namespace"></a>Get the TTL configuration for a namespace<a class="hash-link" href="#get-the-ttl-configuration-for-a-namespace" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-6"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-6" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-get-message-ttl"><code>get-message-ttl</code></a> subcommand and specify a namespace.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-4"></a>Example<a class="hash-link" href="#example-4" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces get-message-ttl my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token number">60</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-5"></a>REST API<a class="hash-link" href="#rest-api-5" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/getNamespaceMessageTTL?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">GET /admin/v2/namespaces/:tenant/:namespace/messageTTL</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-5"></a>Java<a class="hash-link" href="#java-5" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().getNamespaceMessageTTL(namespace)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="remove-the-ttl-configuration-for-a-namespace"></a>Remove the TTL configuration for a namespace<a class="hash-link" href="#remove-the-ttl-configuration-for-a-namespace" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="pulsar-admin-7"></a>pulsar-admin<a class="hash-link" href="#pulsar-admin-7" title="Direct link to heading">#</a></h4><p>Use the <a href="/docs/2.7.1/pulsar-admin#pulsar-admin-namespaces-remove-message-ttl"><code>remove-message-ttl</code></a> subcommand and specify a namespace.</p><h5><a aria-hidden="true" tabindex="-1" class="anchor anchor__h5 anchorWithStickyNavbar_31ik" id="example-5"></a>Example<a class="hash-link" href="#example-5" title="Direct link to heading">#</a></h5><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ pulsar-admin namespaces remove-message-ttl my-tenant/my-ns</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="rest-api-6"></a>REST API<a class="hash-link" href="#rest-api-6" title="Direct link to heading">#</a></h4><p><a href="https://pulsar.incubator.apache.org/admin-rest-api#operation/removeNamespaceMessageTTL?version=2.7.1&amp;apiVersion=v2" target="_blank" rel="noopener noreferrer">DELETE /admin/v2/namespaces/:tenant/:namespace/messageTTL</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-6"></a>Java<a class="hash-link" href="#java-6" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">admin.namespaces().removeNamespaceMessageTTL(namespace)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="delete-messages-from-namespaces"></a>Delete messages from namespaces<a class="hash-link" href="#delete-messages-from-namespaces" title="Direct link to heading">#</a></h2><p>If you do not have any retention period and that you never have much of a backlog, the upper limit for retaining messages, which are acknowledged, equals to the Pulsar segment rollover period + entry log rollover period + (garbage collection interval * garbage collection ratios).</p><ul><li><p><strong>Segment rollover period</strong>: basically, the segment rollover period is how often a new segment is created. Once a new segment is created, the old segment will be deleted. By default, this happens either when you have written 50,000 entries (messages) or have waited 240 minutes. You can tune this in your broker.</p></li><li><p><strong>Entry log rollover period</strong>: multiple ledgers in BookKeeper are interleaved into an <a href="https://bookkeeper.apache.org/docs/4.11.1/getting-started/concepts/#entry-logs" target="_blank" rel="noopener noreferrer">entry log</a>. In order for a ledger that has been deleted, the entry log must all be rolled over.
The entry log rollover period is configurable, but is purely based on the entry log size. For details, see <a href="https://bookkeeper.apache.org/docs/4.11.1/reference/config/#entry-log-settings" target="_blank" rel="noopener noreferrer">here</a>. Once the entry log is rolled over, the entry log can be garbage collected.</p></li><li><p><strong>Garbage collection interval</strong>: because entry logs have interleaved ledgers, to free up space, the entry logs need to be rewritten. The garbage collection interval is how often BookKeeper performs garbage collection. which is related to minor compaction and major compaction of entry logs. For details, see <a href="https://bookkeeper.apache.org/docs/4.11.1/reference/config/#entry-log-compaction-settings" target="_blank" rel="noopener noreferrer">here</a>.</p></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.7.1/cookbooks-retention-expiry.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7.1/cookbooks-non-persistent"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Non-persistent messaging</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7.1/cookbooks-encryption"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Encryption Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#retention-policies" class="table-of-contents__link">Retention policies</a><ul><li><a href="#defaults" class="table-of-contents__link">Defaults</a></li><li><a href="#set-retention-policy" class="table-of-contents__link">Set retention policy</a></li><li><a href="#get-retention-policy" class="table-of-contents__link">Get retention policy</a></li></ul></li><li><a href="#backlog-quotas" class="table-of-contents__link">Backlog quotas</a><ul><li><a href="#set-size-thresholds-and-backlog-retention-policies" class="table-of-contents__link">Set size thresholds and backlog retention policies</a></li><li><a href="#get-backlog-threshold-and-backlog-retention-policy" class="table-of-contents__link">Get backlog threshold and backlog retention policy</a></li><li><a href="#remove-backlog-quotas" class="table-of-contents__link">Remove backlog quotas</a></li><li><a href="#clear-backlog" class="table-of-contents__link">Clear backlog</a></li></ul></li><li><a href="#time-to-live-ttl" class="table-of-contents__link">Time to live (TTL)</a><ul><li><a href="#set-the-ttl-for-a-namespace" class="table-of-contents__link">Set the TTL for a namespace</a></li><li><a href="#get-the-ttl-configuration-for-a-namespace" class="table-of-contents__link">Get the TTL configuration for a namespace</a></li><li><a href="#remove-the-ttl-configuration-for-a-namespace" class="table-of-contents__link">Remove the TTL configuration for a namespace</a></li></ul></li><li><a href="#delete-messages-from-namespaces" class="table-of-contents__link">Delete messages from namespaces</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>