<!doctype html>
<html class="docs-version-2.7.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Package Pulsar Functions | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.7.1/functions-package"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.7.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.7.1"><meta data-react-helmet="true" property="og:title" content="Package Pulsar Functions | Apache Pulsar"><meta data-react-helmet="true" name="description" content="You can package Pulsar functions in Java, Python, and Go. Packaging the window function in Java is the same as packaging a function in Java."><meta data-react-helmet="true" property="og:description" content="You can package Pulsar functions in Java, Python, and Go. Packaging the window function in Java is the same as packaging a function in Java."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.7.1/functions-package"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/functions-package" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/functions-package" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.7.1/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts and Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Pulsar Functions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-runtime">Setup: Configure Functions runtime</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-develop">How-to: Develop</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.7.1/functions-package">How-to: Package</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-debug">How-to: Debug</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-deploy">How-to: Deploy</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/functions-cli">Reference: CLI</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/window-functions-context">Window Functions: Context</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tiered Storage</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transactions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cookbooks</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Pulsar <b>2.7.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/functions-package">latest version</a></b> (2.8.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.7.1</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Package Pulsar Functions</h1></header><p>You can package Pulsar functions in Java, Python, and Go. Packaging the window function in Java is the same as <a href="#java">packaging a function in Java</a>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Currently, the window function is not available in Python and Go.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisite"></a>Prerequisite<a class="hash-link" href="#prerequisite" title="Direct link to heading">#</a></h2><p>Before running a Pulsar function, you need to start Pulsar. You can <a href="/docs/2.7.1/standalone-docker">run a standalone Pulsar in Docker</a>, or <a href="/docs/2.7.1/getting-started-helm">run Pulsar in Kubernetes</a>.</p><p>To check whether the Docker image starts, you can use the <code>docker ps</code> command.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="java"></a>Java<a class="hash-link" href="#java" title="Direct link to heading">#</a></h2><p>To package a function in Java, complete the following steps.</p><ol><li><p>Create a new maven project with a pom file. In the following code sample, the value of <code>mainClass</code> is your package name.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly Java"><pre tabindex="0" class="prism-code language-Java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;groupId&gt;java-function&lt;/groupId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;artifactId&gt;java-function&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;dependencies&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;dependency&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;groupId&gt;org.apache.pulsar&lt;/groupId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;artifactId&gt;pulsar-functions-api&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;version&gt;2.6.0&lt;/version&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;/dependency&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/dependencies&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;build&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;plugins&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;plugin&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;appendAssemblyId&gt;false&lt;/appendAssemblyId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;descriptorRefs&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;/descriptorRefs&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;archive&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;manifest&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;mainClass&gt;org.example.test.ExclamationFunction&lt;/mainClass&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;/manifest&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;/archive&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;/configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;executions&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;execution&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;id&gt;make-assembly&lt;/id&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;phase&gt;package&lt;/phase&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;goals&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                            &lt;goal&gt;assembly&lt;/goal&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                        &lt;/goals&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;/execution&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;/executions&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;/plugin&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;plugin&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;source&gt;8&lt;/source&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                    &lt;target&gt;8&lt;/target&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                &lt;/configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            &lt;/plugin&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;/plugins&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/build&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/project&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Write a Java function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">package org.example.test;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.function.Function;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class ExclamationFunction implements Function&lt;String, String&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public String apply(String s) {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        return &quot;This is my function!&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p> For the imported package, you can use one of the following interfaces:</p><ul><li>Function interface provided by Java 8: <code>java.util.function.Function</code></li><li>Pulsar Function interface: <code>org.apache.pulsar.functions.api.Function</code></li></ul><p>The main difference between the two interfaces is that the <code>org.apache.pulsar.functions.api.Function</code> interface provides the context interface. When you write a function and want to interact with it, you can use context to obtain a wide variety of information and functionality for Pulsar Functions.</p><p>The following example uses <code>org.apache.pulsar.functions.api.Function</code> interface with context.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">package org.example.functions;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.functions.api.Context;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import org.apache.pulsar.functions.api.Function;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import java.util.Arrays;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">public class WordCountFunction implements Function&lt;String, Void&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   // This function is invoked every time a message is published to the input topic</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    @Override</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    public Void process(String input, Context context) throws Exception {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       Arrays.asList(input.split(&quot; &quot;)).forEach(word -&gt; {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           String counterKey = word.toLowerCase();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">           context.incrCounter(counterKey, 1);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        });</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">       return null;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Package the Java function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mvn package</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After the Java function is packaged, a <code>target</code> directory is created automatically. Open the <code>target</code> directory to check if there is a JAR package similar to <code>java-function-1.0-SNAPSHOT.jar</code>.</p></li></ol><ol start="4"><li><p>Run the Java function.</p><p> (1) Copy the packaged jar file to the Pulsar image.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">CONTAINER ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /bin/bash</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">path of java-function-1.0-SNAPSHOT.jar</span><span class="token operator">&gt;</span><span class="token plain">  CONTAINER ID:/pulsar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>(2) Run the Java function using the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-admin functions localrun </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--classname org.example.test.ExclamationFunction </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--jar java-function-1.0-SNAPSHOT.jar </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--inputs persistent://public/default/my-topic-1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--output persistent://public/default/test-1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--tenant public </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--namespace default </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--name JavaFunction</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following log indicates that the Java function starts successfully.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="python"></a>Python<a class="hash-link" href="#python" title="Direct link to heading">#</a></h2><p>Python Function supports the following three formats:</p><ul><li>One python file</li><li>ZIP file</li><li>PIP</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="one-python-file"></a>One python file<a class="hash-link" href="#one-python-file" title="Direct link to heading">#</a></h3><p>To package a function with <strong>one python file</strong> in Python, complete the following steps.</p><ol><li><p>Write a Python function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from pulsar import Function //  import the Function module from Pulsar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The classic ExclamationFunction that appends an exclamation at the end</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># of the input</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ExclamationFunction(Function):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  def __init__(self):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pass</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  def process(self, input, context):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return input + &#x27;!&#x27;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this example, when you write a Python function, you need to inherit the Function class and implement the <code>process()</code> method.</p><p><code>process()</code> mainly has two parameters: </p><ul><li><p><code>input</code> represents your input.</p></li><li><p><code>context</code> represents an interface exposed by the Pulsar Function. You can get the attributes in the Python function based on the provided context object.</p></li></ul></li><li><p>Install a Python client.</p><p>The implementation of a Python function depends on the Python client, so before deploying a Python function, you need to install the corresponding version of the Python client. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pip </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><span class="token plain"> pulsar-client</span><span class="token operator">==</span><span class="token number">2.6</span><span class="token plain">.0</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Run the Python Function.</p><p>(1) Copy the Python function file to the Pulsar image.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">CONTAINER ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /bin/bash</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">path of Python </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> file</span><span class="token operator">&gt;</span><span class="token plain">  CONTAINER ID:/pulsar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>(2) Run the Python function using the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-admin functions localrun </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--classname </span><span class="token operator">&lt;</span><span class="token plain">Python Function </span><span class="token function" style="color:rgb(80, 250, 123)">file</span><span class="token plain"> name</span><span class="token operator">&gt;</span><span class="token plain">.</span><span class="token operator">&lt;</span><span class="token plain">Python Function class name</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--py </span><span class="token operator">&lt;</span><span class="token plain">path of Python Function file</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--inputs persistent://public/default/my-topic-1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--output persistent://public/default/test-1 </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--tenant public </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--namespace default </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--name PythonFunction</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following log indicates that the Python function starts successfully.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="zip-file"></a>ZIP file<a class="hash-link" href="#zip-file" title="Direct link to heading">#</a></h3><p>To package a function with the <strong>ZIP file</strong> in Python, complete the following steps.</p><ol><li><p>Prepare the ZIP file.</p><p>The following is required when packaging the ZIP file of the Python Function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Assuming the zip file is named as `func.zip`, unzip the `func.zip` folder:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;func/src&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;func/requirements.txt&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;func/deps&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Take <a href="https://github.com/apache/pulsar/tree/master/tests/docker-images/latest-version-image/python-examples" target="_blank" rel="noopener noreferrer">exclamation.zip</a> as an example. The internal structure of the example is as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”œâ”€â”€ deps</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â”‚Â Â  â””â”€â”€ sh-1.12.14-py2.py3-none-any.whl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">â””â”€â”€ src</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    â””â”€â”€ exclamation.py</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Run the Python Function.</p><p>(1) Copy the ZIP file to the Pulsar image.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">CONTAINER ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /bin/bash</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">path of ZIP file</span><span class="token operator">&gt;</span><span class="token plain">  CONTAINER ID:/pulsar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>(2) Run the Python function using the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-admin functions localrun </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--classname exclamation </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--py </span><span class="token operator">&lt;</span><span class="token plain">path of ZIP file</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--inputs persistent://public/default/in-topic </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--output persistent://public/default/out-topic </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--tenant public </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--namespace default </span><span class="token punctuation" style="color:rgb(248, 248, 242)">\</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">--name PythonFunction</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following log indicates that the Python function starts successfully.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="pip"></a>PIP<a class="hash-link" href="#pip" title="Direct link to heading">#</a></h3><p>The PIP method is only supported in Kubernetes runtime. To package a function with <strong>PIP</strong> in Python, complete the following steps.</p><ol><li><p>Configure the <code>functions_worker.yml</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">#### Kubernetes Runtime ####</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">installUserCodeDependencies: true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Write your Python Function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">from pulsar import Function</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import js2xml</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># The classic ExclamationFunction that appends an exclamation at the end</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># of the input</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">class ExclamationFunction(Function):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> def __init__(self):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   pass</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> def process(self, input, context):</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  // add your logic</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  return input + &#x27;!&#x27;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can introduce additional dependencies. When Python Function detects that the file currently used is <code>whl</code> and the <code>installUserCodeDependencies</code> parameter is specified, the system uses the <code>pip install</code> command to install the dependencies required in Python Function.</p></li><li><p>Generate the <code>whl</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> </span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$PULSAR_HOME</span><span class="token plain">/pulsar-functions/scripts/python</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ </span><span class="token function" style="color:rgb(80, 250, 123)">chmod</span><span class="token plain"> +x generate.sh</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./generate.sh </span><span class="token operator">&lt;</span><span class="token plain">path of your Python Function</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">path of the whl output dir</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">the version of whl</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)"># e.g: ./generate.sh /path/to/python /path/to/python/output 1.0.0</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The output is written in <code>/path/to/python/output</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--  1 root  staff   1.8K  8 27 14:29 pulsarfunction-1.0.0-py2-none-any.whl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--  1 root  staff   1.4K  8 27 14:29 pulsarfunction-1.0.0.tar.gz</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-rw-r--r--  1 root  staff     0B  8 27 14:29 pulsarfunction.whl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="go"></a>Go<a class="hash-link" href="#go" title="Direct link to heading">#</a></h2><p>To package a function in Go, complete the following steps.</p><ol><li><p>Write a Go function.</p><p>Currently, Go function can be <strong>only</strong> implemented using SDK and the interface of the function is exposed in the form of SDK. Before using the Go function, you need to import &quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">import (</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;context&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;fmt&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func HandleRequest(ctx context.Context, input []byte) error {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fmt.Println(string(input) + &quot;!&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    return nil</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">func main() {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    pf.Start(HandleRequest)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can use context to connect to the Go function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if fc, ok := pf.FromContext(ctx); ok {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fmt.Printf(&quot;function ID is:%s, &quot;, fc.GetFuncID())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fmt.Printf(&quot;function version is:%s\n&quot;, fc.GetFuncVersion())</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When writing a Go function, remember that</p><ul><li><p>In <code>main()</code>, you <strong>only</strong> need to register the function name to <code>Start()</code>. <strong>Only</strong> one function name is received in <code>Start()</code>. </p></li><li><p>Go function uses Go reflection, which is based on the received function name, to verify whether the parameter list and returned value list are correct. The parameter list and returned value list <strong>must be</strong> one of the following sample functions:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func ()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func () error</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (input) error</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func () (output, error)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (input) (output, error)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (context.Context) error</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (context.Context, input) error</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (context.Context) (output, error)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> func (context.Context, input) (output, error)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li><li><p>Build the Go function.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">go build &lt;your Go Function filename&gt;.go</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Run the Go Function.</p><p>(1) Copy the Go function file to the Pulsar image.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">exec</span><span class="token plain"> -it </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token plain">CONTAINER ID</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> /bin/bash</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">docker </span><span class="token function" style="color:rgb(80, 250, 123)">cp</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">your go </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">function</span><span class="token plain"> path</span><span class="token operator">&gt;</span><span class="token plain">  CONTAINER ID:/pulsar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>(2) Run the Go function with the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-admin functions localrun \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --go [your go function path] </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --inputs [input topics] \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --output [output topic] \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --tenant [default:public] \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --namespace [default:default] \</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --name [custom unique go function name]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The following log indicates that the Go function starts successfully.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">07:55:03.724 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">...</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="start-functions-in-cluster-mode"></a>Start Functions in cluster mode<a class="hash-link" href="#start-functions-in-cluster-mode" title="Direct link to heading">#</a></h2><p>If you want to start a function in cluster mode, replace <code>localrun</code> with <code>create</code> in the commands above. The following log indicates that your function starts successfully.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly text"><pre tabindex="0" class="prism-code language-text codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  &quot;Created successfully&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For information about parameters on <code>--classname</code>, <code>--jar</code>, <code>--py</code>, <code>--go</code>, <code>--inputs</code>, run the command <code>./bin/pulsar-admin functions</code> or see <a href="/docs/2.7.1/pulsar-admin#functions">here</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.7.1/functions-package.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7.1/functions-develop"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« How-to: Develop</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7.1/functions-debug"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How-to: Debug Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisite" class="table-of-contents__link">Prerequisite</a></li><li><a href="#java" class="table-of-contents__link">Java</a></li><li><a href="#python" class="table-of-contents__link">Python</a><ul><li><a href="#one-python-file" class="table-of-contents__link">One python file</a></li><li><a href="#zip-file" class="table-of-contents__link">ZIP file</a></li><li><a href="#pip" class="table-of-contents__link">PIP</a></li></ul></li><li><a href="#go" class="table-of-contents__link">Go</a></li><li><a href="#start-functions-in-cluster-mode" class="table-of-contents__link">Start Functions in cluster mode</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>