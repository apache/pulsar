<!doctype html>
<html class="docs-version-2.7.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Authentication using Kerberos | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.7.1/security-kerberos"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.7.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.7.1"><meta data-react-helmet="true" property="og:title" content="Authentication using Kerberos | Apache Pulsar"><meta data-react-helmet="true" name="description" content="Kerberos is a network authentication protocol. By using secret-key cryptography, Kerberos is designed to provide strong authentication for client applications and server applications."><meta data-react-helmet="true" property="og:description" content="Kerberos is a network authentication protocol. By using secret-key cryptography, Kerberos is designed to provide strong authentication for client applications and server applications."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.7.1/security-kerberos"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/security-kerberos" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/security-kerberos" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.7.1/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts and Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tiered Storage</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transactions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Security</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-tls-transport">Transport Encryption using TLS</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-tls-authentication">Authentication using TLS</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-jwt">Authentication using JWT</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-athenz">Authentication using Athenz</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.7.1/security-kerberos">Authentication using Kerberos</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-oauth2">Authentication using OAuth 2.0 access tokens</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-authorization">Authorization and ACLs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-encryption">End-to-End Encryption</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-extending">Extending</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cookbooks</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Pulsar <b>2.7.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/security-kerberos">latest version</a></b> (2.8.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.7.1</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Authentication using Kerberos</h1></header><p><a href="https://web.mit.edu/kerberos/" target="_blank" rel="noopener noreferrer">Kerberos</a> is a network authentication protocol. By using secret-key cryptography, <a href="https://web.mit.edu/kerberos/" target="_blank" rel="noopener noreferrer">Kerberos</a> is designed to provide strong authentication for client applications and server applications. </p><p>In Pulsar, you can use Kerberos with <a href="https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer" target="_blank" rel="noopener noreferrer">SASL</a> as a choice for authentication. And Pulsar uses the <a href="https://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service" target="_blank" rel="noopener noreferrer">Java Authentication and Authorization Service (JAAS)</a> for SASL configuration. You need to provide JAAS configurations for Kerberos authentication. </p><p>This document introduces how to configure <code>Kerberos</code> with <code>SASL</code> between Pulsar clients and brokers and how to configure Kerberos for Pulsar proxy in detail.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-for-kerberos-between-client-and-broker"></a>Configuration for Kerberos between Client and Broker<a class="hash-link" href="#configuration-for-kerberos-between-client-and-broker" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p>To begin, you need to set up (or already have) a <a href="https://en.wikipedia.org/wiki/Key_distribution_center" target="_blank" rel="noopener noreferrer">Key Distribution Center(KDC)</a>. Also you need to configure and run the <a href="https://en.wikipedia.org/wiki/Key_distribution_center" target="_blank" rel="noopener noreferrer">Key Distribution Center(KDC)</a>in advance. </p><p>If your organization already uses a Kerberos server (for example, by using <code>Active Directory</code>), you do not have to install a new server for Pulsar. If your organization does not use a Kerberos server, you need to install one. Your Linux vendor might have packages for <code>Kerberos</code>. On how to install and configure Kerberos, refer to <a href="https://help.ubuntu.com/community/Kerberos" target="_blank" rel="noopener noreferrer">Ubuntu</a>,
<a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Managing_Smart_Cards/installing-kerberos.html" target="_blank" rel="noopener noreferrer">Redhat</a>.</p><p>Note that if you use Oracle Java, you need to download JCE policy files for your Java version and copy them to the <code>$JAVA_HOME/jre/lib/security</code> directory.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="kerberos-principals"></a>Kerberos principals<a class="hash-link" href="#kerberos-principals" title="Direct link to heading">#</a></h4><p>If you use the existing Kerberos system, ask your Kerberos administrator for a principal for each Brokers in your cluster and for every operating system user that accesses Pulsar with Kerberos authentication(via clients and tools).</p><p>If you have installed your own Kerberos system, you can create these principals with the following commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">### add Principals for broker</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;addprinc -randkey broker/{hostname}@{REALM}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ktadd -k /etc/security/keytabs/{broker-keytabname}.keytab broker/{hostname}@{REALM}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">### add Principals for client</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;addprinc -randkey client/{hostname}@{REALM}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ktadd -k /etc/security/keytabs/{client-keytabname}.keytab client/{hostname}@{REALM}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that <em>Kerberos</em> requires that all your hosts can be resolved with their FQDNs.</p><p>The first part of Broker principal (for example, <code>broker</code> in <code>broker/{hostname}@{REALM}</code>) is the <code>serverType</code> of each host. The suggested values of <code>serverType</code> are <code>broker</code> (host machine runs service Pulsar Broker) and <code>proxy</code> (host machine runs service Pulsar Proxy). </p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="configure-how-to-connect-to-kdc"></a>Configure how to connect to KDC<a class="hash-link" href="#configure-how-to-connect-to-kdc" title="Direct link to heading">#</a></h4><p>You need to enter the command below to specify the path to the <code>krb5.conf</code> file for the client side and the broker side. The content of <code>krb5.conf</code> file indicates the default Realm and KDC information. See <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/security/jgss/tutorials/KerberosReq.html" target="_blank" rel="noopener noreferrer">JDKâ€™s Kerberos Requirements</a> for more details.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">-Djava.security.krb5.conf</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/krb5.conf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here is an example of the krb5.conf file:</p><p>In the configuration file, <code>EXAMPLE.COM</code> is the default realm; <code>kdc = localhost:62037</code> is the kdc server url for realm <code>EXAMPLE.COM </code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[libdefaults]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> default_realm = EXAMPLE.COM</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[realms]</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> EXAMPLE.COM  = {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  kdc = localhost:62037</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> }</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Usually machines configured with kerberos already have a system wide configuration and this configuration is optional.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="jaas-configuration-file"></a>JAAS configuration file<a class="hash-link" href="#jaas-configuration-file" title="Direct link to heading">#</a></h4><p>You need JAAS configuration file for the client side and the broker side. JAAS configuration file provides the section of information that is used to connect KDC. Here is an example named <code>pulsar_jaas.conf</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PulsarBroker {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarbroker.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;broker/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PulsarClient {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarclient.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;client/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You need to set the <code>JAAS</code> configuration file path as JVM parameter for client and broker. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    -Djava.security.auth.login.config</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/pulsar_jaas.conf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the <code>pulsar_jaas.conf</code> file above </p><ol><li><code>PulsarBroker</code> is a section name in the JAAS file that each broker uses. This section tells the broker to use which principal inside Kerberos and the location of the keytab where the principal is stored. <code>PulsarBroker</code> allows the broker to use the keytab specified in this section.</li><li><code>PulsarClient</code> is a section name in the JASS file that each broker uses. This section tells the client to use which principal inside Kerberos and the location of the keytab where the principal is stored. <code>PulsarClient</code> allows the client to use the keytab specified in this section.
The following example also reuses this <code>PulsarClient</code> section in both the Pulsar internal admin configuration and in CLI command of <code>bin/pulsar-client</code>, <code>bin/pulsar-perf</code> and <code>bin/pulsar-admin</code>. You can also add different sections for different use cases.</li></ol><p>You can have 2 separate JAAS configuration files: </p><ul><li>the file for a broker that has sections of both <code>PulsarBroker</code> and <code>PulsarClient</code>; </li><li>the file for a client that only has a <code>PulsarClient</code> section.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kerberos-configuration-for-brokers"></a>Kerberos configuration for Brokers<a class="hash-link" href="#kerberos-configuration-for-brokers" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="configure-the-brokerconf-file"></a>Configure the <code>broker.conf</code> file<a class="hash-link" href="#configure-the-brokerconf-file" title="Direct link to heading">#</a></h4><p> In the <code>broker.conf</code> file, set Kerberos related configurations.</p><ul><li><p>Set <code>authenticationEnabled</code> to <code>true</code>;</p></li><li><p>Set <code>authenticationProviders</code> to choose <code>AuthenticationProviderSasl</code>;</p></li><li><p>Set <code>saslJaasClientAllowedIds</code> regex for principal that is allowed to connect to broker;</p></li><li><p>Set <code>saslJaasBrokerSectionName</code> that corresponds to the section in JAAS configuration file for broker;</p><p>To make Pulsar internal admin client work properly, you need to set the configuration in the <code>broker.conf</code> file as below: </p></li><li><p>Set <code>brokerClientAuthenticationPlugin</code> to client plugin <code>AuthenticationSasl</code>;</p></li><li><p>Set <code>brokerClientAuthenticationParameters</code> to value in JSON string <code>{&quot;saslJaasClientSectionName&quot;:&quot;PulsarClient&quot;, &quot;serverType&quot;:&quot;broker&quot;}</code>, in which <code>PulsarClient</code> is the section name in the <code>pulsar_jaas.conf</code> file, and <code>&quot;serverType&quot;:&quot;broker&quot;</code> indicates that the internal admin client connects to a Pulsar Broker;</p><p>Here is an example:</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationEnabled=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">saslJaasClientAllowedIds=.*client.*</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">saslJaasBrokerSectionName=PulsarBroker</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">## Authentication settings of the broker itself. Used when the broker connects to other brokers</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientAuthenticationPlugin=org.apache.pulsar.client.impl.auth.AuthenticationSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brokerClientAuthenticationParameters={&quot;saslJaasClientSectionName&quot;:&quot;PulsarClient&quot;, &quot;serverType&quot;:&quot;broker&quot;}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="set-broker-jvm-parameter"></a>Set Broker JVM parameter<a class="hash-link" href="#set-broker-jvm-parameter" title="Direct link to heading">#</a></h4><p> Set JVM parameters for JAAS configuration file and krb5 configuration file with additional options.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   -Djava.security.auth.login.config</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/pulsar_jaas.conf -Djava.security.krb5.conf</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/krb5.conf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can add this at the end of <code>PULSAR_EXTRA_OPTS</code> in the file <a href="https://github.com/apache/pulsar/blob/master/conf/pulsar_env.sh" target="_blank" rel="noopener noreferrer"><code>pulsar_env.sh</code></a></p><p>You must ensure that the operating system user who starts broker can reach the keytabs configured in the <code>pulsar_jaas.conf</code> file and kdc server in the <code>krb5.conf</code> file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kerberos-configuration-for-clients"></a>Kerberos configuration for clients<a class="hash-link" href="#kerberos-configuration-for-clients" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="java-client-and-java-admin-client"></a>Java Client and Java Admin Client<a class="hash-link" href="#java-client-and-java-admin-client" title="Direct link to heading">#</a></h4><p>In client application, include <code>pulsar-client-auth-sasl</code> in your project dependency.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;dependency&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;groupId&gt;org.apache.pulsar&lt;/groupId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;artifactId&gt;pulsar-client-auth-sasl&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">      &lt;version&gt;${pulsar.version}&lt;/version&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/dependency&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Configure the authentication type to use <code>AuthenticationSasl</code>, and also provide the authentication parameters to it. </p><p>You need 2 parameters: </p><ul><li><code>saslJaasClientSectionName</code>. This parameter corresponds to the section in JAAS configuration file for client; </li><li><code>serverType</code>. This parameter stands for whether this client connects to broker or proxy. And client uses this parameter to know which server side principal should be used. </li></ul><p>When you authenticate between client and broker with the setting in above JAAS configuration file, we need to set <code>saslJaasClientSectionName</code> to <code>PulsarClient</code> and set <code>serverType</code> to <code>broker</code>.</p><p>The following is an example of creating a Java client:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">System.setProperty(&quot;java.security.auth.login.config&quot;, &quot;/etc/pulsar/pulsar_jaas.conf&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">System.setProperty(&quot;java.security.krb5.conf&quot;, &quot;/etc/pulsar/krb5.conf&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Map&lt;String, String&gt; authParams = Maps.newHashMap();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authParams.put(&quot;saslJaasClientSectionName&quot;, &quot;PulsarClient&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authParams.put(&quot;serverType&quot;, &quot;broker&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Authentication saslAuth = AuthenticationFactory</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .create(org.apache.pulsar.client.impl.auth.AuthenticationSasl.class.getName(), authParams);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient client = PulsarClient.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .serviceUrl(&quot;pulsar://my-broker.com:6650&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .authentication(saslAuth)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>The first two lines in the example above are hard coded, alternatively, you can set additional JVM parameters for JAAS and krb5 configuration file when you run the application like below:</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">java -cp -Djava.security.auth.login.config=/etc/pulsar/pulsar_jaas.conf -Djava.security.krb5.conf=/etc/pulsar/krb5.conf $APP-jar-with-dependencies.jar $CLASSNAME</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You must ensure that the operating system user who starts pulsar client can reach the keytabs configured in the <code>pulsar_jaas.conf</code> file and kdc server in the <code>krb5.conf</code> file.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="configure-cli-tools"></a>Configure CLI tools<a class="hash-link" href="#configure-cli-tools" title="Direct link to heading">#</a></h4><p>If you use a command-line tool (such as <code>bin/pulsar-client</code>, <code>bin/pulsar-perf</code> and <code>bin/pulsar-admin</code>), you need to perform the following steps:</p><p>Step 1. Enter the command below to configure your <code>client.conf</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">authPlugin</span><span class="token operator">=</span><span class="token plain">org.apache.pulsar.client.impl.auth.AuthenticationSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">authParams</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;saslJaasClientSectionName&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PulsarClient&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;serverType&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;broker&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Step 2. Enter the command below to set JVM parameters for JAAS configuration file and krb5 configuration file with additional options.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   -Djava.security.auth.login.config</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/pulsar_jaas.conf -Djava.security.krb5.conf</span><span class="token operator">=</span><span class="token plain">/etc/pulsar/krb5.conf</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can add this at the end of <code>PULSAR_EXTRA_OPTS</code> in the file <a href="https://github.com/apache/pulsar/blob/master/conf/pulsar_tools_env.sh" target="_blank" rel="noopener noreferrer"><code>pulsar_tools_env.sh</code></a>,
or add this line <code>OPTS=&quot;$OPTS -Djava.security.auth.login.config=/etc/pulsar/pulsar_jaas.conf -Djava.security.krb5.conf=/etc/pulsar/krb5.conf &quot;</code> directly to the CLI tool script.</p><p>The meaning of configurations is the same as the meaning of configurations in Java client section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="kerberos-configuration-for-working-with-pulsar-proxy"></a>Kerberos configuration for working with Pulsar Proxy<a class="hash-link" href="#kerberos-configuration-for-working-with-pulsar-proxy" title="Direct link to heading">#</a></h2><p>With the above configuration, client and broker can do authentication using Kerberos.  </p><p>A client that connects to Pulsar Proxy is a little different. Pulsar Proxy (as a SASL Server in Kerberos) authenticates Client (as a SASL client in Kerberos) first; and then Pulsar broker authenticates Pulsar Proxy. </p><p>Now in comparison with the above configuration between client and broker, we show you how to configure Pulsar Proxy as follows. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-principal-for-pulsar-proxy-in-kerberos"></a>Create principal for Pulsar Proxy in Kerberos<a class="hash-link" href="#create-principal-for-pulsar-proxy-in-kerberos" title="Direct link to heading">#</a></h3><p>You need to add new principals for Pulsar Proxy comparing with the above configuration. If you already have principals for client and broker, you only need to add the proxy principal here.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">### add Principals for Pulsar Proxy</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;addprinc -randkey proxy/{hostname}@{REALM}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ktadd -k /etc/security/keytabs/{proxy-keytabname}.keytab proxy/{hostname}@{REALM}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">### add Principals for broker</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;addprinc -randkey broker/{hostname}@{REALM}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ktadd -k /etc/security/keytabs/{broker-keytabname}.keytab broker/{hostname}@{REALM}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">### add Principals for client</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;addprinc -randkey client/{hostname}@{REALM}&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> /usr/sbin/kadmin.local -q </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;ktadd -k /etc/security/keytabs/{client-keytabname}.keytab client/{hostname}@{REALM}&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="add-a-section-in-jaas-configuration-file-for-pulsar-proxy"></a>Add a section in JAAS configuration file for Pulsar Proxy<a class="hash-link" href="#add-a-section-in-jaas-configuration-file-for-pulsar-proxy" title="Direct link to heading">#</a></h3><p>In comparison with the above configuration, add a new section for Pulsar Proxy in JAAS configuration file.</p><p>Here is an example named <code>pulsar_jaas.conf</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PulsarBroker {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarbroker.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;broker/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PulsarProxy {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarproxy.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;proxy/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> PulsarClient {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarclient.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;client/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="proxy-client-configuration"></a>Proxy client configuration<a class="hash-link" href="#proxy-client-configuration" title="Direct link to heading">#</a></h3><p>Pulsar client configuration is similar with client and broker configuration, except that you need to set <code>serverType</code> to <code>proxy</code> instead of <code>broker</code>, for the reason that you need to do the Kerberos authentication between client and proxy.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">System.setProperty(&quot;java.security.auth.login.config&quot;, &quot;/etc/pulsar/pulsar_jaas.conf&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">System.setProperty(&quot;java.security.krb5.conf&quot;, &quot;/etc/pulsar/krb5.conf&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Map&lt;String, String&gt; authParams = Maps.newHashMap();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authParams.put(&quot;saslJaasClientSectionName&quot;, &quot;PulsarClient&quot;);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authParams.put(&quot;serverType&quot;, &quot;proxy&quot;);        // ** here is the different **</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Authentication saslAuth = AuthenticationFactory</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .create(org.apache.pulsar.client.impl.auth.AuthenticationSasl.class.getName(), authParams);</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">PulsarClient client = PulsarClient.builder()</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .serviceUrl(&quot;pulsar://my-broker.com:6650&quot;)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .authentication(saslAuth)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        .build();</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><blockquote><p>The first two lines in the example above are hard coded, alternatively, you can set additional JVM parameters for JAAS and krb5 configuration file when you run the application like below:</p></blockquote><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">java -cp -Djava.security.auth.login.config=/etc/pulsar/pulsar_jaas.conf -Djava.security.krb5.conf=/etc/pulsar/krb5.conf $APP-jar-with-dependencies.jar $CLASSNAME</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kerberos-configuration-for-pulsar-proxy-service"></a>Kerberos configuration for Pulsar proxy service<a class="hash-link" href="#kerberos-configuration-for-pulsar-proxy-service" title="Direct link to heading">#</a></h3><p>In the <code>proxy.conf</code> file, set Kerberos related configuration. Here is an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## related to authenticate client.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">authenticationEnabled</span><span class="token operator">=</span><span class="token plain">true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">authenticationProviders</span><span class="token operator">=</span><span class="token plain">org.apache.pulsar.broker.authentication.AuthenticationProviderSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">saslJaasClientAllowedIds</span><span class="token operator">=</span><span class="token plain">.*client.*</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">saslJaasBrokerSectionName</span><span class="token operator">=</span><span class="token plain">PulsarProxy</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">## related to be authenticated by broker</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">brokerClientAuthenticationPlugin</span><span class="token operator">=</span><span class="token plain">org.apache.pulsar.client.impl.auth.AuthenticationSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">brokerClientAuthenticationParameters</span><span class="token operator">=</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;saslJaasClientSectionName&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;PulsarProxy&quot;</span><span class="token plain">, </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;serverType&quot;</span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">:</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;broker&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">forwardAuthorizationCredentials</span><span class="token operator">=</span><span class="token plain">true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first part relates to authenticating between client and Pulsar Proxy. In this phase, client works as SASL client, while Pulsar Proxy works as SASL server. </p><p>The second part relates to authenticating between Pulsar Proxy and Pulsar Broker. In this phase, Pulsar Proxy works as SASL client, while Pulsar Broker works as SASL server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="broker-side-configuration"></a>Broker side configuration.<a class="hash-link" href="#broker-side-configuration" title="Direct link to heading">#</a></h3><p>The broker side configuration file is the same with the above <code>broker.conf</code>, you do not need special configuration for Pulsar Proxy.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationEnabled=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderSasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">saslJaasClientAllowedIds=.*client.*</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">saslJaasBrokerSectionName=PulsarBroker</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="regarding-authorization-and-role-token"></a>Regarding authorization and role token<a class="hash-link" href="#regarding-authorization-and-role-token" title="Direct link to heading">#</a></h2><p>For Kerberos authentication, we usually use the authenticated principal as the role token for Pulsar authorization. For more information of authorization in Pulsar, see <a href="/docs/2.7.1/security-authorization">security authorization</a>.</p><p>If you enable &#x27;authorizationEnabled&#x27;, you need to set <code>superUserRoles</code> in <code>broker.conf</code> that corresponds to the name registered in kdc.</p><p>For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(189, 147, 249);font-style:italic">superUserRoles</span><span class="token operator">=</span><span class="token plain">client/</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">clientIp</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain">@EXAMPLE.COM</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="regarding-authentication-between-zookeeper-and-broker"></a>Regarding authentication between ZooKeeper and Broker<a class="hash-link" href="#regarding-authentication-between-zookeeper-and-broker" title="Direct link to heading">#</a></h2><p>Pulsar Broker acts as a Kerberos client when you authenticate with Zookeeper. According to <a href="https://cwiki.apache.org/confluence/display/ZOOKEEPER/Client-Server+mutual+authentication" target="_blank" rel="noopener noreferrer">ZooKeeper document</a>, you need these settings in <code>conf/zookeeper.conf</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">requireClientAuthScheme=sasl</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Enter the following commands to add a section of <code>Client</code> configurations in the file <code>pulsar_jaas.conf</code>, which Pulsar Broker uses:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> Client {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarbroker.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;broker/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this setting, the principal of Pulsar Broker and keyTab file indicates the role of Broker when you authenticate with ZooKeeper.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="regarding-authentication-between-bookkeeper-and-broker"></a>Regarding authentication between BookKeeper and Broker<a class="hash-link" href="#regarding-authentication-between-bookkeeper-and-broker" title="Direct link to heading">#</a></h2><p>Pulsar Broker acts as a Kerberos client when you authenticate with Bookie. According to <a href="http://bookkeeper.apache.org/docs/latest/security/sasl/" target="_blank" rel="noopener noreferrer">BookKeeper document</a>, you need to add <code>bookkeeperClientAuthenticationPlugin</code> parameter in <code>broker.conf</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">bookkeeperClientAuthenticationPlugin=org.apache.bookkeeper.sasl.SASLClientProviderFactory</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this setting, <code>SASLClientProviderFactory</code> creates a BookKeeper SASL client in a Broker, and the Broker uses the created SASL client to authenticate with a Bookie node.</p><p>Enter the following commands to add a section of <code>BookKeeper</code> configurations in the <code>pulsar_jaas.conf</code> that Pulsar Broker uses:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"> BookKeeper {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   com.sun.security.auth.module.Krb5LoginModule required</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useKeyTab=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   storeKey=true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   useTicketCache=false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   keyTab=&quot;/etc/security/keytabs/pulsarbroker.keytab&quot;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">   principal=&quot;broker/localhost@EXAMPLE.COM&quot;;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">};</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In this setting, the principal of Pulsar Broker and keyTab file indicates the role of Broker when you authenticate with Bookie.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.7.1/security-kerberos.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7.1/security-athenz"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Authentication using Athenz</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7.1/security-oauth2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Authentication using OAuth 2.0 access tokens Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#configuration-for-kerberos-between-client-and-broker" class="table-of-contents__link">Configuration for Kerberos between Client and Broker</a><ul><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#kerberos-configuration-for-brokers" class="table-of-contents__link">Kerberos configuration for Brokers</a></li><li><a href="#kerberos-configuration-for-clients" class="table-of-contents__link">Kerberos configuration for clients</a></li></ul></li><li><a href="#kerberos-configuration-for-working-with-pulsar-proxy" class="table-of-contents__link">Kerberos configuration for working with Pulsar Proxy</a><ul><li><a href="#create-principal-for-pulsar-proxy-in-kerberos" class="table-of-contents__link">Create principal for Pulsar Proxy in Kerberos</a></li><li><a href="#add-a-section-in-jaas-configuration-file-for-pulsar-proxy" class="table-of-contents__link">Add a section in JAAS configuration file for Pulsar Proxy</a></li><li><a href="#proxy-client-configuration" class="table-of-contents__link">Proxy client configuration</a></li><li><a href="#kerberos-configuration-for-pulsar-proxy-service" class="table-of-contents__link">Kerberos configuration for Pulsar proxy service</a></li><li><a href="#broker-side-configuration" class="table-of-contents__link">Broker side configuration.</a></li></ul></li><li><a href="#regarding-authorization-and-role-token" class="table-of-contents__link">Regarding authorization and role token</a></li><li><a href="#regarding-authentication-between-zookeeper-and-broker" class="table-of-contents__link">Regarding authentication between ZooKeeper and Broker</a></li><li><a href="#regarding-authentication-between-bookkeeper-and-broker" class="table-of-contents__link">Regarding authentication between BookKeeper and Broker</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>