<!doctype html>
<html class="docs-version-2.7.1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Pulsar Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Pulsar Blog Atom Feed"><title data-react-helmet="true">Use filesystem offloader with Pulsar | Apache Pulsar</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pulsar.apache.com/docs/2.7.1/tiered-storage-filesystem"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.7.1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.7.1"><meta data-react-helmet="true" property="og:title" content="Use filesystem offloader with Pulsar | Apache Pulsar"><meta data-react-helmet="true" name="description" content="This chapter guides you through every step of installing and configuring the filesystem offloader and using it with Pulsar."><meta data-react-helmet="true" property="og:description" content="This chapter guides you through every step of installing and configuring the filesystem offloader and using it with Pulsar."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://pulsar.apache.com/docs/2.7.1/tiered-storage-filesystem"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/tiered-storage-filesystem" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pulsar.apache.com/docs/2.7.1/tiered-storage-filesystem" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4a6b6be2.css">
<link rel="preload" href="/assets/js/runtime~main.668ae9d7.js" as="script">
<link rel="preload" href="/assets/js/main.3d3de418.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Apache Pulsar" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title"></b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/2.7.1/">Docs</a><a class="navbar__item navbar__link" href="/versions">Versions</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/apache/pulsar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/docs">Version</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/">2.8.0</a></li><li><a class="dropdown__link" href="/docs/2.7.3/">2.7.3</a></li><li><a class="dropdown__link" href="/docs/2.7.2/">2.7.2</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/2.7.1/">2.7.1</a></li><li><a class="dropdown__link" href="/docs/2.7.0/">2.7.0</a></li><li><a class="dropdown__link" href="/docs/2.6.4/">2.6.4</a></li><li><a class="dropdown__link" href="/docs/2.6.3/">2.6.3</a></li><li><a class="dropdown__link" href="/docs/2.6.2/">2.6.2</a></li><li><a class="dropdown__link" href="/docs/2.2.0/">2.2.0</a></li></ul></div><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Get Started</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts and Architecture</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Schema</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar Functions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar IO</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pulsar SQL</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Tiered Storage</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/tiered-storage-overview">Overview</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/tiered-storage-aws">AWS S3 offloader</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/tiered-storage-gcs">GCS offloader</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2.7.1/tiered-storage-filesystem">Filesystem offloader</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2.7.1/tiered-storage-azure">Azure BlobStore offloader</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Transactions</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes (Helm)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deployment</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Client Libraries</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Admin API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Adaptors</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cookbooks</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Development</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Reference</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache Pulsar <b>2.7.1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/tiered-storage-filesystem">latest version</a></b> (2.8.0).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.7.1</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Use filesystem offloader with Pulsar</h1></header><p>This chapter guides you through every step of installing and configuring the filesystem offloader and using it with Pulsar.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="installation"></a>Installation<a class="hash-link" href="#installation" title="Direct link to heading">#</a></h2><p>This section describes how to install the filesystem offloader.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="prerequisite"></a>Prerequisite<a class="hash-link" href="#prerequisite" title="Direct link to heading">#</a></h3><ul><li>Pulsar: 2.4.2 or higher versions</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step"></a>Step<a class="hash-link" href="#step" title="Direct link to heading">#</a></h3><p>This example uses Pulsar 2.5.1.</p><ol><li><p>Download the Pulsar tarball using one of the following ways:</p><ul><li><p>Download the Pulsar tarball from the <a href="https://archive.apache.org/dist/pulsar/pulsar-2.5.1/apache-pulsar-2.5.1-bin.tar.gz" target="_blank" rel="noopener noreferrer">Apache mirror</a></p></li><li><p>Download the Pulsar tarball from the Pulsar <a href="https://pulsar.apache.org/download" target="_blank" rel="noopener noreferrer">download page</a></p></li><li><p>Use the <a href="https://www.gnu.org/software/wget" target="_blank" rel="noopener noreferrer">wget</a> command to dowload the Pulsar tarball.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> https://archive.apache.org/dist/pulsar/pulsar-2.5.1/apache-pulsar-2.5.1-bin.tar.gz</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul></li><li><p>Download and untar the Pulsar offloaders package. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">wget</span><span class="token plain"> https://downloads.apache.org/pulsar/pulsar-2.5.1/apache-pulsar-offloaders-2.5.1-bin.tar.gz</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">tar</span><span class="token plain"> xvfz apache-pulsar-offloaders-2.5.1-bin.tar.gz</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>If you run Pulsar in a bare metal cluster, ensure that the <code>offloaders</code> tarball is unzipped in every broker&#x27;s Pulsar directory.</li><li>If you run Pulsar in Docker or deploying Pulsar using a Docker image (such as K8S and DCOS), you can use the <code>apachepulsar/pulsar-all</code> image. The <code>apachepulsar/pulsar-all</code> image has already bundled tiered storage offloaders.</li></ul></div></div></li><li><p>Copy the Pulsar offloaders as <code>offloaders</code> in the Pulsar directory.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mv apache-pulsar-offloaders-2.5.1/offloaders apache-pulsar-2.5.1/offloaders</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">ls offloaders</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tiered-storage-file-system-2.5.1.nar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tiered-storage-jcloud-2.5.1.nar</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><ul><li>If you run Pulsar in a bare metal cluster, ensure that <code>offloaders</code> tarball is unzipped in every broker&#x27;s Pulsar directory.</li><li>If you run Pulsar in Docker or deploying Pulsar using a Docker image (such as K8s and DCOS), you can use the <code>apachepulsar/pulsar-all</code> image. The <code>apachepulsar/pulsar-all</code> image has already bundled tiered storage offloaders.</li></ul></div></div></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration"></a>Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">#</a></h2><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Before offloading data from BookKeeper to filesystem, you need to configure some properties of the filesystem offloader driver. </p></div></div><p>Besides, you can also configure the filesystem offloader to run it automatically or trigger it manually.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="configure-filesystem-offloader-driver"></a>Configure filesystem offloader driver<a class="hash-link" href="#configure-filesystem-offloader-driver" title="Direct link to heading">#</a></h3><p>You can configure the filesystem offloader driver in the <code>broker.conf</code> or <code>standalone.conf</code> configuration file.</p><ul><li><p><strong>Required</strong> configurations are as below.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">HDFS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">NFS</li></ul><div class="margin-vert--md"><div role="tabpanel"><table><thead><tr><th>Parameter</th><th>Description</th><th>Example value</th></tr></thead><tbody><tr><td><code>managedLedgerOffloadDriver</code></td><td>Offloader driver name, which is case-insensitive.</td><td>filesystem</td></tr><tr><td><code>fileSystemURI</code></td><td>Connection address, which is the URI to access the default Hadoop distributed file system.</td><td>hdfs://127.0.0.1:9000</td></tr><tr><td><code>offloadersDirectory</code></td><td>Hadoop profile path. The configuration file is stored in the Hadoop profile path. It contains various settings for Hadoop performance tuning.</td><td>../conf/filesystem_offload_core_site.xml</td></tr></tbody></table></div><div role="tabpanel" hidden=""><table><thead><tr><th>Parameter</th><th>Description</th><th>Example value</th></tr></thead><tbody><tr><td><code>managedLedgerOffloadDriver</code></td><td>Offloader driver name, which is case-insensitive.</td><td>filesystem</td></tr><tr><td><code>offloadersDirectory</code></td><td>Offloader directory. The configuration file is stored in the offloader directory. It contains various settings for performance tuning.</td><td>../conf/filesystem_offload_core_site.xml</td></tr></tbody></table></div></div></div></li><li><p><strong>Optional</strong> configurations are as below.</p><table><thead><tr><th>Parameter</th><th>Description</th><th>Example value</th></tr></thead><tbody><tr><td><code>managedLedgerMinLedgerRolloverTimeMinutes</code></td><td>Minimum time between ledger rollover for a topic. <br><br><strong>Note</strong>: it is not recommended to set this parameter in the production environment.</td><td>2</td></tr><tr><td><code>managedLedgerMaxEntriesPerLedger</code></td><td>Maximum number of entries to append to a ledger before triggering a rollover.<br><br><strong>Note</strong>: it is not recommended to set this parameter in the production environment.</td><td>5000</td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="run-filesystem-offloader-automatically"></a>Run filesystem offloader automatically<a class="hash-link" href="#run-filesystem-offloader-automatically" title="Direct link to heading">#</a></h3><p>You can configure the namespace policy to offload data automatically once a threshold is reached. The threshold is based on the size of data that a topic has stored on a Pulsar cluster. Once the topic storage reaches the threshold, an offload operation is triggered automatically. </p><table><thead><tr><th>Threshold value</th><th>Action</th></tr></thead><tbody><tr><td>&gt; 0</td><td>It triggers the offloading operation if the topic storage reaches its threshold.</td></tr><tr><td>= 0</td><td>It causes a broker to offload data as soon as possible.</td></tr><tr><td>&lt; 0</td><td>It disables automatic offloading operation.</td></tr></tbody></table><p>Automatic offload runs when a new segment is added to a topic log. If you set the threshold on a namespace, but few messages are being produced to the topic, the filesystem offloader does not work until the current segment is full.</p><p>You can configure the threshold using CLI tools, such as pulsar-admin.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="example"></a>Example<a class="hash-link" href="#example" title="Direct link to heading">#</a></h4><p>This example sets the filesystem offloader threshold to 10 MB using pulsar-admin.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin namespaces set-offload-threshold --size 10M my-tenant/my-namespace</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For more information about the <code>pulsar-admin namespaces set-offload-threshold options</code> command, including flags, descriptions, default values, and shorthands, see <a href="/docs/2.7.1/pulsar-admin#set-offload-threshold">here</a>. </p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="run-filesystem-offloader-manually"></a>Run filesystem offloader manually<a class="hash-link" href="#run-filesystem-offloader-manually" title="Direct link to heading">#</a></h3><p>For individual topics, you can trigger the filesystem offloader manually using one of the following methods:</p><ul><li><p>Use the REST endpoint.</p></li><li><p>Use CLI tools (such as pulsar-admin). </p></li></ul><p>To manually trigger the filesystem offloader via CLI tools, you need to specify the maximum amount of data (threshold) that should be retained on a Pulsar cluster for a topic. If the size of the topic data on the Pulsar cluster exceeds this threshold, segments from the topic are offloaded to the filesystem until the threshold is no longer exceeded. Older segments are offloaded first.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="example-1"></a>Example<a class="hash-link" href="#example-1" title="Direct link to heading">#</a></h4><ul><li><p>This example manually run the filesystem offloader using pulsar-admin.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics offload --size-threshold 10M persistent://my-tenant/my-namespace/topic1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload triggered </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> persistent://my-tenant/my-namespace/topic1 </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> messages before </span><span class="token number">2</span><span class="token plain">:0:-1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For more information about the <code>pulsar-admin topics offload options</code> command, including flags, descriptions, default values, and shorthands, see <a href="/docs/2.7.1/pulsar-admin#offload">here</a>. </p></div></div></li><li><p>This example checks filesystem offloader status using pulsar-admin.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics offload-status persistent://my-tenant/my-namespace/topic1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload is currently running</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To wait for the filesystem to complete the job, add the <code>-w</code> flag.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics offload-status -w persistent://my-tenant/my-namespace/topic1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload was a success</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If there is an error in the offloading operation, the error is propagated to the <code>pulsar-admin topics offload-status</code> command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">pulsar-admin topics offload-status persistent://my-tenant/my-namespace/topic1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Error in offload</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">null</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Reason: Error offloading: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: com.amazonaws.services.s3.model.AmazonS3Exception: Anonymous users cannot initiate multipart uploads.  Please authenticate. (Service: Amazon S3; Status Code: 403; Error Code: AccessDenied; Request ID: 798758DE3F1776DF; S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g=), S3 Extended Request ID: dhBFz/lZm1oiG/oBEepeNlhrtsDlzoOhocuYMpKihQGXe6EG8puRGOkK6UwqzVrMXTWBxxHcS+g=</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For more information about the <code>pulsar-admin topics offload-status options</code> command, including flags, descriptions, default values, and shorthands, see <a href="/docs/2.7.1/pulsar-admin#offload-status">here</a>. </p></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="tutorial"></a>Tutorial<a class="hash-link" href="#tutorial" title="Direct link to heading">#</a></h2><p>This section provides step-by-step instructions on how to use the filesystem offloader to move data from Pulsar to Hadoop Distributed File System (HDFS) or Network File system (NFS).</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">HDFS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">NFS</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>To move data from Pulsar to HDFS, follow these steps.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-1-prepare-the-hdfs-environment"></a>Step 1: Prepare the HDFS environment<a class="hash-link" href="#step-1-prepare-the-hdfs-environment" title="Direct link to heading">#</a></h3><p>This tutorial sets up a Hadoop single node cluster and uses Hadoop 3.2.1.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For details about how to set up a Hadoop single node cluster, see <a href="https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/SingleCluster.html" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><ol><li><p>Download and uncompress Hadoop 3.2.1. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">wget https://mirrors.bfsu.edu.cn/apache/hadoop/common/hadoop-3.2.1/hadoop-3.2.1.tar.gz  </span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">tar -zxvf hadoop-3.2.1.tar.gz -C $HADOOP_HOME</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Configure Hadoop.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># $HADOOP_HOME/etc/hadoop/core-site.xml</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;fs.defaultFS&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;hdfs://localhost:9000&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># $HADOOP_HOME/etc/hadoop/hdfs-site.xml</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;name&gt;dfs.replication&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        &lt;value&gt;1&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/configuration&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Set passphraseless ssh.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Now check that you can ssh to the localhost without a passphrase:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ssh localhost</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># If you cannot ssh to localhost without a passphrase, execute the following commands</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ssh-keygen -t rsa -P &#x27;&#x27; -f ~/.ssh/id_rsa</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ chmod 0600 ~/.ssh/authorized_keys</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Start HDFS.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># don&#x27;t execute this command repeatedly, repeat execute will cauld the clusterId of the datanode is not consistent with namenode</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$HADOOP_HOME/bin/hadoop namenode -format</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$HADOOP_HOME/sbin/start-dfs.sh</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Navigate to the <a href="http://localhost:9870/" target="_blank" rel="noopener noreferrer">HDFS website</a>.</p><p>You can see the <strong>Overview</strong> page.</p><p><img src="/assets/images/FileSystem-1-8fba41a03bedc3e2d89a0fccf0b80f0f.png"></p></li></ol><ol><li><p>At the top navigation bar, click <strong>Datanodes</strong> to check DataNode information.</p><p> <img src="/assets/images/FileSystem-2-e35ac7fd0ad15579667dde0f831eaa02.png"></p></li><li><p>Click <strong>HTTP Address</strong> to get more detailed information about localhost:9866.</p><p> As can be seen below, the size of <strong>Capacity Used</strong> is 4 KB, which is the initial value.</p><p> <img src="/assets/images/FileSystem-3-0c94a33a238a8753b06d8e9e99fc31fc.png"></p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2-install-the-filesystem-offloader"></a>Step 2: Install the filesystem offloader<a class="hash-link" href="#step-2-install-the-filesystem-offloader" title="Direct link to heading">#</a></h3><p>For details, see <a href="#installation">installation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-3-configure-the-filesystem-offloader"></a>Step 3: Configure the filesystem offloader<a class="hash-link" href="#step-3-configure-the-filesystem-offloader" title="Direct link to heading">#</a></h3><p>As indicated in the <a href="#configuration">configuration</a> section, you need to configure some properties for the filesystem offloader driver before using it. This tutorial assumes that you have configured the filesystem offloader driver as below and run Pulsar in <strong>standalone</strong> mode.</p><p>Set the following configurations in the <code>conf/standalone.conf</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly conf"><pre tabindex="0" class="prism-code language-conf codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">managedLedgerOffloadDriver=filesystem</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fileSystemURI=hdfs://127.0.0.1:9000</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fileSystemProfilePath=../conf/filesystem_offload_core_site.xml</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>For testing purposes, you can set the following two configurations to speed up ledger rollover, but it is not recommended that you set them in the production environment.</p></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">managedLedgerMinLedgerRolloverTimeMinutes=1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">managedLedgerMaxEntriesPerLedger=100</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>In this section, it is assumed that you have enabled NFS service and set the shared path of your NFS service. In this section, <code>/Users/test</code> is used as the shared path of NFS service.</p></div></div><p>To offload data to NFS, follow these steps.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-1-install-the-filesystem-offloader"></a>Step 1: Install the filesystem offloader<a class="hash-link" href="#step-1-install-the-filesystem-offloader" title="Direct link to heading">#</a></h3><p>For details, see <a href="#installation">installation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2-mont-your-nfs-to-your-local-filesystem"></a>Step 2: Mont your NFS to your local filesystem<a class="hash-link" href="#step-2-mont-your-nfs-to-your-local-filesystem" title="Direct link to heading">#</a></h3><p>This example mounts mounts <em>/Users/pulsar_nfs</em> to <em>/Users/test</em>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">mount -e 192.168.0.103:/Users/test/Users/pulsar_nfs</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-3-configure-the-filesystem-offloader-driver"></a>Step 3: Configure the filesystem offloader driver<a class="hash-link" href="#step-3-configure-the-filesystem-offloader-driver" title="Direct link to heading">#</a></h3><p>As indicated in the <a href="#configuration">configuration</a> section, you need to configure some properties for the filesystem offloader driver before using it. This tutorial assumes that you have configured the filesystem offloader driver as below and run Pulsar in <strong>standalone</strong> mode.</p><ol><li><p>Set the following configurations in the <code>conf/standalone.conf</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly conf"><pre tabindex="0" class="prism-code language-conf codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">managedLedgerOffloadDriver=filesystem</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">fileSystemProfilePath=../conf/filesystem_offload_core_site.xml</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Modify the <em>filesystem_offload_core_site.xml</em> as follows.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;fs.defaultFS&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;file:///&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;file:///Users/pulsar_nfs&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;io.file.buffer.size&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;4096&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;io.seqfile.compress.blocksize&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;1000000&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;io.seqfile.compression.type&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;BLOCK&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;name&gt;io.map.index.interval&lt;/name&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &lt;value&gt;128&lt;/value&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&lt;/property&gt;</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-4-offload-data-from-bookkeeper-to-filesystem"></a>Step 4: Offload data from BookKeeper to filesystem<a class="hash-link" href="#step-4-offload-data-from-bookkeeper-to-filesystem" title="Direct link to heading">#</a></h3><p>Execute the following commands in the repository where you download Pulsar tarball. For example, <code>~/path/to/apache-pulsar-2.5.1</code>.</p><ol><li><p>Start Pulsar standalone.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar standalone -a 127.0.0.1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>To ensure the data generated is not deleted immediately, it is recommended to set the <a href="https://pulsar.apache.org/docs/en/next/cookbooks-retention-expiry/#retention-policies" target="_blank" rel="noopener noreferrer">retention policy</a>, which can be either a <strong>size</strong> limit or a <strong>time</strong> limit. The larger value you set for the retention policy, the longer the data can be retained.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsarctl namespaces set-retention public/default --size 100M --time 2d</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>For more information about the <code>pulsarctl namespaces set-retention options</code> command, including flags, descriptions, default values, and shorthands, see <a href="https://docs.streamnative.io/pulsarctl/v2.7.0.6/#-em-set-retention-em-" target="_blank" rel="noopener noreferrer">here</a>. </p></div></div></li><li><p>Produce data using pulsar-client.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-client produce -m &quot;Hello FileSystem Offloader&quot; -n 1000 public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>The offloading operation starts after a ledger rollover is triggered. To ensure offload data successfully, it is recommended that you wait until several ledger rollovers are triggered. In this case, you might need to wait for a second. You can check the ledger status using pulsarctl.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsarctl topics internal-stats public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><p>The data of the ledger 696 is not offloaded.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;version&quot;: 1,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;creationDate&quot;: &quot;2020-06-16T21:46:25.807+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;modificationDate&quot;: &quot;2020-06-16T21:46:25.821+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;ledgers&quot;: [</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ledgerId&quot;: 696,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;isOffloaded&quot;: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;cursors&quot;: {}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Wait a second and send more messages to the topic.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsar-client produce -m &quot;Hello FileSystem Offloader&quot; -n 1000 public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Check the ledger status using pulsarctl.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsarctl topics internal-stats public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><p>The ledger 696 is rollovered.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;version&quot;: 2,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;creationDate&quot;: &quot;2020-06-16T21:46:25.807+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;modificationDate&quot;: &quot;2020-06-16T21:48:52.288+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;ledgers&quot;: [</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ledgerId&quot;: 696,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;entries&quot;: 1001,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;size&quot;: 81695,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;isOffloaded&quot;: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">},</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ledgerId&quot;: 697,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;isOffloaded&quot;: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;cursors&quot;: {}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Trigger the offloading operation manually using pulsarctl.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsarctl topic offload -s 0 public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><p>Data in ledgers before the ledge 697 is offloaded.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># offload info, the ledgers before 697 will be offloaded</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Offload triggered for persistent://public/default/fs-test3 for messages before 697:0:-1</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Check the ledger status using pulsarctl.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">./bin/pulsarctl topic internal-info public/default/fs-test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Output</strong></p><p>The data of the ledger 696 is offloaded.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;version&quot;: 4,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;creationDate&quot;: &quot;2020-06-16T21:46:25.807+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;modificationDate&quot;: &quot;2020-06-16T21:52:13.25+08:00&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;ledgers&quot;: [</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ledgerId&quot;: 696,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;entries&quot;: 1001,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;size&quot;: 81695,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;isOffloaded&quot;: true</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">},</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;ledgerId&quot;: 697,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;isOffloaded&quot;: false</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">],</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">&quot;cursors&quot;: {}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And the <strong>Capacity Used</strong> is changed from 4 KB to 116.46 KB.</p><p><img src="/assets/images/FileSystem-8-679ffa9ebb34e9242170e98af24d67d6.png"></p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.7.1/tiered-storage-filesystem.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/2.7.1/tiered-storage-gcs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« GCS offloader</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/2.7.1/tiered-storage-azure"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Azure BlobStore offloader Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation" class="table-of-contents__link">Installation</a><ul><li><a href="#prerequisite" class="table-of-contents__link">Prerequisite</a></li><li><a href="#step" class="table-of-contents__link">Step</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link">Configuration</a><ul><li><a href="#configure-filesystem-offloader-driver" class="table-of-contents__link">Configure filesystem offloader driver</a></li><li><a href="#run-filesystem-offloader-automatically" class="table-of-contents__link">Run filesystem offloader automatically</a></li><li><a href="#run-filesystem-offloader-manually" class="table-of-contents__link">Run filesystem offloader manually</a></li></ul></li><li><a href="#tutorial" class="table-of-contents__link">Tutorial</a><ul><li><a href="#step-1-prepare-the-hdfs-environment" class="table-of-contents__link">Step 1: Prepare the HDFS environment</a></li><li><a href="#step-2-install-the-filesystem-offloader" class="table-of-contents__link">Step 2: Install the filesystem offloader</a></li><li><a href="#step-3-configure-the-filesystem-offloader" class="table-of-contents__link">Step 3: Configure the filesystem offloader</a></li><li><a href="#step-1-install-the-filesystem-offloader" class="table-of-contents__link">Step 1: Install the filesystem offloader</a></li><li><a href="#step-2-mont-your-nfs-to-your-local-filesystem" class="table-of-contents__link">Step 2: Mont your NFS to your local filesystem</a></li><li><a href="#step-3-configure-the-filesystem-offloader-driver" class="table-of-contents__link">Step 3: Configure the filesystem offloader driver</a></li><li><a href="#step-4-offload-data-from-bookkeeper-to-filesystem" class="table-of-contents__link">Step 4: Offload data from BookKeeper to filesystem</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Inc.Copyright Â© 2021 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.668ae9d7.js"></script>
<script src="/assets/js/main.3d3de418.js"></script>
</body>
</html>