"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[31844],{3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return m}});var n=r(67294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(r),m=o,h=d["".concat(l,".").concat(m)]||d[m]||u[m]||a;return r?n.createElement(h,i(i({ref:t},c),{},{components:r})):n.createElement(h,i({ref:t},c))}));function m(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},56343:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return d}});var n=r(87462),o=r(63366),a=(r(67294),r(3905)),i=["components"],s={id:"deploy-monitoring",title:"Monitoring",sidebar_label:"Monitoring",original_id:"deploy-monitoring"},l=void 0,p={unversionedId:"deploy-monitoring",id:"version-2.6.4/deploy-monitoring",isDocsHomePage:!1,title:"Monitoring",description:"You can use different ways to monitor a Pulsar cluster, exposing both metrics that relate to the usage of topics and the overall health of the individual components of the cluster.",source:"@site/versioned_docs/version-2.6.4/deploy-monitoring.md",sourceDirName:".",slug:"/deploy-monitoring",permalink:"/docs/2.6.4/deploy-monitoring",editUrl:"https://github.com/apache/pulsar/edit/master/site2/website-next/versioned_docs/version-2.6.4/deploy-monitoring.md",tags:[],version:"2.6.4",frontMatter:{id:"deploy-monitoring",title:"Monitoring",sidebar_label:"Monitoring",original_id:"deploy-monitoring"},sidebar:"version-2.6.4/docsSidebar",previous:{title:"DC/OS",permalink:"/docs/2.6.4/deploy-dcos"},next:{title:"ZooKeeper and BookKeeper",permalink:"/docs/2.6.4/administration-zk-bk"}},c=[{value:"Collect metrics",id:"collect-metrics",children:[{value:"Broker stats",id:"broker-stats",children:[]},{value:"ZooKeeper stats",id:"zookeeper-stats",children:[]},{value:"BookKeeper stats",id:"bookkeeper-stats",children:[]}]},{value:"Configure Prometheus",id:"configure-prometheus",children:[]},{value:"Dashboards",id:"dashboards",children:[{value:"Pulsar per-topic dashboard",id:"pulsar-per-topic-dashboard",children:[]},{value:"Grafana",id:"grafana",children:[]}]}],u={toc:c};function d(e){var t=e.components,r=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"You can use different ways to monitor a Pulsar cluster, exposing both metrics that relate to the usage of topics and the overall health of the individual components of the cluster."),(0,a.kt)("h2",{id:"collect-metrics"},"Collect metrics"),(0,a.kt)("p",null,"You can collect broker stats, ZooKeeper stats, and BookKeeper stats. "),(0,a.kt)("h3",{id:"broker-stats"},"Broker stats"),(0,a.kt)("p",null,"You can collect Pulsar broker metrics from brokers and export the metrics in JSON format. The Pulsar broker metrics mainly have two types:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("em",{parentName:"p"},"Destination dumps"),", which contain stats for each individual topic. You can fetch the destination dumps using the command below:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\nbin/pulsar-admin broker-stats destinations\n\n"))),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Broker metrics, which contain the broker information and topics stats aggregated at namespace level. You can fetch the broker metrics using the command below:"),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\nbin/pulsar-admin broker-stats monitoring-metrics\n\n")))),(0,a.kt)("p",null,"All the message rates are updated every 1min."),(0,a.kt)("p",null,"The aggregated broker metrics are also exposed in the ",(0,a.kt)("a",{parentName:"p",href:"https://prometheus.io"},"Prometheus")," format at:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\nhttp://$BROKER_ADDRESS:8080/metrics\n\n")),(0,a.kt)("h3",{id:"zookeeper-stats"},"ZooKeeper stats"),(0,a.kt)("p",null,"The local Zookeeper and configuration store server and clients that are shipped with Pulsar have been instrumented to expose detailed stats through Prometheus as well."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\nhttp://$LOCAL_ZK_SERVER:8000/metrics\nhttp://$GLOBAL_ZK_SERVER:8001/metrics\n\n")),(0,a.kt)("p",null,"The default port of local ZooKeeper is ",(0,a.kt)("inlineCode",{parentName:"p"},"8000")," and the default port of configuration store is ",(0,a.kt)("inlineCode",{parentName:"p"},"8001"),". You can change the default port of local Zookeeper and configuration store by specifying system property ",(0,a.kt)("inlineCode",{parentName:"p"},"stats_server_port"),"."),(0,a.kt)("h3",{id:"bookkeeper-stats"},"BookKeeper stats"),(0,a.kt)("p",null,"For BookKeeper you can configure the stats frameworks by changing the ",(0,a.kt)("inlineCode",{parentName:"p"},"statsProviderClass")," in\n",(0,a.kt)("inlineCode",{parentName:"p"},"conf/bookkeeper.conf"),"."),(0,a.kt)("p",null,"The default BookKeeper configuration, which is included with Pulsar distribution, enables the Prometheus exporter."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\nhttp://$BOOKIE_ADDRESS:8000/metrics\n\n")),(0,a.kt)("p",null,"The default port for bookie is ",(0,a.kt)("inlineCode",{parentName:"p"},"8000")," (instead of ",(0,a.kt)("inlineCode",{parentName:"p"},"8080"),"). You can change the port by configuring ",(0,a.kt)("inlineCode",{parentName:"p"},"prometheusStatsHttpPort")," in ",(0,a.kt)("inlineCode",{parentName:"p"},"conf/bookkeeper.conf"),"."),(0,a.kt)("h2",{id:"configure-prometheus"},"Configure Prometheus"),(0,a.kt)("p",null,"You can use Prometheus to collect and store the metrics data. For details, refer to ",(0,a.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/introduction/getting_started/"},"Prometheus guide"),"."),(0,a.kt)("p",null,"When you run Pulsar on bare metal, you can provide the list of nodes that needs to be probed. When you deploy Pulsar in a Kubernetes cluster, the monitoring is automatically setup with the ",(0,a.kt)("a",{parentName:"p",href:"deploy-kubernetes"},"provided")," instructions."),(0,a.kt)("h2",{id:"dashboards"},"Dashboards"),(0,a.kt)("p",null,"When you collect time series statistics, the major problem is to make sure the number of dimensions attached to the data does not explode."),(0,a.kt)("p",null,"For that reason you only need to collect time series of metrics aggregated at the namespace level."),(0,a.kt)("h3",{id:"pulsar-per-topic-dashboard"},"Pulsar per-topic dashboard"),(0,a.kt)("p",null,"The per-topic dashboard instructions are available at ",(0,a.kt)("a",{parentName:"p",href:"administration-dashboard"},"Dashboard"),"."),(0,a.kt)("h3",{id:"grafana"},"Grafana"),(0,a.kt)("p",null,"You can use grafana to easily create dashboard driven by the data that is stored in Prometheus."),(0,a.kt)("p",null,"When you deploy Pulsar on Kubernetes, a ",(0,a.kt)("inlineCode",{parentName:"p"},"pulsar-grafana")," Docker image is enabled by default. You can use the docker image with the principal dashboards."),(0,a.kt)("p",null,"Enter the command below to use the dashboard manually:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\ndocker run -p3000:3000 \\\n        -e PROMETHEUS_URL=http://$PROMETHEUS_HOST:9090/ \\\n        apachepulsar/pulsar-grafana:latest\n\n")))}d.isMDXComponent=!0}}]);