# PIP-424: Support Getting Message ID by Index in ManagedLedger Interface

# Background knowledge

- **ManagedLedger**: Core Pulsar component managing message storage in BookKeeper ledgers
- **Message Index**: Global monotonically increasing counter for messages in a topic (0-based)
- **LedgerInfo**: Metadata stored per ledger in ZK/metastore (ledgerID, size, etc.)
- 
# Motivation

Current approaches to get message ID by index:
1. Rely on **broker entry metadata** (PIP-415), but:
    - Incompatible with custom implementations (e.g., Ursa engine)
2. Use **linear scan**:
    - O(N) time complexity causes read amplification

# Goals

## In Scope

- Add `getMessageIdByIndex()` to `ManagedLedger`
- Store first entry index in `properties` of `LedgerInfo`

## Out of Scope

NA

# High Level Design

1. **Metadata Enhancement**: Store `firstEntryIndex` in `properties` of `LedgerInfo`
2. **Lookup Process**:
    - Binary search across ledgers using `firstEntryIndex`
    - Direct calculation: `entryId = targetIndex - ledger.firstEntryIndex`
3. **Custom Engine Support**: Alternative implementations via `ManagedLedger` interface

# Detailed Design

## Design & Implementation Details

## Public-facing Changes

**1. `ManagedLedger` Interface Change**
```java
public interface ManagedLedger {
    CompletableFuture<MessageId> getMessageIdByIndex(long index);
}
```

### Public API

### Binary protocol

### Configuration

### CLI

### Metrics

# Backward & Forward Compatibility

# Links

* Mailing List discussion thread:
* Mailing List voting thread:
