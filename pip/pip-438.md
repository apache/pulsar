# PIP-437: Add namespace topics limit metric

# Background knowledge

Pulsar namespaces can be configured with a maximum number of topics. When this limit is reached, producers fail to create new topics. Currently, operators lack visibility into namespace topic limits through metrics.

# Motivation

Operators cannot proactively monitor namespace capacity because there's no metric exposing the configured topic limit. This leads to reactive troubleshooting when producers start failing.

# Goals

## In Scope

- Add `pulsar_namespace_max_topics_limit` metric exposing the configured maximum topics limit for each namespace
- Include cluster and namespace labels for correlation with existing topic count metrics

## Out of Scope

# High Level Design

Add a new gauge metric that exposes the configured maximum topics limit for each namespace. It will be calculated on
each export of metrics.

# Detailed Design

## Design & Implementation Details

- Create method `getNamespaceTopicLimit` method in `NamespaceStatsAggregator`, fetching from namespace policies their 
  max topics limit, falling back to the default value set in the broker configuration
- Create method `printNamespaceTopicLimitStats` in `NamespaceStatsAggregator` to print the configured limit for each
  namespace

## Public-facing Changes

- **Metric name**: `pulsar_namespace_max_topics_limit`
- **Description**: Maximum number of topics allowed in the namespace
- **Labels**: `cluster` (cluster name), `namespace` 
- **Type**: Gauge

# Monitoring

Enables namespace saturation monitoring by comparing with existing topic count metrics:
- Saturation: `(pulsar_topics_count / pulsar_namespace_max_topics_limit) * 100`

# Security Considerations

No new security concerns. Exposes configuration data already accessible via admin API to authorized users.

# Backward & Forward Compatibility

## Upgrade
No special steps required. Metric available immediately after upgrade.

## Downgrade / Rollback
No issues. Metric simply disappears on rollback.

## Pulsar Geo-Replication Upgrade & Downgrade/Rollback Considerations

No impact on geo-replication. Clusters can be upgraded independently.

# Alternatives

1. **Enhance existing metrics**: Rejected to avoid breaking existing monitoring
2. **Admin API only**: Rejected due to poor integration with monitoring workflows


# Links

* Mailing List discussion thread: https://lists.apache.org/thread/c3r2v2bhmtf82b0h1ff2pqc8wnosp7b8
* Mailing List voting thread: [To be updated]
