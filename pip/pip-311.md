# Title: Add a request ID parameter to the `newMultiTransactionMessageAck` method signature

# Background knowledge
**newMultiTransactionMessageAck**: A public API in `Commands.java` that is used to assemble a `CommandAck` to individually ack a list of message IDs with a transaction ID.


# Motivation
In Pulsar, all operations are encapsulated as individual commands.
For instance, the action of sending a message by ClientCnx is a `Send` command, and the broker has a corresponding `handleSend` method to handle the request of sending messages. 
Subsequently, the broker sends a successful command, and ClientCnx will have a corresponding 'HandleSuccess' method to process the returned successful command.
ClientCnx locally caches each request's ID and future. Upon receiving a response from the broker, it operates on the corresponding future based on the request ID. 
For requests that do not receive a response within a given timeout, their futures will be completed with a Timeout exception and removed from the local cache map.
This requires that all command requests waiting for a response should include the request ID, so that the response returned by the broker can carry the corresponding request ID. 
This way, ClientCnx can clearly identify which request has been processed and completed.

But the public API `newMultiTransactionMessageAck` in the `Commands.java` creates the ack commands without request ID and hopes to wait for the response.
This causes all the requests created by `newMultiTransactionMessageAck` to be timed out.

This proposal will modify the `newMultiTransactionMessageAck` method signature to add the request ID.

# Goals

## In Scope

Modify the `newMultiTransactionMessageAck` method signature to add the request ID.

## Out of Scope

Modify the protocol of the `CommandAck`.

# High Level Design
Add a request ID parameter to the `newMultiTransactionMessageAck` method signature.

## Public-facing Changes

### Public API
Add a request ID parameter to the `newMultiTransactionMessageAck` method signature.

Before modification:
```java
    public static ByteBuf newMultiTransactionMessageAck(long consumerId, TxnID txnID,
            List<Triple<Long, Long, ConcurrentBitSetRecyclable>> entries) {
        BaseCommand cmd = newMultiMessageAckCommon(entries);
        cmd.getAck()
                .setConsumerId(consumerId)
                .setAckType(AckType.Individual)
                .setTxnidLeastBits(txnID.getLeastSigBits())
                .setTxnidMostBits(txnID.getMostSigBits());
        return serializeWithSize(cmd);
    }
```
After modification:
```java
    public static ByteBuf newMultiTransactionMessageAck(long consumerId, TxnID txnID,
            List<Triple<Long, Long, ConcurrentBitSetRecyclable>> entries, long requestID) {
        BaseCommand cmd = newMultiMessageAckCommon(entries);
        cmd.getAck()
                .setConsumerId(consumerId)
                .setAckType(AckType.Individual)
                .setTxnidLeastBits(txnID.getLeastSigBits())
                .setTxnidMostBits(txnID.getMostSigBits())
                .setRequestId(requestID);
        return serializeWithSize(cmd);
    }
```

# Links

<!--
Updated afterwards
-->
* Mailing List discussion thread:
* Mailing List voting thread: