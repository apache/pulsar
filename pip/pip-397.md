# PIP-397: Support topic-level migration from blue cluster to green cluster

# Background knowledge
Cluster migration or blue-green cluster functionality is used to migrate live traffic from one cluster (blue cluster)
to another cluster (green cluster).

Currently, Pulsar supports blue-green cluster migration at both the cluster level and the namespace level. 

# Motivation

However, sometimes there are many topics under a single namespace, and we do not want to migrate all topics in that 
namespace to the green cluster at the same time, as this may introduce risks. Therefore, we would like to introduce 
topic-level migration functionality to have more granular control over the migration process.

# Goals

## In Scope

Add admin API and command to support topic-level migration from blue cluster to green cluster.

## Out of Scope

# High Level Design

Add admin API and command to support topic-level migration from blue cluster to green cluster.

# Detailed Design

## Design & Implementation Details

Add admin API and command to support topic-level migration from blue cluster to green cluster.

## Public-facing Changes

### Public API

Add a new API to enable migration at topic level:
```
    /**
     * Enable migration for a topic.
     *
     * @param topic
     *             Topic name
     * @throws PulsarAdminException.NotAuthorizedException
     *             Don't have admin permission
     * @throws PulsarAdminException.NotFoundException
     *             Topic does not exist
     * @throws PulsarAdminException
     *             Unexpected error
     */
    void enableMigration(String topic) throws PulsarAdminException;

    /**
     * Enable migration for a topic asynchronously.
     */
    CompletableFuture<Void> enableMigrationAsync(String topic);
```
```
admin.topicPolicies().enableMigration(topic);
```

### Binary protocol

### Configuration

### CLI

Add a command to enable migration at topic level:
```
pulsar-admin topicPolices enable-migration persistent://tenant/namespace/topic
```

### Metrics

# Monitoring

# Security Considerations

Only superuser can access the admin API to enable migration at topic level.

# Backward & Forward Compatibility

## Upgrade

## Downgrade / Rollback

## Pulsar Geo-Replication Upgrade & Downgrade/Rollback Considerations

# Alternatives

# General Notes

# Links

* Mailing List discussion thread: https://lists.apache.org/thread/j8f64frvrbrml2gjzopgss8s83fm1w79
* Mailing List voting thread:
