# Background

The TableView interface provides a convenient way to access data in a compacted topic by providing a continuously updated view of a key-value mapping. It operates on messages with keys and ignores those without keys.

Using TableView, a Pulsar client can retrieve all message updates from a specific topic and create a mapping with the latest value for each key. This mapping can be used to establish a local data cache. Additionally, the client can register consumers with TableView and specify a listener to scan the mapping and receive notifications when new messages are received. This functionality enables event-driven applications and message monitoring.

For more detailed information about TableView, please refer to the [Pulsar documentation](https://pulsar.apache.org/docs/next/concepts-clients/#tableview).

# Motivation

In the context of using the TableView component, we sometimes want to always be able to retrieve the latest value associated with a given key. To accomplish this, we can modify the TableView's builder to include a configuration option that refreshes the key each time it's read, retrieving the latest value.

# Goal

## In Scope

The proposed changes aim to modify the TableView's builder to include a configuration option that refreshes the key each time it's read, retrieving the latest value.

## Out of Scope

No out of scope items have been determined at this time.

# High-Level Design

The high-level design involves modifying the TableView's builder to include a configuration option that refreshes the key each time it's read, retrieving the latest value.

# Detailed Design

## Design and Implementation Details

The TableView's builder will be modified to include a new configuration option that will determine whether to refresh each time a key is read, retrieving the latest value. A possible Java code implementation might look like this:

```java
public class TableViewConfigurationData {
    private boolean alwaysRefresh = false;

    public void setAlwaysRefresh(boolean alwaysRefresh) {
        this.alwaysRefresh = alwaysRefresh;
    }

    public boolean isAlwaysRefresh() {
        return alwaysRefresh;
    }
}

public class TableViewBuilderImpl<T> implements TableViewBuilder<T> {
    private TableViewConfigurationData conf;

    @Override
    public TableViewBuilder<T> alwaysRefresh(boolean alwaysRefresh) {
        conf.setAlwaysRefresh(alwaysRefresh);
        return this;
    }

    // ...
}
```

In this modification, we added a new field `alwaysRefresh` in the `TableViewConfigurationData` class and provided corresponding getter and setter. Then, in the `TableViewBuilderImpl` class, we added a new method `alwaysRefresh(boolean alwaysRefresh)` that updates the `TableViewConfigurationData` instance with the new configuration option.

# Public Changes

## Public API

Here are the changes to the public API:

### `alwaysRefresh(boolean alwaysRefresh)`

This is a new TableView config that allows users to set whether to refresh each time a key is read, retrieving the latest value.

```java
/**
 * Sets whether to refresh each time a key is read, retrieving the latest value.
 *
 * @param alwaysRefresh If true, refresh each time a key is read, retrieving the latest value; otherwise, retrieve the latest value only at the first build.
 * @return Returns an instance of TableViewBuilder for chain calling.
 *
 * Note that the 'latest' value refers to the value at the point of calling refresh, not necessarily the current latest if more messages have been produced in the meantime.
 *
 * Usage example:
 * TableViewBuilder<String> builder = new TableViewBuilderImpl<>();
 * builder.alwaysRefresh(true).build();
 */
@Override
public TableViewBuilder<T> alwaysRefresh(boolean alwaysRefresh);
```

# Monitoring

The proposed changes have not introduced any specific monitoring considerations at this time.

# Security Considerations

No specific security considerations have been determined for this proposal.

# Backward and Forward Compatibility

## Rollback

This proposal does not require specific rollback guidelines.

## Upgrade

This proposal does not require specific upgrade guidelines.

# Alternatives

No other alternatives have been considered for this proposal.

# General Remarks

No additional general remarks have been provided.

# Links

<!--
Update after submission
-->
* Email list discussion thread:
* Email list voting thread: