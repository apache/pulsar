# Background knowledge

In https://github.com/apache/pulsar/pull/11139 we support get position based on timestamp, but it doesn't work well with topic compaction enabled because the data may have been move to the compacted ledger.

In PIP-278 we introduced the pluggable topic compaction service to extend the compaction.

# Motivation

In order for `get-message-id` to work well with topic compaction enabled we need to find the position according to publishTime from topic compaction service,
but `TopicCompactionService` missing find positions method, so we should add it.

In addition, this method can also be used to find the position according to offset in the KoP.

# Goals

# High Level Design

# Detailed Design

Add `findNewestPosition` in the `TopicCompactionService` API.

Implement it in the `PulsarTopicCompactionService` using binary search.

When get last messageId, find position from topicCompactionService if can't find position in the manageLedger.

## Public-facing Changes

 ```java
  public interface TopicCompactionService extends AutoCloseable { 
   /**
     * Find the newest Position that matches the given predicate.
     *
     * @param condition
     *  predicate that reads an entry an applies a condition
     * @return a future that will be completed with the result position, this position can be null.
     */
    CompletableFuture<Position> findNewestPosition(@Nonnull Predicate<Entry> condition);
  }
  ```

# Links

* Mailing List discussion thread: https://lists.apache.org/thread/85o3sx6rhohvc370j4r7yd2nb1tx736c
* Mailing List voting thread: 