<!DOCTYPE html><html lang="zh-CN"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>The Pulsar Node.js client · Apache Pulsar</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar [生产者](#producers)、[消费者](#consumers) 以及 [读者](#readers)。"/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="zh-CN"/><meta property="og:title" content="The Pulsar Node.js client · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.incubator.apache.org/"/><meta property="og:description" content="Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar [生产者](#producers)、[消费者](#consumers) 以及 [读者](#readers)。"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.incubator.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.incubator.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.incubator.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zh-CN"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/zh-CN/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/standalone" target="_self">文档</a></li><li class=""><a href="/zh-CN/download" target="_self">下载</a></li><li class="siteNavGroupActive"><a href="/docs/zh-CN/next/client-libraries" target="_self">客户端</a></li><li class=""><a href="#restapis" target="_self">REST API</a></li><li class=""><a href="#cli" target="_self">Cli</a></li><li class=""><a href="/blog/" target="_self">博客</a></li><li class=""><a href="#community" target="_self">社区</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>中文</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/client-libraries-node">English</a></li><li><a href="/docs/ja/next/client-libraries-node">日本語</a></li><li><a href="/docs/fr/next/client-libraries-node">Français</a></li><li><a href="/docs/ko/next/client-libraries-node">한국어</a></li><li><a href="/docs/zh-TW/next/client-libraries-node">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">参与翻译</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>客户端库</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/pulsar-2.0">Pulsar-2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone">本地运行 Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/standalone-docker">在 Docker 中运行 Pulsar</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/kubernetes-helm">Run Pulsar in Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries">用客户端库使用 Pulsar</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">概念和架构</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-messaging">消息</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-architecture-overview">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-clients">客户端</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-replication">基于地理位置的备份</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-multi-tenancy">多租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-authentication">认证和授权</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-topic-compaction">消息压缩</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/concepts-tiered-storage">Tiered Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-get-started">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-understand">了解 schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-evolution-compatibility">Schema 演化和兼容</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/schema-manage">管理 Schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-runtime">Setup: Configure Functions runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-develop">How-to: Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-debug">How-to: Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-deploy">How-to: Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/functions-cli">Reference: CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-quickstart">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-use">Use</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-debug">调试</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-connectors">内置 connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cdc">CDC connector</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-develop">Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-getting-started">Query data</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-deployment-configurations">配置和部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/sql-rest-api">REST API</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Kubernetes (Helm)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-prepare">Prepare</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-install">安装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-deploy">部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-upgrade">升级</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/helm-tools">Required Tools</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">部署</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-aws">Amazon Web Services</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal">裸机</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-bare-metal-multi-cluster">裸机多集群部署</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-dcos">DC/OS</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/deploy-monitoring">Monitoring</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">系统管理</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-zk-bk">ZooKeeper 和 BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-geo">跨地域复制</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-stats">Pulsar statistics</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-load-balance">负载均衡</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-proxy">Pulsar proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/administration-upgrade">升级</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">安全</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-transport">使用TLS进行传输加密</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-authentication">使用TLS进行认证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-jwt">Authentication using JWT</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-athenz">使用 Athenz 验证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-kerberos">使用 Kerberos 进行身份认证</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-authorization">Authorization and ACLs</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-encryption">End-to-End Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-extending">Extending</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">性能</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/performance-pulsar-perf">Pulsar Perf</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">客户端库</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-cpp">C++</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/zh-CN/next/client-libraries-node">Node.js
</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-websocket">WebSocket</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/client-libraries-dotnet">C#</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-overview">概述</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-clusters">集群</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-tenants">租户</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-namespaces">命名空间</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-persistent-topics">持久topic</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-non-persistent-topics">非持久topic</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-partitioned-topics">分区主题</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-non-partitioned-topics">非分区主题</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-schemas">Schema</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/admin-api-functions">Functions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">适配器</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-kafka">Kafka 客户端封装</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考手册</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-tiered-storage">Tiered Storage</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-deduplication">Message deduplication</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-non-persistent">非持久化消息</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-partitioned">分区主题</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-retention-expiry">消息保留和到期</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-message-queue">消息队列</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">开发</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-tools">模拟工具</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-binary-protocol">Binary protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-load-manager">Modular load manager</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/develop-cpp">编译Pulsar C++ 客户端</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">参考</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-terminology">术语</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-cli-tools">Pulsar CLI tools</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/zh-CN/next/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/zh-CN" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">The Pulsar Node.js client</h1></header><article><div><span><p>Pulsar Node.js 客户端可用于在 Node.js 中创建 Pulsar <a href="#producers">生产者</a>、<a href="#consumers">消费者</a> 以及 <a href="#readers">读者</a>。</p>
<p>Node.js 客户端中 <a href="#producers">生产者</a>、<a href="#consumers">消费者</a> 以及 <a href="#readers">读者</a> 中的所有方法都是线程安全的。</p>
<h2><a class="anchor" aria-hidden="true" id="安装"></a><a href="#安装" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>安装</h2>
<p>You can install the <a href="https://www.npmjs.com/package/pulsar-client"><code>pusar-client</code></a> library via <a href="https://www.npmjs.com/">npm</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="要求"></a><a href="#要求" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>要求</h3>
<p>Pulsar Node.js client library is based on the C++ client library. Follow <a href="/docs/zh-CN/next/client-libraries-cpp#compilation">these instructions</a> and install the Pulsar C++ client library.</p>
<h3><a class="anchor" aria-hidden="true" id="兼容性"></a><a href="#兼容性" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>兼容性</h3>
<p>Compatibility between each version of the Node.js client and the C++ client is as follows:</p>
<table>
<thead>
<tr><th style="text-align:left">Node.js 客户端</th><th style="text-align:left">C++ client</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left">1.0.0</td><td style="text-align:left">2.3.0 或更高</td></tr>
</tbody>
</table>
<p>If an incompatible version of the C++ client is installed, you may fail to build or run this library.</p>
<h3><a class="anchor" aria-hidden="true" id="使用-npm-安装"></a><a href="#使用-npm-安装" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 npm 安装</h3>
<p>Install the <code>pulsar-client</code> library via <a href="https://www.npmjs.com/">npm</a>:</p>
<pre><code class="hljs css language-shell"><span class="hljs-meta">$</span><span class="bash"> npm install pulsar-client</span>
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="note"></a><a href="#note" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Note</h4>
<p>另外，这个库只能在 Node.js 10.x 或更高的版本中运行，因为它使用 <a href="https://github.com/nodejs/node-addon-api"><code>node-addon-api</code></a> 模块来包装C++库。</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="连接url"></a><a href="#连接url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>连接URL</h2>
<p>To connect to Pulsar using client libraries, you need to specify a <a href="/docs/zh-CN/next/develop-binary-protocol">Pulsar protocol</a> URL.</p>
<p>Pulsar protocol URLs are assigned to specific clusters, use the <code>pulsar</code> scheme and have a default port of 6650. Here is an example for <code>localhost</code>:</p>
<pre><code class="hljs css language-http">pulsar://localhost:6650
</code></pre>
<p>A URL for a production Pulsar cluster may look something like this:</p>
<pre><code class="hljs css language-http">pulsar://pulsar.us-west.example.com:6650
</code></pre>
<p>If you are using <a href="/docs/zh-CN/next/security-tls-transport">TLS encryption</a> or <a href="/docs/zh-CN/next/security-tls-authentication">TLS Authentication</a>, the URL will look like something like this:</p>
<pre><code class="hljs css language-http">pulsar+ssl://pulsar.us-west.example.com:6651
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="创建客户端"></a><a href="#创建客户端" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>创建客户端</h2>
<p>In order to interact with Pulsar, you will first need a client object. You can create a client instance using a <code>new</code> operator and the <code>Client</code> method, passing in a client options object (more on configuration <a href="#client-configuration">below</a>).</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="客户端配置"></a><a href="#客户端配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>客户端配置</h3>
<p>The following configurable parameters are available for Pulsar clients:</p>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th><th style="text-align:left">Default</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>serviceUrl</code></td><td style="text-align:left">The connection URL for the Pulsar cluster. 更多详细信息，请参阅 <a href="#connection-urls">上述文档</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>authentication</code></td><td style="text-align:left">Configure the authentication provider. (default: no authentication). 更多详细信息，请参阅 <a href="/docs/zh-CN/next/security-tls-authentication">令牌认证</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>operationTimeoutSeconds</code></td><td style="text-align:left">Node.js 客户端操作的超时时间 (创建生产者，订阅/取消订阅 <a href="/docs/zh-CN/next/reference-terminology#topic">主题</a>)。 Retries will occur until this threshold is reached, at which point the operation will fail.</td><td style="text-align:left">30</td></tr>
<tr><td style="text-align:left"><code>ioThreads</code></td><td style="text-align:left">用于处理 Pulsar <a href="/docs/zh-CN/next/reference-terminology#broker">brokers</a> 连接的线程数。</td><td style="text-align:left">1</td></tr>
<tr><td style="text-align:left"><code>messageListenerThreads</code></td><td style="text-align:left">消息监听者 (<a href="#consumers">消费者</a> 与 <a href="#readers"> 生产者</a>)使用的线程数。</td><td style="text-align:left">1</td></tr>
<tr><td style="text-align:left"><code>concurrentLookupRequest</code></td><td style="text-align:left">The number of concurrent lookup requests that can be sent on each broker connection. Setting a maximum helps to keep from overloading brokers. 只有当客户端需要生产 及/或 订阅数以千计的 Pulsar 主题时，你才应该修改预设的 50000 默认值。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>tlsTrustCertsFilePath</code></td><td style="text-align:left">信任的 TLS 证书的文件路径。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>tlsValidateHostname</code></td><td style="text-align:left">设置是否启用 TLS 主机名验证的布尔值。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>tlsAllowInsecureConnection</code></td><td style="text-align:left">设置是否让 Pulsar 客户端从 broker 接受不信任的 TLS 证书的布尔值。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>statsIntervalInSeconds</code></td><td style="text-align:left">每次统计信息之间的时间间隔。 当 statsInterval 为正数时启用信息统计。 值应该设置为至少 1 秒。</td><td style="text-align:left">600</td></tr>
</tbody>
</table>
<h2><a class="anchor" aria-hidden="true" id="producers"></a><a href="#producers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producers</h2>
<p>Pulsar producers publish messages to Pulsar topics. You can <a href="#producer-configuration">configure</a> Node.js producers using a producer configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
});

<span class="hljs-keyword">await</span> producer.send({
  <span class="hljs-attr">data</span>: Buffer.from(<span class="hljs-string">"Hello, Pulsar"</span>),
});

<span class="hljs-keyword">await</span> producer.close();
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="promise-操作"></a><a href="#promise-操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 操作</h4>
<p>当你创建一个新的 Pulsar 生产者时，该操作会返回一个 <code>Promise</code> 对象以及生产者实例，亦或是通过 executor 函数来抛出错误。 这个例子中使用了 await 操作，而不是 executor 函数。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="producer-operations"></a><a href="#producer-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producer operations</h3>
<p>Pulsar Node.js producers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>send(Object)</code></td><td style="text-align:left">Publishes a <a href="#messages">message</a> to the producer's topic. 当消息成功地被 Pulsar broker 确认，或是准备抛出错误时，Promise 对象会运行 executor 函数。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
<tr><td style="text-align:left"><code>flush()</code></td><td style="text-align:left">从发送队列发送消息给 Pulsar broker。 当消息成功地被 Pulsar broker 确认，或是准备抛出错误时，Promise 对象会运行 executor 函数。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">Closes the producer and releases all resources allocated to it. 如果 <code>close()</code> 被调用，那么将不再接收发布者的消息。 此方法将返回 Promise 对象，并在所有待发布请求被 Pulsar 持久化时运行 executor 函数。 If an error is thrown, no pending writes will be retried.</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="producer-配置"></a><a href="#producer-配置" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Producer 配置</h3>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th><th style="text-align:left">Default</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">生产者发布消息的目标 Pulsar <a href="/docs/zh-CN/next/reference-terminology#topic">主题</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>producerName</code></td><td style="text-align:left">A name for the producer. 如果没有明确指定一个名称，Pulsar 将自动生成一个全局唯一的名称。  如果明确指定了一个名称，那么它必须是在 <em>所有</em> Pulsar 集群中唯一的，否则创建操作将会抛出异常。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>sendTimeoutMs</code></td><td style="text-align:left">When publishing a message to a topic, the producer will wait for an acknowledgment from the responsible Pulsar <a href="/docs/zh-CN/next/reference-terminology#broker">broker</a>. If a message is not acknowledged within the threshold set by this parameter, an error will be thrown. 如果你将 <code>sendTimeoutMs</code> 设为 -1，那么超时时间将会被设置为无穷大（从而移除超时限定）。 Removing the send timeout is recommended when using Pulsar's <a href="/docs/zh-CN/next/cookbooks-deduplication">message de-duplication</a> feature.</td><td style="text-align:left">30000</td></tr>
<tr><td style="text-align:left"><code>initialSequenceId</code></td><td style="text-align:left">消息的初始序列号 当生产者发送消息时，将序列号添加到消息中。 每次发送消息都会让序列号增加。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>maxPendingMessages</code></td><td style="text-align:left">The maximum size of the queue holding pending messages (i.e. messages waiting to receive an acknowledgment from the <a href="/docs/zh-CN/next/reference-terminology#broker">broker</a>). 默认地，当队列满时，所有对 <code>send</code> 方法的调用会失败，<em>除非</em> <code>blockIfQueueFull</code> 被设置为了 <code>true</code>.</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>maxPendingMessagesAcrossPartitions</code></td><td style="text-align:left">所有分区的等待队列空间总和的最大值。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>blockIfQueueFull</code></td><td style="text-align:left">如果设置为 <code>true</code>，当消息传出队列满时，生产者的 <code>send</code> 方法会进行等待，而不是失败并抛出错误（该队列的大小由 <code>maxPendingMessages</code> 参数指示）；如果设置为 <code>false</code> （默认值），当队列满时 <code>send</code> 操作会失败并抛出错误。</td><td style="text-align:left"><code>false</code></td></tr>
<tr><td style="text-align:left"><code>messageRoutingMode</code></td><td style="text-align:left">消息路由逻辑 （<a href="/docs/zh-CN/next/concepts-messaging#partitioned-topics">分区主题</a> 上的生产者使用的)。 This logic is applied only when no key is set on messages. 可选项有：round robin （<code>RoundRobinDistribution</code>），或是将所有消息发布到单个分区 （<code>UseSinglePartition</code>，默认值）。</td><td style="text-align:left"><code>UseSinglePartition</code></td></tr>
<tr><td style="text-align:left"><code>hashingScheme</code></td><td style="text-align:left">The hashing function that determines the partition on which a particular message is published (partitioned topics only). 可用的选项有： <code>JavaStringHash</code>（等价于 Java 中的 <code>String.hashCode()</code>），<code>Murmur3_32Hash</code>（采用了 <a href="https://en.wikipedia.org/wiki/MurmurHash">Murmur3</a> 散列函数）, 或是 <code>BoostHash</code> （采用了 C++ 中 <a href="https://www.boost.org/doc/libs/1_62_0/doc/html/hash.html">Boost</a> 库的散列函数）。</td><td style="text-align:left"><code>BoostHash</code></td></tr>
<tr><td style="text-align:left"><code>compressionType</code></td><td style="text-align:left">The message data compression type used by the producer. 可选项有：<a href="https://github.com/lz4/lz4"><code>LZ4</code></a>，以及 <a href="https://zlib.net/"><code>Zlib</code></a>。</td><td style="text-align:left">Compression None</td></tr>
<tr><td style="text-align:left"><code>batchingEnabled</code></td><td style="text-align:left">如果设置为 <code>true</code> 生产者会批量发送消息。</td><td style="text-align:left"><code>true</code></td></tr>
<tr><td style="text-align:left"><code>batchingMaxPublishDelayMs</code></td><td style="text-align:left">批量发送消息的最大延迟时间。</td><td style="text-align:left">10</td></tr>
<tr><td style="text-align:left"><code>batchingMaxMessages</code></td><td style="text-align:left">每次批量发送消息的消息大小最大值。</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">生产者的元数据。</td><td style="text-align:left"></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="生产者示例"></a><a href="#生产者示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>生产者示例</h3>
<p>This example creates a Node.js producer for the <code>my-topic</code> topic and sends 10 messages to that topic:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-comment">// Create a producer</span>
  <span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  });

  <span class="hljs-comment">// Send messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-string">`my-message-<span class="hljs-subst">${i}</span>`</span>;
    producer.send({
      <span class="hljs-attr">data</span>: Buffer.from(msg),
    });
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`Sent message: <span class="hljs-subst">${msg}</span>`</span>);
  }
  <span class="hljs-keyword">await</span> producer.flush();

  <span class="hljs-keyword">await</span> producer.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="consumers"></a><a href="#consumers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consumers</h2>
<p>Pulsar consumers subscribe to one or more Pulsar topics and listen for incoming messages produced on that topic/those topics. You can <a href="#consumer-configuration">configure</a> Node.js consumers using a consumer configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  <span class="hljs-attr">subscription</span>: <span class="hljs-string">'my-subscription'</span>,
});

<span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive();
<span class="hljs-built_in">console</span>.log(msg.getData().toString());
consumer.acknowledge(msg);

<span class="hljs-keyword">await</span> consumer.close();
</code></pre>
<blockquote>
<h4><a class="anchor" aria-hidden="true" id="promise-操作-1"></a><a href="#promise-操作-1" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Promise 操作</h4>
<p>当你创建一个新的 Pulsar 生产者时，该操作会返回一个 <code>Promise</code> 对象以及生产者实例，亦或是通过 executor 函数来抛出错误。 这个例子中使用了 await 操作，而不是 executor 函数。</p>
</blockquote>
<h3><a class="anchor" aria-hidden="true" id="consumer-operations"></a><a href="#consumer-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consumer operations</h3>
<p>Pulsar Node.js consumers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>receive()</code></td><td style="text-align:left">Receives a single message from the topic. 当消息可用时，Promise 对象运行 executor 函数并获取消息对象。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>receive(Number)</code></td><td style="text-align:left">在指定的超时时间（以毫秒为单位）下从主题接收单条消息。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>acknowledge(Object)</code></td><td style="text-align:left">通过消息对象向 Pulsar <a href="/docs/zh-CN/next/reference-terminology#broker">broker</a> <a href="/docs/zh-CN/next/reference-terminology#acknowledgment-ack">确认收到</a> 一条消息。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeId(Object)</code></td><td style="text-align:left">通过消息 ID 向 Pulsar <a href="/docs/zh-CN/next/reference-terminology#broker">broker</a> <a href="/docs/zh-CN/next/reference-terminology#acknowledgment-ack">确认收到</a> 一条消息。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeCumulative(Object)</code></td><td style="text-align:left"><a href="/docs/zh-CN/next/reference-terminology#acknowledgment-ack">确认收到</a> 流中的 <em>所有</em> 消息，直到（包括）指定的消息为止。 <code>acknowledgeCumulative</code> 方法返回 void ，并向 broker 异步发送 ack。 然后，消息 <em>不会</em> 重新发送给消费者。 累积性发送 ack 的方式不能在 <a href="/docs/zh-CN/next/concepts-messaging#shared">shared</a> 订阅类型下使用。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>acknowledgeCumulativeId(Object)</code></td><td style="text-align:left"><a href="/docs/zh-CN/next/reference-terminology#acknowledgment-ack">确认收到</a> 流中的 <em>所有</em> 消息，直到（包括）指定的消息 ID 为止。</td><td style="text-align:left"><code>void</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">关闭消费者，禁用其从 broker 接收消息的功能。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="consumer-configuration"></a><a href="#consumer-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Consumer configuration</h3>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th><th style="text-align:left">Default</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">消费者建立订阅并监听消息的目标 Pulsar <a href="/docs/zh-CN/next/reference-terminology#topic">主题</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscription</code></td><td style="text-align:left">此消费者的订阅名。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscriptionType</code></td><td style="text-align:left">可选项有：<code>Exclusive</code>、<code>Shared</code> 和 <code>Failover</code>。</td><td style="text-align:left"><code>Exclusive</code></td></tr>
<tr><td style="text-align:left"><code>ackTimeoutMs</code></td><td style="text-align:left">消息确认的超时时间（以毫秒为单位）。</td><td style="text-align:left">0</td></tr>
<tr><td style="text-align:left"><code>receiverQueueSize</code></td><td style="text-align:left">设置消费者的接收队列大小，即在应用程序调用 <code>receive</code> 之前能够堆积的消息数。 A value higher than the default of 1000 could increase consumer throughput, though at the expense of more memory utilization.</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>receiverQueueSizeAcrossPartitions</code></td><td style="text-align:left">Set the max total receiver queue size across partitions. 此设置将用于在总数超过此值时减少每个分区的接收队列大小。</td><td style="text-align:left">50000</td></tr>
<tr><td style="text-align:left"><code>consumerName</code></td><td style="text-align:left">消费者的名称。 当前（v2.4.1）， <a href="/docs/zh-CN/next/concepts-messaging#failover">failover</a>模式以消费者名称顺序排序。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">消费者的元数据。</td><td style="text-align:left"></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消费者示例"></a><a href="#消费者示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消费者示例</h3>
<p>This example creates a Node.js consumer with the <code>my-subscription</code> subscription on the <code>my-topic</code> topic, receives messages, prints the content that arrive, and acknowledges each message to the Pulsar broker for 10 times:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
  });

  <span class="hljs-comment">// Create a consumer</span>
  <span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
    <span class="hljs-attr">subscription</span>: <span class="hljs-string">'my-subscription'</span>,
    <span class="hljs-attr">subscriptionType</span>: <span class="hljs-string">'Exclusive'</span>,
  });

  <span class="hljs-comment">// Receive messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive();
    <span class="hljs-built_in">console</span>.log(msg.getData().toString());
    consumer.acknowledge(msg);
  }

  <span class="hljs-keyword">await</span> consumer.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="readers"></a><a href="#readers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Readers</h2>
<p>Pulsar readers process messages from Pulsar topics. Readers are different from consumers because with readers you need to explicitly specify which message in the stream you want to begin with (consumers, on the other hand, automatically begin with the most recently unacked message). You can <a href="#reader-configuration">configure</a> Node.js readers using a reader configuration object.</p>
<p>Here is an example:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">await</span> client.createReader({
  <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
  <span class="hljs-attr">startMessageId</span>: Pulsar.MessageId.earliest(),
});

<span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> reader.readNext();
<span class="hljs-built_in">console</span>.log(msg.getData().toString());

<span class="hljs-keyword">await</span> reader.close();
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="reader-operations"></a><a href="#reader-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader operations</h3>
<p>Pulsar Node.js readers have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>readNext()</code></td><td style="text-align:left">接收主题中的下一条消息（类似于消费者中的 <code>receive</code> 方法）。 当消息可用时，Promise 对象运行 executor 函数并获取消息对象。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>readNext(Number)</code></td><td style="text-align:left">在指定的超时时间（以毫秒为单位）下从主题接收单条消息。</td><td style="text-align:left"><code>Promise&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>hasNext()</code></td><td style="text-align:left">返回布尔值，表示 broker 是否在目标主题中存在下一条消息。</td><td style="text-align:left"><code>Boolean</code></td></tr>
<tr><td style="text-align:left"><code>close()</code></td><td style="text-align:left">关闭读者，禁用其从 broker 接收消息的功能。</td><td style="text-align:left"><code>Promise&lt;null&gt;</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="reader-configuration"></a><a href="#reader-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reader configuration</h3>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th><th style="text-align:left">Default</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>topic</code></td><td style="text-align:left">读者建立订阅并监听消息的目标 Pulsar <a href="/docs/zh-CN/next/reference-terminology#topic">主题</a>。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>startMessageId</code></td><td style="text-align:left">初始的读者位置，即读者开始进行消息处理的那条起始消息。 可选项有 <code>Pulsar.MessageId.earliest</code>（主题中最早的可用消息）, <code>Pulsar.MessageId.latest</code> （主题中最晚的可用消息）或是一个既不最早也不最晚的消息 ID 对象。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>receiverQueueSize</code></td><td style="text-align:left">设置读者的接收队列大小，即在应用程序调用 <code>readNext</code> 之前能够堆积的消息数。 A value higher than the default of 1000 could increase reader throughput, though at the expense of more memory utilization.</td><td style="text-align:left">1000</td></tr>
<tr><td style="text-align:left"><code>readerName</code></td><td style="text-align:left">读者的名称。</td><td style="text-align:left"></td></tr>
<tr><td style="text-align:left"><code>subscriptionRolePrefix</code></td><td style="text-align:left">The subscription role prefix.</td><td style="text-align:left"></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="读者示例"></a><a href="#读者示例" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>读者示例</h3>
<p>This example creates a Node.js reader with the <code>my-topic</code> topic, reads messages, and prints the content that arrive for 10 times:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);

<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (</span>) =&gt;</span> {
  <span class="hljs-comment">// Create a client</span>
  <span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client({
    <span class="hljs-attr">serviceUrl</span>: <span class="hljs-string">'pulsar://localhost:6650'</span>,
    <span class="hljs-attr">operationTimeoutSeconds</span>: <span class="hljs-number">30</span>,
  });

  <span class="hljs-comment">// Create a reader</span>
  <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">await</span> client.createReader({
    <span class="hljs-attr">topic</span>: <span class="hljs-string">'my-topic'</span>,
    <span class="hljs-attr">startMessageId</span>: Pulsar.MessageId.earliest(),
  });

  <span class="hljs-comment">// read messages</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i += <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> reader.readNext();
    <span class="hljs-built_in">console</span>.log(msg.getData().toString());
  }

  <span class="hljs-keyword">await</span> reader.close();
  <span class="hljs-keyword">await</span> client.close();
})();
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="messages"></a><a href="#messages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Messages</h2>
<p>In Pulsar Node.js client, you have to construct producer message object for producer.</p>
<p>Here is an example message:</p>
<pre><code class="hljs css language-JavaScript"><span class="hljs-keyword">const</span> msg = {
  <span class="hljs-attr">data</span>: Buffer.from(<span class="hljs-string">'Hello, Pulsar'</span>),
  <span class="hljs-attr">partitionKey</span>: <span class="hljs-string">'key1'</span>,
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-string">'foo'</span>: <span class="hljs-string">'bar'</span>,
  },
  <span class="hljs-attr">eventTimestamp</span>: <span class="hljs-built_in">Date</span>.now(),
  <span class="hljs-attr">replicationClusters</span>: [
    <span class="hljs-string">'cluster1'</span>,
    <span class="hljs-string">'cluster2'</span>,
  ],
}

<span class="hljs-keyword">await</span> producer.send(msg);
</code></pre>
<p>The following keys are available for producer message objects:</p>
<table>
<thead>
<tr><th style="text-align:left">Parameter</th><th style="text-align:left">Description</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>data</code></td><td style="text-align:left">消息实际搭载的数据。</td></tr>
<tr><td style="text-align:left"><code>properties</code></td><td style="text-align:left">一个对象，用于存储应用程序指定让消息附带的任意元数据。</td></tr>
<tr><td style="text-align:left"><code>eventTimestamp</code></td><td style="text-align:left">与消息相关联的时间戳。</td></tr>
<tr><td style="text-align:left"><code>sequenceId</code></td><td style="text-align:left">消息的序列号。</td></tr>
<tr><td style="text-align:left"><code>partitionKey</code></td><td style="text-align:left">与消息关联的可选键值（对于主题压缩之类的事项尤其有用）。</td></tr>
<tr><td style="text-align:left"><code>replicationClusters</code></td><td style="text-align:left">The clusters to which this message will be replicated. Pulsar brokers handle message replication automatically; you should only change this setting if you want to override the broker default.</td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消息对象操作"></a><a href="#消息对象操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息对象操作</h3>
<p>In Pulsar Node.js client, you can receive (or read) message object as consumer (or reader).</p>
<p>The message object have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>getTopicName()</code></td><td style="text-align:left">主题名称的 Getter 方法。</td><td style="text-align:left"><code>String</code></td></tr>
<tr><td style="text-align:left"><code>getProperties()</code></td><td style="text-align:left">属性的 Getter 方法。</td><td style="text-align:left"><code>Array&lt;Object&gt;</code></td></tr>
<tr><td style="text-align:left"><code>getData()</code></td><td style="text-align:left">消息数据的Getter方法。</td><td style="text-align:left"><code>Buffer</code></td></tr>
<tr><td style="text-align:left"><code>getMessageId()</code></td><td style="text-align:left"><a href="#message-id-object-operations">消息 id 对象</a> 的 Getter 方法。</td><td style="text-align:left"><code>Object</code></td></tr>
<tr><td style="text-align:left"><code>getPublishTimestamp()</code></td><td style="text-align:left">发布时间戳的 Getter 方法。</td><td style="text-align:left"><code>Number</code></td></tr>
<tr><td style="text-align:left"><code>getEventTimestamp()</code></td><td style="text-align:left">事件时间戳的 Getter 方法。</td><td style="text-align:left"><code>Number</code></td></tr>
<tr><td style="text-align:left"><code>getPartitionKey()</code></td><td style="text-align:left">分区键的 Getter 方法。</td><td style="text-align:left"><code>String</code></td></tr>
</tbody>
</table>
<h3><a class="anchor" aria-hidden="true" id="消息-id-对象操作"></a><a href="#消息-id-对象操作" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>消息 ID 对象操作</h3>
<p>In Pulsar Node.js client, you can get message id object from message object.</p>
<p>The message id object have the following methods available:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>serialize()</code></td><td style="text-align:left">将消息 id 序列化到缓存中进行存储。</td><td style="text-align:left"><code>Buffer</code></td></tr>
<tr><td style="text-align:left"><code>toString()</code></td><td style="text-align:left">以字符串的形式获取消息 id。</td><td style="text-align:left"><code>String</code></td></tr>
</tbody>
</table>
<p>The client has static method of message id object. You can access it as <code>Pulsar.MessageId.someStaticMethod</code> too.</p>
<p>The following static methods are available for the message id object:</p>
<table>
<thead>
<tr><th style="text-align:left">Method</th><th style="text-align:left">Description</th><th style="text-align:left">Return type</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>earliest()</code></td><td style="text-align:left">MessageId 表示存储在主题中最早/最老的可用消息。</td><td style="text-align:left"><code>Object</code></td></tr>
<tr><td style="text-align:left"><code>latest()</code></td><td style="text-align:left">MessageId 表示主题中最晚/最后发布的可用消息。</td><td style="text-align:left"><code>Object</code></td></tr>
<tr><td style="text-align:left"><code>deserialize(Buffer)</code></td><td style="text-align:left">从缓存中反序列化出消息 id。</td><td style="text-align:left"><code>Object</code></td></tr>
</tbody>
</table>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/zh-CN/next/client-libraries-cpp"><span class="arrow-prev">← </span><span>C++</span></a><a class="docs-next button" href="/docs/zh-CN/next/client-libraries-websocket"><span class="function-name-prevnext">WebSocket</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#安装">安装</a><ul class="toc-headings"><li><a href="#要求">要求</a></li><li><a href="#兼容性">兼容性</a></li><li><a href="#使用-npm-安装">使用 npm 安装</a></li></ul></li><li><a href="#连接url">连接URL</a></li><li><a href="#创建客户端">创建客户端</a><ul class="toc-headings"><li><a href="#客户端配置">客户端配置</a></li></ul></li><li><a href="#producers">Producers</a><ul class="toc-headings"><li><a href="#producer-operations">Producer operations</a></li><li><a href="#producer-配置">Producer 配置</a></li><li><a href="#生产者示例">生产者示例</a></li></ul></li><li><a href="#consumers">Consumers</a><ul class="toc-headings"><li><a href="#consumer-operations">Consumer operations</a></li><li><a href="#consumer-configuration">Consumer configuration</a></li><li><a href="#消费者示例">消费者示例</a></li></ul></li><li><a href="#readers">Readers</a><ul class="toc-headings"><li><a href="#reader-operations">Reader operations</a></li><li><a href="#reader-configuration">Reader configuration</a></li><li><a href="#读者示例">读者示例</a></li></ul></li><li><a href="#messages">Messages</a><ul class="toc-headings"><li><a href="#消息对象操作">消息对象操作</a></li><li><a href="#消息-id-对象操作">消息 ID 对象操作</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2020 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/zh-CN/contact">Contact</a></li>' +
            '<li><a href="/zh-CN/contributing">Contributing</a></li>' +
            '<li><a href="/zh-CN/coding-guide">Coding guide</a></li>' +
            '<li><a href="/zh-CN/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/zh-CN/resources">Resources</a></li>' +
            '<li><a href="/zh-CN/team">Team</a></li>' +
            '<li><a href="/zh-CN/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:zh-CN","version:next"]}
              });
            </script></body></html>