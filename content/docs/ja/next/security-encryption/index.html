<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Pulsar Encryption · Apache Pulsar</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="ja"/><meta property="og:title" content="Pulsar Encryption · Apache Pulsar"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pulsar.apache.org/"/><meta property="og:description" content="Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages."/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://pulsar.apache.org/img/pulsar.svg"/><link rel="shortcut icon" href="/img/pulsar.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css"/><link rel="alternate" type="application/atom+xml" href="https://pulsar.apache.org/blog/atom.xml" title="Apache Pulsar Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://pulsar.apache.org/blog/feed.xml" title="Apache Pulsar Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102219959-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="/css/code-blocks-buttons.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script><script type="text/javascript" src="/js/custom.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/ja"><img class="logo" src="/img/pulsar.svg" alt="Apache Pulsar"/></a><a href="/ja/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/ja/next/standalone" target="_self">Docs</a></li><li class=""><a href="/ja/download" target="_self">Download</a></li><li class="siteNavGroupActive"><a href="/docs/ja/next/client-libraries" target="_self">Clients</a></li><li class=""><a href="#restapis" target="_self">REST APIs</a></li><li class=""><a href="#cli" target="_self">Cli</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class=""><a href="#community" target="_self">Community</a></li><li class=""><a href="#apache" target="_self">Apache</a></li><li class=""><a href="https://pulsar-next.staged.apache.org/" target="_self">New Website(Beta)</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>日本語</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/docs/en/next/security-encryption">English</a></li><li><a href="/docs/fr/next/security-encryption">Français</a></li><li><a href="/docs/ko/next/security-encryption">한국어</a></li><li><a href="/docs/zh-CN/next/security-encryption">中文</a></li><li><a href="/docs/zh-TW/next/security-encryption">繁體中文</a></li><li><a href="https://crowdin.com/project/apache-pulsar" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Security</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Get Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/standalone">Pulsar をローカルで実行する</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/standalone-docker">Run Pulsar in Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/kubernetes-helm">Run Pulsar in Kubernetes</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Concepts and Architecture</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-messaging">Messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-architecture-overview">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-clients">Clients</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-replication">Geo Replication</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-multi-tenancy">Multi Tenancy</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-authentication">Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-topic-compaction">Topic Compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-proxy-sni-routing">Proxy support with SNI routing</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/concepts-multiple-advertised-listeners">Multiple advertised listeners</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Schema</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/schema-get-started">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/schema-understand">Understand schema</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/schema-evolution-compatibility">Schema evolution and compatibility</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/schema-manage">Manage schema</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar Functions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-runtime">Setup: Configure Functions runtime</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-worker">Setup: Pulsar Functions Worker</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-develop">How-to: Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-package">How-to: Package</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-debug">How-to: Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-deploy">How-to: Deploy</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/functions-cli">Reference: CLI</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/window-functions-context">Window Functions: Context</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar IO</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-quickstart">Get started</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-use">Use</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-debug">Debug</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-connectors">Built-in connector</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-cdc">CDC connector</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-develop">Develop</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/io-cli">CLI</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Pulsar SQL</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/sql-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/sql-getting-started">Query data</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/sql-deployment-configurations">Configuration and deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/sql-rest-api">REST APIs</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tiered Storage</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-aws">AWS S3 offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-gcs">GCS offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-filesystem">Filesystem offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-azure">Azure BlobStore offloader</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/tiered-storage-aliyun">Aliyun OSS offloader</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Transactions</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/txn-why">Why transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/txn-what">What are transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/txn-how">How transactions work?</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/txn-use">How to use transactions?</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/txn-monitor">How to monitor transactions?</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Kubernetes (Helm)</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-prepare">Prepare</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-install">インストール</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-deploy">Deployment</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/helm-tools">Required Tools</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Deployment</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-aws">Amazon Web Services</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-kubernetes">Kubernetes</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-bare-metal">Bare metal</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-bare-metal-multi-cluster">Bare metal multi-cluster</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-docker">Docker</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/deploy-monitoring">Monitor</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Administration</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-zk-bk">ZooKeeper and BookKeeper</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-geo">Geo-replication</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-pulsar-manager">Pulsar Manager</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-stats">Pulsar statistics</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-load-balance">Load balance</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-proxy">Pulsar proxy</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-upgrade">Upgrade</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/administration-isolation">Pulsar isolation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Security</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-policy-and-supported-versions">Security Policy and Supported Versions</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-tls-transport">Transport Encryption using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-tls-authentication">Authentication using TLS</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-tls-keystore">Using TLS with KeyStore configure</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-jwt">Authentication using JWT</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-athenz">Authentication using Athenz</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-kerberos">Authentication using Kerberos</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-oauth2">Authentication using OAuth 2.0 access tokens</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-authorization">認可と ACL</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/ja/next/security-encryption">End-to-End Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-extending">Extend Authentication and Authorization</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/security-bouncy-castle">Bouncy Castle Providers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Performance</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/performance-pulsar-perf">Pulsar Perf</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Client Libraries</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-java">Java</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-go">Go</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-python">Python</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-cpp">C++</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-node">Node.js</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-websocket">WebSocket</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-dotnet">C#</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/client-libraries-rest">REST</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Admin API</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-overview">概要</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-clusters">Clusters</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-tenants">Tenants</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-brokers">Brokers</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-namespaces">Namespaces</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-permissions">Permissions</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-topics">Topics</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-functions">Functions</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/admin-api-packages">Packages</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Adaptors</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/adaptors-kafka">Kafka client wrapper</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/adaptors-spark">Apache Spark</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/adaptors-storm">Apache Storm</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Cookbooks</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-compaction">Topic compaction</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-deduplication">Message deduplication</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-non-persistent">Non-persistent messaging</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-retention-expiry">Message retention and expiry</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-message-queue">Message queue</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/cookbooks-bookkeepermetadata">BookKeeper Ledger Metadata</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Development</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/develop-tools">Simulation tools</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/develop-binary-protocol">Binary protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/develop-load-manager">Modular load manager</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/develop-plugin">Plugin</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/ja/next/reference-terminology">Terminology</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/reference-cli-tools">Pulsar CLI tools</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/reference-configuration">Pulsar configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/ja/next/reference-metrics">Pulsar Metrics</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/apache-pulsar/ja" target="_blank" rel="noreferrer noopener">Translate</a><h1 id="__docusaurus" class="postHeaderTitle">Pulsar Encryption</h1></header><article><div><span><p>Applications can use Pulsar encryption to encrypt messages at the producer side and decrypt messages at the consumer side. You can use the public and private key pair that the application configures to perform encryption. Only the consumers with a valid key can decrypt the encrypted messages.</p>
<h2><a class="anchor" aria-hidden="true" id="asymmetric-and-symmetric-encryption"></a><a href="#asymmetric-and-symmetric-encryption" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Asymmetric and symmetric encryption</h2>
<p>Pulsar は動的に生成された AES の共通鍵を使用してメッセージ (データ) の暗号化を行います。 You can use the application provided ECDSA/RSA key pair to encrypt the AES key(data key), so you do not have to share the secret with everyone.</p>
<p>Key is a public and private key pair used for encryption or decryption. The producer key is the public key of the key pair, and the consumer key is the private key of the key pair.</p>
<p>The application configures the producer with the public key. You can use this key to encrypt the AES data key. The encrypted data key is sent as part of message header. Only entities with the private key (in this case the consumer) are able to decrypt the data key which is used to decrypt the message.</p>
<p>You can encrypt a message with more than one key. Any one of the keys used for encrypting the message is sufficient to decrypt the message.</p>
<p>Pulsar does not store the encryption key anywhere in the Pulsar service. If you lose or delete the private key, your message is irretrievably lost, and is unrecoverable.</p>
<h2><a class="anchor" aria-hidden="true" id="プロデューサー"></a><a href="#プロデューサー" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロデューサー</h2>
<p><img src="/docs/assets/pulsar-encryption-producer.jpg" alt="alt text" title="Pulsar Encryption Producer"></p>
<h2><a class="anchor" aria-hidden="true" id="コンシューマー"></a><a href="#コンシューマー" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>コンシューマー</h2>
<p><img src="/docs/assets/pulsar-encryption-consumer.jpg" alt="alt text" title="Pulsar Encryption Consumer"></p>
<h2><a class="anchor" aria-hidden="true" id="get-started"></a><a href="#get-started" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Get started</h2>
<ol>
<li>Enter the commands below to create your ECDSA or RSA public and private key pair.</li>
</ol>
<pre><code class="hljs css language-shell">openssl ecparam -name secp521r1 -genkey -param_enc explicit -out test_ecdsa_privkey.pem
openssl ec -in test_ecdsa_privkey.pem -pubout -outform pem -out test_ecdsa_pubkey.pem
</code></pre>
<ol>
<li><p>作成した公開鍵と秘密鍵を鍵管理システムに追加し、プロデューサーでは公開鍵を、コンシューマーでは秘密鍵を取得できるように設定する。</p></li>
<li><p>Implement the CryptoKeyReader interface, specifically CryptoKeyReader.getPublicKey() for producer and CryptoKeyReader.getPrivateKey() for consumer, which Pulsar client invokes to load the key.</p></li>
<li><p>Add encryption key name to producer builder: PulsarClient.newProducer().addEncryptionKey(&quot;myapp.key&quot;).</p></li>
<li><p>Configure a <code>CryptoKeyReader</code> to a producer, consumer or reader.</p></li>
</ol>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3836-tab-3837" class="nav-link active" data-group="group_3836" data-tab="tab-group-3836-content-3837">Java</div><div id="tab-group-3836-tab-3838" class="nav-link" data-group="group_3836" data-tab="tab-group-3836-content-3838">C++</div><div id="tab-group-3836-tab-3839" class="nav-link" data-group="group_3836" data-tab="tab-group-3836-content-3839">Python</div><div id="tab-group-3836-tab-3840" class="nav-link" data-group="group_3836" data-tab="tab-group-3836-content-3840">Node.JS</div></div><div class="tab-content"><div id="tab-group-3836-content-3837" class="tab-pane active" data-group="group_3836" tabindex="-1"><div><span><pre><code class="hljs css language-java">PulsarClient pulsarClient = PulsarClient.builder().serviceUrl(<span class="hljs-string">"pulsar://localhost:6650"</span>).build();<br />String topic = <span class="hljs-string">"persistent://my-tenant/my-ns/my-topic"</span>;<br /><span class="hljs-comment">// RawFileKeyReader is just an example implementation that's not provided by Pulsar</span><br />CryptoKeyReader keyReader = <span class="hljs-keyword">new</span> RawFileKeyReader(<span class="hljs-string">"test_ecdsa_pubkey.pem"</span>, <span class="hljs-string">"test_ecdsa_privkey.pem"</span>);<br /><br />Producer&lt;<span class="hljs-keyword">byte</span>[]&gt; producer = pulsarClient.newProducer()<br />        .topic(topic)<br />        .cryptoKeyReader(keyReader)<br />        .addEncryptionKey(“myappkey”)<br />        .create();<br /><br />Consumer&lt;<span class="hljs-keyword">byte</span>[]&gt; consumer = pulsarClient.newConsumer()<br />        .topic(topic)<br />        .subscriptionName(<span class="hljs-string">"my-subscriber-name"</span>)<br />        .cryptoKeyReader(keyReader)<br />        .subscribe();<br /><br />Reader&lt;<span class="hljs-keyword">byte</span>[]&gt; reader = pulsarClient.newReader()<br />        .topic(topic)<br />        .startMessageId(MessageId.earliest)<br />        .cryptoKeyReader(keyReader)<br />        .create();<br /></code></pre>
</span></div></div><div id="tab-group-3836-content-3838" class="tab-pane" data-group="group_3836" tabindex="-1"><div><span><pre><code class="hljs css language-c++"><span class="hljs-function"><span class="hljs-built_in">Client</span> <span class="hljs-title">client</span><span class="hljs-params">(<span class="hljs-string">"pulsar://localhost:6650"</span>)</span></span>;<br /><span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> topic = <span class="hljs-string">"persistent://my-tenant/my-ns/my-topic"</span>;<br /><span class="hljs-comment">// DefaultCryptoKeyReader is a built-in implementation that reads public key and private key from files</span><br /><span class="hljs-keyword">auto</span> keyReader = <span class="hljs-built_in">std</span>::make_shared&lt;DefaultCryptoKeyReader&gt;(<span class="hljs-string">"test_ecdsa_pubkey.pem"</span>, <span class="hljs-string">"test_ecdsa_privkey.pem"</span>);<br /><br />Producer producer;<br />ProducerConfiguration producerConf;<br />producerConf.setCryptoKeyReader(keyReader);<br />producerConf.addEncryptionKey(<span class="hljs-string">"myappkey"</span>);<br />client.createProducer(topic, producerConf, producer);<br /><br />Consumer consumer;<br />ConsumerConfiguration consumerConf;<br />consumerConf.setCryptoKeyReader(keyReader);<br />client.subscribe(topic, <span class="hljs-string">"my-subscriber-name"</span>, consumerConf, consumer);<br /><br />Reader reader;<br />ReaderConfiguration readerConf;<br />readerConf.setCryptoKeyReader(keyReader);<br />client.createReader(topic, MessageId::earliest(), readerConf, reader);<br /></code></pre>
</span></div></div><div id="tab-group-3836-content-3839" class="tab-pane" data-group="group_3836" tabindex="-1"><div><span><pre><code class="hljs css language-python"><span class="hljs-keyword">from</span> pulsar <span class="hljs-keyword">import</span> Client, CryptoKeyReader<br /><br />client = Client(<span class="hljs-string">'pulsar://localhost:6650'</span>)<br />topic = <span class="hljs-string">'persistent://my-tenant/my-ns/my-topic'</span><br /><span class="hljs-comment"># CryptoKeyReader is a built-in implementation that reads public key and private key from files</span><br />key_reader = CryptoKeyReader(<span class="hljs-string">'test_ecdsa_pubkey.pem'</span>, <span class="hljs-string">'test_ecdsa_privkey.pem'</span>)<br /><br />producer = client.create_producer(<br />    topic=topic,<br />    encryption_key=<span class="hljs-string">'myappkey'</span>,<br />    crypto_key_reader=key_reader<br />)<br /><br />consumer = client.subscribe(<br />    topic=topic,<br />    subscription_name=<span class="hljs-string">'my-subscriber-name'</span>,<br />    crypto_key_reader=key_reader<br />)<br /><br />reader = client.create_reader(<br />    topic=topic,<br />    start_message_id=MessageId.earliest,<br />    crypto_key_reader=key_reader<br />)<br /><br />client.close()<br /></code></pre>
</span></div></div><div id="tab-group-3836-content-3840" class="tab-pane" data-group="group_3836" tabindex="-1"><div><span><pre><code class="hljs css language-nodejs"><span class="hljs-keyword">const</span> Pulsar = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pulsar-client'</span>);<br /><br /><span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">async</span> (<span class="hljs-params"></span>) =&gt; {<br /><span class="hljs-comment">// Create a client</span><br /><span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> Pulsar.Client(<span class="hljs-params">{<br />    serviceUrl: 'pulsar:<span class="hljs-comment">//localhost:6650',</span><br />    operationTimeoutSeconds: 30,<br />}</span>);<br /><br /><span class="hljs-comment">// Create a producer</span><br /><span class="hljs-keyword">const</span> producer = <span class="hljs-keyword">await</span> client.createProducer(<span class="hljs-params">{<br />    topic: 'persistent:<span class="hljs-comment">//public/default/my-topic',</span><br />    sendTimeoutMs: 30000,<br />    batchingEnabled: <span class="hljs-literal">true</span>,<br />    publicKeyPath: "<span class="hljs-keyword">public</span>-key.client-rsa.pem",<br />    encryptionKey: "encryption-key"<br />}</span>);<br /><br /><span class="hljs-comment">// Create a consumer</span><br /><span class="hljs-keyword">const</span> consumer = <span class="hljs-keyword">await</span> client.subscribe(<span class="hljs-params">{<br />    topic: 'persistent:<span class="hljs-comment">//public/default/my-topic',</span><br />    subscription: 'sub1',<br />    subscriptionType: 'Shared',<br />    ackTimeoutMs: 10000,<br />    privateKeyPath: "<span class="hljs-keyword">private</span>-key.client-rsa.pem"<br />}</span>);<br /><br /><span class="hljs-comment">// Send messages</span><br /><span class="hljs-keyword">for</span> (<span class="hljs-params"><span class="hljs-keyword">let</span> i = 0; i &lt; 10; i += 1</span>) {<br />    <span class="hljs-keyword">const</span> msg = `my-message-${i}`;<br />    producer.send(<span class="hljs-params">{<br />    data: Buffer.<span class="hljs-keyword">from</span>(<span class="hljs-params">msg</span>),<br />    }</span>);<br />    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">`Sent message: ${msg}`</span>);<br />}<br /><span class="hljs-keyword">await</span> producer.flush(<span class="hljs-params"></span>);<br /><br /><span class="hljs-comment">// Receive messages</span><br /><span class="hljs-keyword">for</span> (<span class="hljs-params"><span class="hljs-keyword">let</span> i = 0; i &lt; 10; i += 1</span>) {<br />    <span class="hljs-keyword">const</span> msg = <span class="hljs-keyword">await</span> consumer.receive(<span class="hljs-params"></span>);<br />    <span class="hljs-built_in">console</span>.log(<span class="hljs-params">msg.getData(<span class="hljs-params"></span>).toString(<span class="hljs-params"></span>)</span>);<br />    consumer.acknowledge(<span class="hljs-params">msg</span>);<br />}<br /><br /><span class="hljs-keyword">await</span> consumer.close(<span class="hljs-params"></span>);<br /><span class="hljs-keyword">await</span> producer.close(<span class="hljs-params"></span>);<br /><span class="hljs-keyword">await</span> client.close(<span class="hljs-params"></span>);<br />}</span>)<span class="hljs-params">()</span>;<br /></span></code></pre>
</span></div></div></div></div>
<ol>
<li>Below is an example of a <strong>customized</strong> <code>CryptoKeyReader</code> implementation.</li>
</ol>
<div class="tabs"><div class="nav-tabs"><div id="tab-group-3841-tab-3842" class="nav-link active" data-group="group_3841" data-tab="tab-group-3841-content-3842">Java</div><div id="tab-group-3841-tab-3843" class="nav-link" data-group="group_3841" data-tab="tab-group-3841-content-3843">C++</div><div id="tab-group-3841-tab-3844" class="nav-link" data-group="group_3841" data-tab="tab-group-3841-content-3844">Python</div><div id="tab-group-3841-tab-3845" class="nav-link" data-group="group_3841" data-tab="tab-group-3841-content-3845">Node.JS</div></div><div class="tab-content"><div id="tab-group-3841-content-3842" class="tab-pane active" data-group="group_3841" tabindex="-1"><div><span><pre><code class="hljs css language-java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RawFileKeyReader</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CryptoKeyReader</span> </span>{<br /><br />    String publicKeyFile = <span class="hljs-string">""</span>;<br />    String privateKeyFile = <span class="hljs-string">""</span>;<br /><br />    RawFileKeyReader(String pubKeyFile, String privKeyFile) {<br />        publicKeyFile = pubKeyFile;<br />        privateKeyFile = privKeyFile;<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> EncryptionKeyInfo <span class="hljs-title">getPublicKey</span><span class="hljs-params">(String keyName, Map&lt;String, String&gt; keyMeta)</span> </span>{<br />        EncryptionKeyInfo keyInfo = <span class="hljs-keyword">new</span> EncryptionKeyInfo();<br />        <span class="hljs-keyword">try</span> {<br />            keyInfo.setKey(Files.readAllBytes(Paths.get(publicKeyFile)));<br />        } <span class="hljs-keyword">catch</span> (IOException e) {<br />            System.out.println(<span class="hljs-string">"ERROR: Failed to read public key from file "</span> + publicKeyFile);<br />            e.printStackTrace();<br />        }<br />        <span class="hljs-keyword">return</span> keyInfo;<br />    }<br /><br />    <span class="hljs-meta">@Override</span><br />    <span class="hljs-function"><span class="hljs-keyword">public</span> EncryptionKeyInfo <span class="hljs-title">getPrivateKey</span><span class="hljs-params">(String keyName, Map&lt;String, String&gt; keyMeta)</span> </span>{<br />        EncryptionKeyInfo keyInfo = <span class="hljs-keyword">new</span> EncryptionKeyInfo();<br />        <span class="hljs-keyword">try</span> {<br />            keyInfo.setKey(Files.readAllBytes(Paths.get(privateKeyFile)));<br />        } <span class="hljs-keyword">catch</span> (IOException e) {<br />            System.out.println(<span class="hljs-string">"ERROR: Failed to read private key from file "</span> + privateKeyFile);<br />            e.printStackTrace();<br />        }<br />        <span class="hljs-keyword">return</span> keyInfo;<br />    }<br />}<br /></code></pre>
</span></div></div><div id="tab-group-3841-content-3843" class="tab-pane" data-group="group_3841" tabindex="-1"><div><span><pre><code class="hljs css language-c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomCryptoKeyReader</span> :</span> <span class="hljs-keyword">public</span> CryptoKeyReader {<br />    <span class="hljs-keyword">public</span>:<br />    <span class="hljs-function">Result <span class="hljs-title">getPublicKey</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; keyName, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; metadata,<br />                        EncryptionKeyInfo&amp; encKeyInfo)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{<br />        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span></span><br />        <span class="hljs-keyword">return</span> ResultOk;<br />    }<br /><br />    <span class="hljs-function">Result <span class="hljs-title">getPrivateKey</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; keyName, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">map</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&gt;&amp; metadata,<br />                        EncryptionKeyInfo&amp; encKeyInfo)</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">override</span> </span>{<br />        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span></span><br />        <span class="hljs-keyword">return</span> ResultOk;<br />    }<br />};<br /><br /><span class="hljs-keyword">auto</span> keyReader = <span class="hljs-built_in">std</span>::make_shared&lt;CustomCryptoKeyReader&gt;(<span class="hljs-comment">/* ... */</span>);<br /><span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> create producer, consumer or reader based on keyReader here</span><br /></code></pre>
<p>Besides, you can use the <strong>default</strong> implementation of <code>CryptoKeyReader</code> by specifying the paths of <code>private key</code> and <code>public key</code>.</p>
</span></div></div><div id="tab-group-3841-content-3844" class="tab-pane" data-group="group_3841" tabindex="-1"><div><span><p><strong>customized</strong> <code>CryptoKeyReader</code> implementation is not supported in Python. However, you can use the <strong>default</strong> implementation by specifying the path of <code>private key</code> and <code>public key</code>.</p>
</span></div></div><div id="tab-group-3841-content-3845" class="tab-pane" data-group="group_3841" tabindex="-1"><div><span><p><strong>customized</strong> <code>CryptoKeyReader</code> implementation is not supported in Node.JS. However, you can use the <strong>default</strong> implementation by specifying the path of <code>private key</code> and <code>public key</code>.</p>
</span></div></div></div></div>
<h2><a class="anchor" aria-hidden="true" id="鍵のローテーション"></a><a href="#鍵のローテーション" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>鍵のローテーション</h2>
<p>Pulsar generates a new AES data key every 4 hours or after publishing a certain number of messages. A producer fetches the asymmetric public key every 4 hours by calling CryptoKeyReader.getPublicKey() to retrieve the latest version.</p>
<h2><a class="anchor" aria-hidden="true" id="enable-encryption-at-the-producer-application"></a><a href="#enable-encryption-at-the-producer-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Enable encryption at the producer application</h2>
<p>If you produce messages that are consumed across application boundaries, you need to ensure that consumers in other applications have access to one of the private keys that can decrypt the messages. You can do this in two ways: 1. The consumer application provides you access to their public key, which you add to your producer keys. 2. You grant access to one of the private keys from the pairs that producer uses.</p>
<p>When producers want to encrypt the messages with multiple keys, producers add all such keys to the config. Consumer can decrypt the message as long as the consumer has access to at least one of the keys.</p>
<p>If you need to encrypt the messages using 2 keys (myapp.messagekey1 and myapp.messagekey2), refer to the following example.</p>
<pre><code class="hljs css language-java">PulsarClient.newProducer().addEncryptionKey(<span class="hljs-string">"myapp.messagekey1"</span>).addEncryptionKey(<span class="hljs-string">"myapp.messagekey2"</span>);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="decrypt-encrypted-messages-at-the-consumer-application"></a><a href="#decrypt-encrypted-messages-at-the-consumer-application" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Decrypt encrypted messages at the consumer application</h2>
<p>Consumers require access one of the private keys to decrypt messages that the producer produces. If you want to receive encrypted messages, create a public or private key and give your public key to the producer application to encrypt messages using your public key.</p>
<h2><a class="anchor" aria-hidden="true" id="handle-failures"></a><a href="#handle-failures" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handle failures</h2>
<ul>
<li>Producer/ Consumer loses access to the key
<ul>
<li>Producer action fails indicating the cause of the failure. Application has the option to proceed with sending unencrypted message in such cases. Call PulsarClient.newProducer().cryptoFailureAction(ProducerCryptoFailureAction) to control the producer behavior. The default behavior is to fail the request.</li>
<li>If consumption fails due to decryption failure or missing keys in consumer, application has the option to consume the encrypted message or discard it. Call PulsarClient.newConsumer().cryptoFailureAction(ConsumerCryptoFailureAction) to control the consumer behavior. The default behavior is to fail the request. Application is never able to decrypt the messages if the private key is permanently lost.</li>
</ul></li>
<li>Batch messaging
<ul>
<li>If decryption fails and the message contains batch messages, client is not able to retrieve individual messages in the batch, hence message consumption fails even if cryptoFailureAction() is set to ConsumerCryptoFailureAction.CONSUME.</li>
</ul></li>
<li>If decryption fails, the message consumption stops and application notices backlog growth in addition to decryption failure messages in the client log. If application does not have access to the private key to decrypt the message, the only option is to skip or discard backlogged messages.</li>
</ul>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/ja/next/security-authorization"><span class="arrow-prev">← </span><span>認可と ACL</span></a><a class="docs-next button" href="/docs/ja/next/security-extending"><span>Extend Authentication and Authorization</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#asymmetric-and-symmetric-encryption">Asymmetric and symmetric encryption</a></li><li><a href="#プロデューサー">プロデューサー</a></li><li><a href="#コンシューマー">コンシューマー</a></li><li><a href="#get-started">Get started</a></li><li><a href="#鍵のローテーション">鍵のローテーション</a></li><li><a href="#enable-encryption-at-the-producer-application">Enable encryption at the producer application</a></li><li><a href="#decrypt-encrypted-messages-at-the-consumer-application">Decrypt encrypted messages at the consumer application</a></li><li><a href="#handle-failures">Handle failures</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="copyright">Copyright © 2022 The Apache Software Foundation. All Rights Reserved. Apache, Apache Pulsar and the Apache feather logo are trademarks of The Apache Software Foundation.</section><span><script>
      const community = document.querySelector("a[href='#community']").parentNode;
      const communityMenu =
        '<li>' +
        '<a id="community-menu" href="#">Community <span style="font-size: 0.75em">&nbsp;▼</span></a>' +
        '<div id="community-dropdown" class="hide">' +
          '<ul id="community-dropdown-items">' +
            '<li><a href="/ja/contact">Contact</a></li>' +
            '<li><a href="/ja/contributing">Contributing</a></li>' +
            '<li><a href="/ja/coding-guide">Coding guide</a></li>' +
            '<li><a href="/ja/events">Events</a></li>' +
            '<li><a href="https://twitter.com/Apache_Pulsar" target="_blank">Twitter &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/wiki" target="_blank">Wiki &#x2750</a></li>' +
            '<li><a href="https://github.com/apache/pulsar/issues" target="_blank">Issue tracking &#x2750</a></li>' +
            '<li><a href="https://pulsar-summit.org/" target="_blank">Pulsar Summit &#x2750</a></li>' +
            '<li>&nbsp;</li>' +
            '<li><a href="/ja/resources">Resources</a></li>' +
            '<li><a href="/ja/team">Team</a></li>' +
            '<li><a href="/ja/powered-by">Powered By</a></li>' +
          '</ul>' +
        '</div>' +
        '</li>';

      community.innerHTML = communityMenu;

      const communityMenuItem = document.getElementById("community-menu");
      const communityDropDown = document.getElementById("community-dropdown");
      communityMenuItem.addEventListener("click", function(event) {
        event.preventDefault();

        if (communityDropDown.className == 'hide') {
          communityDropDown.className = 'visible';
        } else {
          communityDropDown.className = 'hide';
        }
      });
    </script></span></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd226a455cecdd4bc18a554c1b47e5b52',
                indexName: 'apache_pulsar',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["language:ja","version:next"]}
              });
            </script></body></html>